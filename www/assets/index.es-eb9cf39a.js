import{c as dr,a as wi,g as Jy,b as ae,e as Cr,d as Yy,w as Cl,f as Al,h as lc,i as ao,j as Xy,l as Zy,S as mi,A as Qy,U as e1,N as Z,p as t1,q as rc,_ as r1,u as i1,P as s1,x as bh,C as n1,D as o1,$ as a1,Q as Eh,y as c1,z as u1,B as so,E as h1,F as fc,G as Ol,J as Br,K as l1,M as f1,X as cs,O as Ft,R as er,T as yi,W as ar,Y as p1,Z as us,a0 as Rl,a1 as d1,a2 as g1,a3 as v1,a4 as Tl,a5 as y1,a6 as Nl,a7 as Fl,a8 as ls,a9 as ic,aa as to,ab as Hs,ac as m1,ad as ro,ae as _1,af as w1,ag as b1,ah as E1,ai as za,aj as xh,ak as x1,al as I1,am as S1,an as Ih,ao as P1,ap as C1,aq as A1,ar as O1,as as R1,at as T1,au as N1,av as Sh,aw as io,ax as F1,ay as qa,az as D1,aA as Ph,aB as L1,aC as $1}from"./index-93e0df7c.js";var co={},Bs={};Object.defineProperty(Bs,"__esModule",{value:!0});function j1(u){if(typeof u!="string")throw new Error(`Cannot safe json parse value of type ${typeof u}`);try{return JSON.parse(u)}catch{return u}}Bs.safeJsonParse=j1;function M1(u){return typeof u=="string"?u:JSON.stringify(u,(i,r)=>typeof r>"u"?null:r)}Bs.safeJsonStringify=M1;var Ts={exports:{}},Ch;function z1(){return Ch||(Ch=1,function(){let u;function i(){}u=i,u.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},u.prototype.setItem=function(r,n){this[r]=String(n)},u.prototype.removeItem=function(r){delete this[r]},u.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},u.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},u.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof dr<"u"&&dr.localStorage?Ts.exports=dr.localStorage:typeof window<"u"&&window.localStorage?Ts.exports=window.localStorage:Ts.exports=new i}()),Ts.exports}var Ua={},Ns={},Ah;function q1(){if(Ah)return Ns;Ah=1,Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.IKeyValueStorage=void 0;class u{}return Ns.IKeyValueStorage=u,Ns}var Fs={},Oh;function U1(){if(Oh)return Fs;Oh=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.parseEntry=void 0;const u=Bs;function i(r){var n;return[r[0],u.safeJsonParse((n=r[1])!==null&&n!==void 0?n:"")]}return Fs.parseEntry=i,Fs}var Rh;function H1(){return Rh||(Rh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0});const i=wi;i.__exportStar(q1(),u),i.__exportStar(U1(),u)}(Ua)),Ua}Object.defineProperty(co,"__esModule",{value:!0});co.KeyValueStorage=void 0;const hs=wi,Th=Bs,k1=hs.__importDefault(z1()),B1=H1();class Dl{constructor(){this.localStorage=k1.default}getKeys(){return hs.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return hs.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(B1.parseEntry)})}getItem(i){return hs.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(i);if(r!==null)return Th.safeJsonParse(r)})}setItem(i,r){return hs.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,Th.safeJsonStringify(r))})}removeItem(i){return hs.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}co.KeyValueStorage=Dl;var V1=co.default=Dl,Vs={},Ds={},Ha={},Ls={};let zi=class{};const K1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:zi},Symbol.toStringTag,{value:"Module"})),G1=Jy(K1);var Nh;function W1(){if(Nh)return Ls;Nh=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.IHeartBeat=void 0;const u=G1;class i extends u.IEvents{constructor(n){super()}}return Ls.IHeartBeat=i,Ls}var Fh;function Ll(){return Fh||(Fh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),wi.__exportStar(W1(),u)}(Ha)),Ha}var ka={},ji={},Dh;function J1(){if(Dh)return ji;Dh=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.HEARTBEAT_EVENTS=ji.HEARTBEAT_INTERVAL=void 0;const u=ae;return ji.HEARTBEAT_INTERVAL=u.FIVE_SECONDS,ji.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ji}var Lh;function $l(){return Lh||(Lh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),wi.__exportStar(J1(),u)}(ka)),ka}var $h;function Y1(){if($h)return Ds;$h=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.HeartBeat=void 0;const u=wi,i=Cr,r=ae,n=Ll(),o=$l();class l extends n.IHeartBeat{constructor(y){super(y),this.events=new i.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||o.HEARTBEAT_INTERVAL}static init(y){return u.__awaiter(this,void 0,void 0,function*(){const w=new l(y);return yield w.init(),w})}init(){return u.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,w){this.events.on(y,w)}once(y,w){this.events.once(y,w)}off(y,w){this.events.off(y,w)}removeListener(y,w){this.events.removeListener(y,w)}initialize(){return u.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Ds.HeartBeat=l,Ds}(function(u){Object.defineProperty(u,"__esModule",{value:!0});const i=wi;i.__exportStar(Y1(),u),i.__exportStar(Ll(),u),i.__exportStar($l(),u)})(Vs);var Ae={},Ba,jh;function X1(){if(jh)return Ba;jh=1;function u(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Ba=i;function i(r,n,o){var l=o&&o.stringify||u,g=1;if(typeof r=="object"&&r!==null){var y=n.length+g;if(y===1)return r;var w=new Array(y);w[0]=l(r);for(var S=1;S<y;S++)w[S]=l(n[S]);return w.join(" ")}if(typeof r!="string")return r;var M=n.length;if(M===0)return r;for(var K="",Y=1-g,G=-1,q=r&&r.length||0,U=0;U<q;){if(r.charCodeAt(U)===37&&U+1<q){switch(G=G>-1?G:0,r.charCodeAt(U+1)){case 100:case 102:if(Y>=M||n[Y]==null)break;G<U&&(K+=r.slice(G,U)),K+=Number(n[Y]),G=U+2,U++;break;case 105:if(Y>=M||n[Y]==null)break;G<U&&(K+=r.slice(G,U)),K+=Math.floor(Number(n[Y])),G=U+2,U++;break;case 79:case 111:case 106:if(Y>=M||n[Y]===void 0)break;G<U&&(K+=r.slice(G,U));var re=typeof n[Y];if(re==="string"){K+="'"+n[Y]+"'",G=U+2,U++;break}if(re==="function"){K+=n[Y].name||"<anonymous>",G=U+2,U++;break}K+=l(n[Y]),G=U+2,U++;break;case 115:if(Y>=M)break;G<U&&(K+=r.slice(G,U)),K+=String(n[Y]),G=U+2,U++;break;case 37:G<U&&(K+=r.slice(G,U)),K+="%",G=U+2,U++,Y--;break}++Y}++U}return G===-1?r:(G<q&&(K+=r.slice(G)),K)}return Ba}var Va,Mh;function Z1(){if(Mh)return Va;Mh=1;const u=X1();Va=o;const i=he().console||{},r={mapHttpRequest:q,mapHttpResponse:q,wrapRequestSerializer:U,wrapResponseSerializer:U,wrapErrorSerializer:U,req:q,res:q,err:Y};function n(R,j){return Array.isArray(R)?R.filter(function(ve){return ve!=="!stdSerializers.err"}):R===!0?Object.keys(j):!1}function o(R){R=R||{},R.browser=R.browser||{};const j=R.browser.transmit;if(j&&typeof j.send!="function")throw Error("pino: transmit option must have a send function");const V=R.browser.write||i;R.browser.write&&(R.browser.asObject=!0);const ve=R.serializers||{},te=n(R.browser.serialize,ve);let Ee=R.browser.serialize;Array.isArray(R.browser.serialize)&&R.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Oe=["error","fatal","warn","info","debug","trace"];typeof V=="function"&&(V.error=V.fatal=V.warn=V.info=V.debug=V.trace=V),R.enabled===!1&&(R.level="silent");const et=R.level||"info",C=Object.create(V);C.log||(C.log=re),Object.defineProperty(C,"levelVal",{get:ze}),Object.defineProperty(C,"level",{get:Re,set:W});const D={transmit:j,serialize:te,asObject:R.browser.asObject,levels:Oe,timestamp:G(R)};C.levels=o.levels,C.level=et,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=re,C.serializers=ve,C._serialize=te,C._stdErrSerialize=Ee,C.child=H,j&&(C._logEvent=K());function ze(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Re(){return this._level}function W(z){if(z!=="silent"&&!this.levels.values[z])throw Error("unknown level "+z);this._level=z,l(D,C,"error","log"),l(D,C,"fatal","error"),l(D,C,"warn","error"),l(D,C,"info","log"),l(D,C,"debug","log"),l(D,C,"trace","log")}function H(z,k){if(!z)throw new Error("missing bindings for child Pino");k=k||{},te&&z.serializers&&(k.serializers=z.serializers);const ct=k.serializers;if(te&&ct){var He=Object.assign({},ve,ct),Lr=R.browser.serialize===!0?Object.keys(He):te;delete z.serializers,w([z],Lr,He,this._stdErrSerialize)}function we(xt){this._childLevel=(xt._childLevel|0)+1,this.error=S(xt,z,"error"),this.fatal=S(xt,z,"fatal"),this.warn=S(xt,z,"warn"),this.info=S(xt,z,"info"),this.debug=S(xt,z,"debug"),this.trace=S(xt,z,"trace"),He&&(this.serializers=He,this._serialize=Lr),j&&(this._logEvent=K([].concat(xt._logEvent.bindings,z)))}return we.prototype=this,new we(this)}return C}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=r,o.stdTimeFunctions=Object.assign({},{nullTime:de,epochTime:ge,unixTime:pe,isoTime:ue});function l(R,j,V,ve){const te=Object.getPrototypeOf(j);j[V]=j.levelVal>j.levels.values[V]?re:te[V]?te[V]:i[V]||i[ve]||re,g(R,j,V)}function g(R,j,V){!R.transmit&&j[V]===re||(j[V]=function(ve){return function(){const Ee=R.timestamp(),Oe=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var C=0;C<Oe.length;C++)Oe[C]=arguments[C];if(R.serialize&&!R.asObject&&w(Oe,this._serialize,this.serializers,this._stdErrSerialize),R.asObject?ve.call(et,y(this,V,Oe,Ee)):ve.apply(et,Oe),R.transmit){const D=R.transmit.level||j.level,ze=o.levels.values[D],Re=o.levels.values[V];if(Re<ze)return;M(this,{ts:Ee,methodLevel:V,methodValue:Re,transmitLevel:D,transmitValue:o.levels.values[R.transmit.level||j.level],send:R.transmit.send,val:j.levelVal},Oe)}}}(j[V]))}function y(R,j,V,ve){R._serialize&&w(V,R._serialize,R.serializers,R._stdErrSerialize);const te=V.slice();let Ee=te[0];const Oe={};ve&&(Oe.time=ve),Oe.level=o.levels.values[j];let et=(R._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Oe,te.shift());Ee=te.length?u(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=u(te.shift(),te));return Ee!==void 0&&(Oe.msg=Ee),Oe}function w(R,j,V,ve){for(const te in R)if(ve&&R[te]instanceof Error)R[te]=o.stdSerializers.err(R[te]);else if(typeof R[te]=="object"&&!Array.isArray(R[te]))for(const Ee in R[te])j&&j.indexOf(Ee)>-1&&Ee in V&&(R[te][Ee]=V[Ee](R[te][Ee]))}function S(R,j,V){return function(){const ve=new Array(1+arguments.length);ve[0]=j;for(var te=1;te<ve.length;te++)ve[te]=arguments[te-1];return R[V].apply(this,ve)}}function M(R,j,V){const ve=j.send,te=j.ts,Ee=j.methodLevel,Oe=j.methodValue,et=j.val,C=R._logEvent.bindings;w(V,R._serialize||Object.keys(R.serializers),R.serializers,R._stdErrSerialize===void 0?!0:R._stdErrSerialize),R._logEvent.ts=te,R._logEvent.messages=V.filter(function(D){return C.indexOf(D)===-1}),R._logEvent.level.label=Ee,R._logEvent.level.value=Oe,ve(Ee,R._logEvent,et),R._logEvent=K(C)}function K(R){return{ts:0,messages:[],bindings:R||[],level:{label:"",value:0}}}function Y(R){const j={type:R.constructor.name,msg:R.message,stack:R.stack};for(const V in R)j[V]===void 0&&(j[V]=R[V]);return j}function G(R){return typeof R.timestamp=="function"?R.timestamp:R.timestamp===!1?de:ge}function q(){return{}}function U(R){return R}function re(){}function de(){return!1}function ge(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function R(j){return typeof j<"u"&&j}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return R(self)||R(window)||R(this)||{}}}return Va}var Mi={},zh;function jl(){return zh||(zh=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.PINO_CUSTOM_CONTEXT_KEY=Mi.PINO_LOGGER_DEFAULTS=void 0,Mi.PINO_LOGGER_DEFAULTS={level:"info"},Mi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Mi}var Qt={},qh;function Q1(){if(qh)return Qt;qh=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.generateChildLogger=Qt.formatChildLoggerContext=Qt.getLoggerContext=Qt.setBrowserLoggerContext=Qt.getBrowserLoggerContext=Qt.getDefaultLoggerOptions=void 0;const u=jl();function i(y){return Object.assign(Object.assign({},y),{level:(y==null?void 0:y.level)||u.PINO_LOGGER_DEFAULTS.level})}Qt.getDefaultLoggerOptions=i;function r(y,w=u.PINO_CUSTOM_CONTEXT_KEY){return y[w]||""}Qt.getBrowserLoggerContext=r;function n(y,w,S=u.PINO_CUSTOM_CONTEXT_KEY){return y[S]=w,y}Qt.setBrowserLoggerContext=n;function o(y,w=u.PINO_CUSTOM_CONTEXT_KEY){let S="";return typeof y.bindings>"u"?S=r(y,w):S=y.bindings().context||"",S}Qt.getLoggerContext=o;function l(y,w,S=u.PINO_CUSTOM_CONTEXT_KEY){const M=o(y,S);return M.trim()?`${M}/${w}`:w}Qt.formatChildLoggerContext=l;function g(y,w,S=u.PINO_CUSTOM_CONTEXT_KEY){const M=l(y,w,S),K=y.child({context:M});return n(K,M,S)}return Qt.generateChildLogger=g,Qt}(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.pino=void 0;const i=wi,r=i.__importDefault(Z1());Object.defineProperty(u,"pino",{enumerable:!0,get:function(){return r.default}}),i.__exportStar(jl(),u),i.__exportStar(Q1(),u)})(Ae);class em extends zi{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class tm extends zi{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class rm{constructor(i,r){this.logger=i,this.core=r}}let im=class extends zi{constructor(i,r){super(),this.relayer=i,this.logger=r}},sm=class extends zi{constructor(i){super()}},nm=class{constructor(i,r,n,o){this.core=i,this.logger=r,this.name=n}};class om extends zi{constructor(i,r){super(),this.relayer=i,this.logger=r}}class am extends zi{constructor(i,r){super(),this.core=i,this.logger=r}}let cm=class{constructor(i,r){this.projectId=i,this.logger=r}},um=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}};class hm{constructor(i){this.client=i}}const lm=u=>JSON.stringify(u,(i,r)=>typeof r=="bigint"?r.toString()+"n":r),fm=u=>{const i=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=u.replace(i,'$1"$2n"$3');return JSON.parse(r,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function pc(u){if(typeof u!="string")throw new Error(`Cannot safe json parse value of type ${typeof u}`);try{return fm(u)}catch{return u}}function ks(u){return typeof u=="string"?u:lm(u)||""}var dc={},Ml={};(function(u){Object.defineProperty(u,"__esModule",{value:!0});var i=Yy,r=Cl;u.DIGEST_LENGTH=64,u.BLOCK_SIZE=128;var n=function(){function y(){this.digestLength=u.DIGEST_LENGTH,this.blockSize=u.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(w,S){if(S===void 0&&(S=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var M=0;if(this._bytesHashed+=S,this._bufferLength>0){for(;this._bufferLength<u.BLOCK_SIZE&&S>0;)this._buffer[this._bufferLength++]=w[M++],S--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(S>=this.blockSize&&(M=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,M,S),S%=this.blockSize);S>0;)this._buffer[this._bufferLength++]=w[M++],S--;return this},y.prototype.finish=function(w){if(!this._finished){var S=this._bytesHashed,M=this._bufferLength,K=S/536870912|0,Y=S<<3,G=S%128<112?128:256;this._buffer[M]=128;for(var q=M+1;q<G-8;q++)this._buffer[q]=0;i.writeUint32BE(K,this._buffer,G-8),i.writeUint32BE(Y,this._buffer,G-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,G),this._finished=!0}for(var q=0;q<this.digestLength/8;q++)i.writeUint32BE(this._stateHi[q],w,q*8),i.writeUint32BE(this._stateLo[q],w,q*8+4);return this},y.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(w){r.wipe(w.stateHi),r.wipe(w.stateLo),w.buffer&&r.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},y}();u.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(y,w,S,M,K,Y,G){for(var q=S[0],U=S[1],re=S[2],de=S[3],ge=S[4],pe=S[5],ue=S[6],he=S[7],R=M[0],j=M[1],V=M[2],ve=M[3],te=M[4],Ee=M[5],Oe=M[6],et=M[7],C,D,ze,Re,W,H,z,k;G>=128;){for(var ct=0;ct<16;ct++){var He=8*ct+Y;y[ct]=i.readUint32BE(K,He),w[ct]=i.readUint32BE(K,He+4)}for(var ct=0;ct<80;ct++){var Lr=q,we=U,xt=re,O=de,A=ge,I=pe,c=ue,_=he,Q=R,oe=j,me=V,Te=ve,Fe=te,Ie=Ee,It=Oe,yt=et;if(C=he,D=et,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=(ge>>>14|te<<32-14)^(ge>>>18|te<<32-18)^(te>>>41-32|ge<<32-(41-32)),D=(te>>>14|ge<<32-14)^(te>>>18|ge<<32-18)^(ge>>>41-32|te<<32-(41-32)),W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,C=ge&pe^~ge&ue,D=te&Ee^~te&Oe,W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,C=o[ct*2],D=o[ct*2+1],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,C=y[ct%16],D=w[ct%16],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,ze=z&65535|k<<16,Re=W&65535|H<<16,C=ze,D=Re,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=(q>>>28|R<<32-28)^(R>>>34-32|q<<32-(34-32))^(R>>>39-32|q<<32-(39-32)),D=(R>>>28|q<<32-28)^(q>>>34-32|R<<32-(34-32))^(q>>>39-32|R<<32-(39-32)),W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,C=q&U^q&re^U&re,D=R&j^R&V^j&V,W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,_=z&65535|k<<16,yt=W&65535|H<<16,C=O,D=Te,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=ze,D=Re,W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,O=z&65535|k<<16,Te=W&65535|H<<16,U=Lr,re=we,de=xt,ge=O,pe=A,ue=I,he=c,q=_,j=Q,V=oe,ve=me,te=Te,Ee=Fe,Oe=Ie,et=It,R=yt,ct%16===15)for(var He=0;He<16;He++)C=y[He],D=w[He],W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=y[(He+9)%16],D=w[(He+9)%16],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,ze=y[(He+1)%16],Re=w[(He+1)%16],C=(ze>>>1|Re<<32-1)^(ze>>>8|Re<<32-8)^ze>>>7,D=(Re>>>1|ze<<32-1)^(Re>>>8|ze<<32-8)^(Re>>>7|ze<<32-7),W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,ze=y[(He+14)%16],Re=w[(He+14)%16],C=(ze>>>19|Re<<32-19)^(Re>>>61-32|ze<<32-(61-32))^ze>>>6,D=(Re>>>19|ze<<32-19)^(ze>>>61-32|Re<<32-(61-32))^(Re>>>6|ze<<32-6),W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,y[He]=z&65535|k<<16,w[He]=W&65535|H<<16}C=q,D=R,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[0],D=M[0],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[0]=q=z&65535|k<<16,M[0]=R=W&65535|H<<16,C=U,D=j,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[1],D=M[1],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[1]=U=z&65535|k<<16,M[1]=j=W&65535|H<<16,C=re,D=V,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[2],D=M[2],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[2]=re=z&65535|k<<16,M[2]=V=W&65535|H<<16,C=de,D=ve,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[3],D=M[3],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[3]=de=z&65535|k<<16,M[3]=ve=W&65535|H<<16,C=ge,D=te,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[4],D=M[4],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[4]=ge=z&65535|k<<16,M[4]=te=W&65535|H<<16,C=pe,D=Ee,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[5],D=M[5],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[5]=pe=z&65535|k<<16,M[5]=Ee=W&65535|H<<16,C=ue,D=Oe,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[6],D=M[6],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[6]=ue=z&65535|k<<16,M[6]=Oe=W&65535|H<<16,C=he,D=et,W=D&65535,H=D>>>16,z=C&65535,k=C>>>16,C=S[7],D=M[7],W+=D&65535,H+=D>>>16,z+=C&65535,k+=C>>>16,H+=W>>>16,z+=H>>>16,k+=z>>>16,S[7]=he=z&65535|k<<16,M[7]=et=W&65535|H<<16,Y+=128,G-=128}return Y}function g(y){var w=new n;w.update(y);var S=w.digest();return w.clean(),S}u.hash=g})(Ml);(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.convertSecretKeyToX25519=u.convertPublicKeyToX25519=u.verify=u.sign=u.extractPublicKeyFromSecretKey=u.generateKeyPair=u.generateKeyPairFromSeed=u.SEED_LENGTH=u.SECRET_KEY_LENGTH=u.PUBLIC_KEY_LENGTH=u.SIGNATURE_LENGTH=void 0;const i=Al,r=Ml,n=Cl;u.SIGNATURE_LENGTH=64,u.PUBLIC_KEY_LENGTH=32,u.SECRET_KEY_LENGTH=64,u.SEED_LENGTH=32;function o(O){const A=new Float64Array(16);if(O)for(let I=0;I<O.length;I++)A[I]=O[I];return A}const l=new Uint8Array(32);l[0]=9;const g=o(),y=o([1]),w=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),S=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),M=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),K=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),Y=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function G(O,A){for(let I=0;I<16;I++)O[I]=A[I]|0}function q(O){let A=1;for(let I=0;I<16;I++){let c=O[I]+A+65535;A=Math.floor(c/65536),O[I]=c-A*65536}O[0]+=A-1+37*(A-1)}function U(O,A,I){const c=~(I-1);for(let _=0;_<16;_++){const Q=c&(O[_]^A[_]);O[_]^=Q,A[_]^=Q}}function re(O,A){const I=o(),c=o();for(let _=0;_<16;_++)c[_]=A[_];q(c),q(c),q(c);for(let _=0;_<2;_++){I[0]=c[0]-65517;for(let oe=1;oe<15;oe++)I[oe]=c[oe]-65535-(I[oe-1]>>16&1),I[oe-1]&=65535;I[15]=c[15]-32767-(I[14]>>16&1);const Q=I[15]>>16&1;I[14]&=65535,U(c,I,1-Q)}for(let _=0;_<16;_++)O[2*_]=c[_]&255,O[2*_+1]=c[_]>>8}function de(O,A){let I=0;for(let c=0;c<32;c++)I|=O[c]^A[c];return(1&I-1>>>8)-1}function ge(O,A){const I=new Uint8Array(32),c=new Uint8Array(32);return re(I,O),re(c,A),de(I,c)}function pe(O){const A=new Uint8Array(32);return re(A,O),A[0]&1}function ue(O,A){for(let I=0;I<16;I++)O[I]=A[2*I]+(A[2*I+1]<<8);O[15]&=32767}function he(O,A,I){for(let c=0;c<16;c++)O[c]=A[c]+I[c]}function R(O,A,I){for(let c=0;c<16;c++)O[c]=A[c]-I[c]}function j(O,A,I){let c,_,Q=0,oe=0,me=0,Te=0,Fe=0,Ie=0,It=0,yt=0,st=0,Le=0,Je=0,Ye=0,nt=0,qe=0,Xe=0,Ne=0,ke=0,ut=0,je=0,St=0,Lt=0,Ut=0,Ht=0,Mt=0,Gt=0,tr=0,$r=0,Wt=0,Vr=0,oi=0,xi=0,ht=I[0],tt=I[1],lt=I[2],ft=I[3],ot=I[4],rt=I[5],Pt=I[6],Ct=I[7],pt=I[8],At=I[9],dt=I[10],mt=I[11],gt=I[12],We=I[13],Ot=I[14],Rt=I[15];c=A[0],Q+=c*ht,oe+=c*tt,me+=c*lt,Te+=c*ft,Fe+=c*ot,Ie+=c*rt,It+=c*Pt,yt+=c*Ct,st+=c*pt,Le+=c*At,Je+=c*dt,Ye+=c*mt,nt+=c*gt,qe+=c*We,Xe+=c*Ot,Ne+=c*Rt,c=A[1],oe+=c*ht,me+=c*tt,Te+=c*lt,Fe+=c*ft,Ie+=c*ot,It+=c*rt,yt+=c*Pt,st+=c*Ct,Le+=c*pt,Je+=c*At,Ye+=c*dt,nt+=c*mt,qe+=c*gt,Xe+=c*We,Ne+=c*Ot,ke+=c*Rt,c=A[2],me+=c*ht,Te+=c*tt,Fe+=c*lt,Ie+=c*ft,It+=c*ot,yt+=c*rt,st+=c*Pt,Le+=c*Ct,Je+=c*pt,Ye+=c*At,nt+=c*dt,qe+=c*mt,Xe+=c*gt,Ne+=c*We,ke+=c*Ot,ut+=c*Rt,c=A[3],Te+=c*ht,Fe+=c*tt,Ie+=c*lt,It+=c*ft,yt+=c*ot,st+=c*rt,Le+=c*Pt,Je+=c*Ct,Ye+=c*pt,nt+=c*At,qe+=c*dt,Xe+=c*mt,Ne+=c*gt,ke+=c*We,ut+=c*Ot,je+=c*Rt,c=A[4],Fe+=c*ht,Ie+=c*tt,It+=c*lt,yt+=c*ft,st+=c*ot,Le+=c*rt,Je+=c*Pt,Ye+=c*Ct,nt+=c*pt,qe+=c*At,Xe+=c*dt,Ne+=c*mt,ke+=c*gt,ut+=c*We,je+=c*Ot,St+=c*Rt,c=A[5],Ie+=c*ht,It+=c*tt,yt+=c*lt,st+=c*ft,Le+=c*ot,Je+=c*rt,Ye+=c*Pt,nt+=c*Ct,qe+=c*pt,Xe+=c*At,Ne+=c*dt,ke+=c*mt,ut+=c*gt,je+=c*We,St+=c*Ot,Lt+=c*Rt,c=A[6],It+=c*ht,yt+=c*tt,st+=c*lt,Le+=c*ft,Je+=c*ot,Ye+=c*rt,nt+=c*Pt,qe+=c*Ct,Xe+=c*pt,Ne+=c*At,ke+=c*dt,ut+=c*mt,je+=c*gt,St+=c*We,Lt+=c*Ot,Ut+=c*Rt,c=A[7],yt+=c*ht,st+=c*tt,Le+=c*lt,Je+=c*ft,Ye+=c*ot,nt+=c*rt,qe+=c*Pt,Xe+=c*Ct,Ne+=c*pt,ke+=c*At,ut+=c*dt,je+=c*mt,St+=c*gt,Lt+=c*We,Ut+=c*Ot,Ht+=c*Rt,c=A[8],st+=c*ht,Le+=c*tt,Je+=c*lt,Ye+=c*ft,nt+=c*ot,qe+=c*rt,Xe+=c*Pt,Ne+=c*Ct,ke+=c*pt,ut+=c*At,je+=c*dt,St+=c*mt,Lt+=c*gt,Ut+=c*We,Ht+=c*Ot,Mt+=c*Rt,c=A[9],Le+=c*ht,Je+=c*tt,Ye+=c*lt,nt+=c*ft,qe+=c*ot,Xe+=c*rt,Ne+=c*Pt,ke+=c*Ct,ut+=c*pt,je+=c*At,St+=c*dt,Lt+=c*mt,Ut+=c*gt,Ht+=c*We,Mt+=c*Ot,Gt+=c*Rt,c=A[10],Je+=c*ht,Ye+=c*tt,nt+=c*lt,qe+=c*ft,Xe+=c*ot,Ne+=c*rt,ke+=c*Pt,ut+=c*Ct,je+=c*pt,St+=c*At,Lt+=c*dt,Ut+=c*mt,Ht+=c*gt,Mt+=c*We,Gt+=c*Ot,tr+=c*Rt,c=A[11],Ye+=c*ht,nt+=c*tt,qe+=c*lt,Xe+=c*ft,Ne+=c*ot,ke+=c*rt,ut+=c*Pt,je+=c*Ct,St+=c*pt,Lt+=c*At,Ut+=c*dt,Ht+=c*mt,Mt+=c*gt,Gt+=c*We,tr+=c*Ot,$r+=c*Rt,c=A[12],nt+=c*ht,qe+=c*tt,Xe+=c*lt,Ne+=c*ft,ke+=c*ot,ut+=c*rt,je+=c*Pt,St+=c*Ct,Lt+=c*pt,Ut+=c*At,Ht+=c*dt,Mt+=c*mt,Gt+=c*gt,tr+=c*We,$r+=c*Ot,Wt+=c*Rt,c=A[13],qe+=c*ht,Xe+=c*tt,Ne+=c*lt,ke+=c*ft,ut+=c*ot,je+=c*rt,St+=c*Pt,Lt+=c*Ct,Ut+=c*pt,Ht+=c*At,Mt+=c*dt,Gt+=c*mt,tr+=c*gt,$r+=c*We,Wt+=c*Ot,Vr+=c*Rt,c=A[14],Xe+=c*ht,Ne+=c*tt,ke+=c*lt,ut+=c*ft,je+=c*ot,St+=c*rt,Lt+=c*Pt,Ut+=c*Ct,Ht+=c*pt,Mt+=c*At,Gt+=c*dt,tr+=c*mt,$r+=c*gt,Wt+=c*We,Vr+=c*Ot,oi+=c*Rt,c=A[15],Ne+=c*ht,ke+=c*tt,ut+=c*lt,je+=c*ft,St+=c*ot,Lt+=c*rt,Ut+=c*Pt,Ht+=c*Ct,Mt+=c*pt,Gt+=c*At,tr+=c*dt,$r+=c*mt,Wt+=c*gt,Vr+=c*We,oi+=c*Ot,xi+=c*Rt,Q+=38*ke,oe+=38*ut,me+=38*je,Te+=38*St,Fe+=38*Lt,Ie+=38*Ut,It+=38*Ht,yt+=38*Mt,st+=38*Gt,Le+=38*tr,Je+=38*$r,Ye+=38*Wt,nt+=38*Vr,qe+=38*oi,Xe+=38*xi,_=1,c=Q+_+65535,_=Math.floor(c/65536),Q=c-_*65536,c=oe+_+65535,_=Math.floor(c/65536),oe=c-_*65536,c=me+_+65535,_=Math.floor(c/65536),me=c-_*65536,c=Te+_+65535,_=Math.floor(c/65536),Te=c-_*65536,c=Fe+_+65535,_=Math.floor(c/65536),Fe=c-_*65536,c=Ie+_+65535,_=Math.floor(c/65536),Ie=c-_*65536,c=It+_+65535,_=Math.floor(c/65536),It=c-_*65536,c=yt+_+65535,_=Math.floor(c/65536),yt=c-_*65536,c=st+_+65535,_=Math.floor(c/65536),st=c-_*65536,c=Le+_+65535,_=Math.floor(c/65536),Le=c-_*65536,c=Je+_+65535,_=Math.floor(c/65536),Je=c-_*65536,c=Ye+_+65535,_=Math.floor(c/65536),Ye=c-_*65536,c=nt+_+65535,_=Math.floor(c/65536),nt=c-_*65536,c=qe+_+65535,_=Math.floor(c/65536),qe=c-_*65536,c=Xe+_+65535,_=Math.floor(c/65536),Xe=c-_*65536,c=Ne+_+65535,_=Math.floor(c/65536),Ne=c-_*65536,Q+=_-1+37*(_-1),_=1,c=Q+_+65535,_=Math.floor(c/65536),Q=c-_*65536,c=oe+_+65535,_=Math.floor(c/65536),oe=c-_*65536,c=me+_+65535,_=Math.floor(c/65536),me=c-_*65536,c=Te+_+65535,_=Math.floor(c/65536),Te=c-_*65536,c=Fe+_+65535,_=Math.floor(c/65536),Fe=c-_*65536,c=Ie+_+65535,_=Math.floor(c/65536),Ie=c-_*65536,c=It+_+65535,_=Math.floor(c/65536),It=c-_*65536,c=yt+_+65535,_=Math.floor(c/65536),yt=c-_*65536,c=st+_+65535,_=Math.floor(c/65536),st=c-_*65536,c=Le+_+65535,_=Math.floor(c/65536),Le=c-_*65536,c=Je+_+65535,_=Math.floor(c/65536),Je=c-_*65536,c=Ye+_+65535,_=Math.floor(c/65536),Ye=c-_*65536,c=nt+_+65535,_=Math.floor(c/65536),nt=c-_*65536,c=qe+_+65535,_=Math.floor(c/65536),qe=c-_*65536,c=Xe+_+65535,_=Math.floor(c/65536),Xe=c-_*65536,c=Ne+_+65535,_=Math.floor(c/65536),Ne=c-_*65536,Q+=_-1+37*(_-1),O[0]=Q,O[1]=oe,O[2]=me,O[3]=Te,O[4]=Fe,O[5]=Ie,O[6]=It,O[7]=yt,O[8]=st,O[9]=Le,O[10]=Je,O[11]=Ye,O[12]=nt,O[13]=qe,O[14]=Xe,O[15]=Ne}function V(O,A){j(O,A,A)}function ve(O,A){const I=o();let c;for(c=0;c<16;c++)I[c]=A[c];for(c=253;c>=0;c--)V(I,I),c!==2&&c!==4&&j(I,I,A);for(c=0;c<16;c++)O[c]=I[c]}function te(O,A){const I=o();let c;for(c=0;c<16;c++)I[c]=A[c];for(c=250;c>=0;c--)V(I,I),c!==1&&j(I,I,A);for(c=0;c<16;c++)O[c]=I[c]}function Ee(O,A){const I=o(),c=o(),_=o(),Q=o(),oe=o(),me=o(),Te=o(),Fe=o(),Ie=o();R(I,O[1],O[0]),R(Ie,A[1],A[0]),j(I,I,Ie),he(c,O[0],O[1]),he(Ie,A[0],A[1]),j(c,c,Ie),j(_,O[3],A[3]),j(_,_,S),j(Q,O[2],A[2]),he(Q,Q,Q),R(oe,c,I),R(me,Q,_),he(Te,Q,_),he(Fe,c,I),j(O[0],oe,me),j(O[1],Fe,Te),j(O[2],Te,me),j(O[3],oe,Fe)}function Oe(O,A,I){for(let c=0;c<4;c++)U(O[c],A[c],I)}function et(O,A){const I=o(),c=o(),_=o();ve(_,A[2]),j(I,A[0],_),j(c,A[1],_),re(O,c),O[31]^=pe(I)<<7}function C(O,A,I){G(O[0],g),G(O[1],y),G(O[2],y),G(O[3],g);for(let c=255;c>=0;--c){const _=I[c/8|0]>>(c&7)&1;Oe(O,A,_),Ee(A,O),Ee(O,O),Oe(O,A,_)}}function D(O,A){const I=[o(),o(),o(),o()];G(I[0],M),G(I[1],K),G(I[2],y),j(I[3],M,K),C(O,I,A)}function ze(O){if(O.length!==u.SEED_LENGTH)throw new Error(`ed25519: seed must be ${u.SEED_LENGTH} bytes`);const A=(0,r.hash)(O);A[0]&=248,A[31]&=127,A[31]|=64;const I=new Uint8Array(32),c=[o(),o(),o(),o()];D(c,A),et(I,c);const _=new Uint8Array(64);return _.set(O),_.set(I,32),{publicKey:I,secretKey:_}}u.generateKeyPairFromSeed=ze;function Re(O){const A=(0,i.randomBytes)(32,O),I=ze(A);return(0,n.wipe)(A),I}u.generateKeyPair=Re;function W(O){if(O.length!==u.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${u.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}u.extractPublicKeyFromSecretKey=W;const H=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function z(O,A){let I,c,_,Q;for(c=63;c>=32;--c){for(I=0,_=c-32,Q=c-12;_<Q;++_)A[_]+=I-16*A[c]*H[_-(c-32)],I=Math.floor((A[_]+128)/256),A[_]-=I*256;A[_]+=I,A[c]=0}for(I=0,_=0;_<32;_++)A[_]+=I-(A[31]>>4)*H[_],I=A[_]>>8,A[_]&=255;for(_=0;_<32;_++)A[_]-=I*H[_];for(c=0;c<32;c++)A[c+1]+=A[c]>>8,O[c]=A[c]&255}function k(O){const A=new Float64Array(64);for(let I=0;I<64;I++)A[I]=O[I];for(let I=0;I<64;I++)O[I]=0;z(O,A)}function ct(O,A){const I=new Float64Array(64),c=[o(),o(),o(),o()],_=(0,r.hash)(O.subarray(0,32));_[0]&=248,_[31]&=127,_[31]|=64;const Q=new Uint8Array(64);Q.set(_.subarray(32),32);const oe=new r.SHA512;oe.update(Q.subarray(32)),oe.update(A);const me=oe.digest();oe.clean(),k(me),D(c,me),et(Q,c),oe.reset(),oe.update(Q.subarray(0,32)),oe.update(O.subarray(32)),oe.update(A);const Te=oe.digest();k(Te);for(let Fe=0;Fe<32;Fe++)I[Fe]=me[Fe];for(let Fe=0;Fe<32;Fe++)for(let Ie=0;Ie<32;Ie++)I[Fe+Ie]+=Te[Fe]*_[Ie];return z(Q.subarray(32),I),Q}u.sign=ct;function He(O,A){const I=o(),c=o(),_=o(),Q=o(),oe=o(),me=o(),Te=o();return G(O[2],y),ue(O[1],A),V(_,O[1]),j(Q,_,w),R(_,_,O[2]),he(Q,O[2],Q),V(oe,Q),V(me,oe),j(Te,me,oe),j(I,Te,_),j(I,I,Q),te(I,I),j(I,I,_),j(I,I,Q),j(I,I,Q),j(O[0],I,Q),V(c,O[0]),j(c,c,Q),ge(c,_)&&j(O[0],O[0],Y),V(c,O[0]),j(c,c,Q),ge(c,_)?-1:(pe(O[0])===A[31]>>7&&R(O[0],g,O[0]),j(O[3],O[0],O[1]),0)}function Lr(O,A,I){const c=new Uint8Array(32),_=[o(),o(),o(),o()],Q=[o(),o(),o(),o()];if(I.length!==u.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${u.SIGNATURE_LENGTH} bytes`);if(He(Q,O))return!1;const oe=new r.SHA512;oe.update(I.subarray(0,32)),oe.update(O),oe.update(A);const me=oe.digest();return k(me),C(_,Q,me),D(Q,I.subarray(32)),Ee(_,Q),et(c,_),!de(I,c)}u.verify=Lr;function we(O){let A=[o(),o(),o(),o()];if(He(A,O))throw new Error("Ed25519: invalid public key");let I=o(),c=o(),_=A[1];he(I,y,_),R(c,y,_),ve(c,c),j(I,I,c);let Q=new Uint8Array(32);return re(Q,I),Q}u.convertPublicKeyToX25519=we;function xt(O){const A=(0,r.hash)(O.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const I=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),I}u.convertSecretKeyToX25519=xt})(dc);const pm="EdDSA",dm="JWT",zl=".",ql="base64url",gm="utf8",vm="utf8",ym=":",mm="did",_m="key",Uh="base58btc",wm="z",bm="K36",Em=32;function no(u){return ao(lc(ks(u),gm),ql)}function Ul(u){const i=lc(bm,Uh),r=wm+ao(Xy([i,u]),Uh);return[mm,_m,r].join(ym)}function xm(u){return ao(u,ql)}function Im(u){return lc([no(u.header),no(u.payload)].join(zl),vm)}function Sm(u){return[no(u.header),no(u.payload),xm(u.signature)].join(zl)}function Hh(u=Al.randomBytes(Em)){return dc.generateKeyPairFromSeed(u)}async function Pm(u,i,r,n,o=ae.fromMiliseconds(Date.now())){const l={alg:pm,typ:dm},g=Ul(n.publicKey),y=o+r,w={iss:g,sub:u,aud:i,iat:o,exp:y},S=Im({header:l,payload:w}),M=dc.sign(n.secretKey,S);return Sm({header:l,payload:w,signature:M})}const Cm="PARSE_ERROR",Am="INVALID_REQUEST",Om="METHOD_NOT_FOUND",Rm="INVALID_PARAMS",Hl="INTERNAL_ERROR",gc="SERVER_ERROR",Tm=[-32700,-32600,-32601,-32602,-32603],Us={[Cm]:{code:-32700,message:"Parse error"},[Am]:{code:-32600,message:"Invalid Request"},[Om]:{code:-32601,message:"Method not found"},[Rm]:{code:-32602,message:"Invalid params"},[Hl]:{code:-32603,message:"Internal error"},[gc]:{code:-32e3,message:"Server error"}},kl=gc;function Nm(u){return Tm.includes(u)}function kh(u){return Object.keys(Us).includes(u)?Us[u]:Us[kl]}function Fm(u){const i=Object.values(Us).find(r=>r.code===u);return i||Us[kl]}function Bl(u,i,r){return u.message.includes("getaddrinfo ENOTFOUND")||u.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${i}`):u}var Vl={},ii={},Bh;function Dm(){if(Bh)return ii;Bh=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.isBrowserCryptoAvailable=ii.getSubtleCrypto=ii.getBrowerCrypto=void 0;function u(){return(dr===null||dr===void 0?void 0:dr.crypto)||(dr===null||dr===void 0?void 0:dr.msCrypto)||{}}ii.getBrowerCrypto=u;function i(){const n=u();return n.subtle||n.webkitSubtle}ii.getSubtleCrypto=i;function r(){return!!u()&&!!i()}return ii.isBrowserCryptoAvailable=r,ii}var si={},Vh;function Lm(){if(Vh)return si;Vh=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowser=si.isNode=si.isReactNative=void 0;function u(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}si.isReactNative=u;function i(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}si.isNode=i;function r(){return!u()&&!i()}return si.isBrowser=r,si}(function(u){Object.defineProperty(u,"__esModule",{value:!0});const i=wi;i.__exportStar(Dm(),u),i.__exportStar(Lm(),u)})(Vl);function Kl(u=3){const i=Date.now()*Math.pow(10,u),r=Math.floor(Math.random()*Math.pow(10,u));return i+r}function Gl(u=6){return BigInt(Kl(u))}function uo(u,i,r){return{id:r||Kl(),jsonrpc:"2.0",method:u,params:i}}function vc(u,i){return{id:u,jsonrpc:"2.0",result:i}}function ho(u,i,r){return{id:u,jsonrpc:"2.0",error:$m(i,r)}}function $m(u,i){return typeof u>"u"?kh(Hl):(typeof u=="string"&&(u=Object.assign(Object.assign({},kh(gc)),{message:u})),typeof i<"u"&&(u.data=i),Nm(u.code)&&(u=Fm(u.code)),u)}class jm{}class Mm extends jm{constructor(){super()}}class zm extends Mm{constructor(i){super()}}const qm="^https?:",Um="^wss?:";function Hm(u){const i=u.match(new RegExp(/^\w+:/,"gi"));if(!(!i||!i.length))return i[0]}function Wl(u,i){const r=Hm(u);return typeof r>"u"?!1:new RegExp(i).test(r)}function Kh(u){return Wl(u,qm)}function Gh(u){return Wl(u,Um)}function km(u){return new RegExp("wss?://localhost(:d{2,5})?").test(u)}function Jl(u){return typeof u=="object"&&"id"in u&&"jsonrpc"in u&&u.jsonrpc==="2.0"}function yc(u){return Jl(u)&&"method"in u}function lo(u){return Jl(u)&&(ni(u)||Dr(u))}function ni(u){return"result"in u}function Dr(u){return"error"in u}class bi extends zm{constructor(i){super(i),this.events=new Cr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(i),this.connection.connected&&this.registerEventListeners()}async connect(i=this.connection){await this.open(i)}async disconnect(){await this.close()}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async request(i,r){return this.requestStrict(uo(i.method,i.params||[],i.id||Gl().toString()),r)}async requestStrict(i,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(l){o(l)}this.events.on(`${i.id}`,l=>{Dr(l)?o(l.error):n(l.result)});try{await this.connection.send(i,r)}catch(l){o(l)}})}setConnection(i=this.connection){return i}onPayload(i){this.events.emit("payload",i),lo(i)?this.events.emit(`${i.id}`,i):this.events.emit("message",{type:i.method,data:i.params})}onClose(i){i&&i.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${i.code} ${i.reason?`(${i.reason})`:""}`)),this.events.emit("disconnect")}async open(i=this.connection){this.connection===i&&this.connection.connected||(this.connection.connected&&this.close(),typeof i=="string"&&(await this.connection.open(i),i=this.connection),this.connection=this.setConnection(i),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",i=>this.onPayload(i)),this.connection.on("close",i=>this.onClose(i)),this.connection.on("error",i=>this.events.emit("error",i)),this.connection.on("register_error",i=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Wh=10,Bm=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Vm=()=>typeof window<"u",Km=Bm();class Gm{constructor(i){if(this.url=i,this.events=new Cr.EventEmitter,this.registering=!1,!Gh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ks(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!Gh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,n)=>{const o=Vl.isReactNative()?void 0:{rejectUnauthorized:!km(i)},l=new Km(i,[],o);Vm()?l.onerror=g=>{const y=g;n(this.emitError(y.error))}:l.on("error",g=>{n(this.emitError(g))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?pc(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),o=n.message||n.toString(),l=ho(i,o);this.events.emit("payload",l)}parseError(i,r=this.url){return Bl(i,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>Wh&&this.events.setMaxListeners(Wh)}emitError(i){const r=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var oo={exports:{}};oo.exports;(function(u,i){var r=200,n="__lodash_hash_undefined__",o=1,l=2,g=9007199254740991,y="[object Arguments]",w="[object Array]",S="[object AsyncFunction]",M="[object Boolean]",K="[object Date]",Y="[object Error]",G="[object Function]",q="[object GeneratorFunction]",U="[object Map]",re="[object Number]",de="[object Null]",ge="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",R="[object Set]",j="[object String]",V="[object Symbol]",ve="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Oe="[object DataView]",et="[object Float32Array]",C="[object Float64Array]",D="[object Int8Array]",ze="[object Int16Array]",Re="[object Int32Array]",W="[object Uint8Array]",H="[object Uint8ClampedArray]",z="[object Uint16Array]",k="[object Uint32Array]",ct=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,Lr=/^(?:0|[1-9]\d*)$/,we={};we[et]=we[C]=we[D]=we[ze]=we[Re]=we[W]=we[H]=we[z]=we[k]=!0,we[y]=we[w]=we[Ee]=we[M]=we[Oe]=we[K]=we[Y]=we[G]=we[U]=we[re]=we[ge]=we[he]=we[R]=we[j]=we[te]=!1;var xt=typeof dr=="object"&&dr&&dr.Object===Object&&dr,O=typeof self=="object"&&self&&self.Object===Object&&self,A=xt||O||Function("return this")(),I=i&&!i.nodeType&&i,c=I&&!0&&u&&!u.nodeType&&u,_=c&&c.exports===I,Q=_&&xt.process,oe=function(){try{return Q&&Q.binding&&Q.binding("util")}catch{}}(),me=oe&&oe.isTypedArray;function Te(d,b){for(var L=-1,J=d==null?0:d.length,Ve=0,le=[];++L<J;){var Ze=d[L];b(Ze,L,d)&&(le[Ve++]=Ze)}return le}function Fe(d,b){for(var L=-1,J=b.length,Ve=d.length;++L<J;)d[Ve+L]=b[L];return d}function Ie(d,b){for(var L=-1,J=d==null?0:d.length;++L<J;)if(b(d[L],L,d))return!0;return!1}function It(d,b){for(var L=-1,J=Array(d);++L<d;)J[L]=b(L);return J}function yt(d){return function(b){return d(b)}}function st(d,b){return d.has(b)}function Le(d,b){return d==null?void 0:d[b]}function Je(d){var b=-1,L=Array(d.size);return d.forEach(function(J,Ve){L[++b]=[Ve,J]}),L}function Ye(d,b){return function(L){return d(b(L))}}function nt(d){var b=-1,L=Array(d.size);return d.forEach(function(J){L[++b]=J}),L}var qe=Array.prototype,Xe=Function.prototype,Ne=Object.prototype,ke=A["__core-js_shared__"],ut=Xe.toString,je=Ne.hasOwnProperty,St=function(){var d=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),Lt=Ne.toString,Ut=RegExp("^"+ut.call(je).replace(ct,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=_?A.Buffer:void 0,Mt=A.Symbol,Gt=A.Uint8Array,tr=Ne.propertyIsEnumerable,$r=qe.splice,Wt=Mt?Mt.toStringTag:void 0,Vr=Object.getOwnPropertySymbols,oi=Ht?Ht.isBuffer:void 0,xi=Ye(Object.keys,Object),ht=cr(A,"DataView"),tt=cr(A,"Map"),lt=cr(A,"Promise"),ft=cr(A,"Set"),ot=cr(A,"WeakMap"),rt=cr(Object,"create"),Pt=Gr(ht),Ct=Gr(tt),pt=Gr(lt),At=Gr(ft),dt=Gr(ot),mt=Mt?Mt.prototype:void 0,gt=mt?mt.valueOf:void 0;function We(d){var b=-1,L=d==null?0:d.length;for(this.clear();++b<L;){var J=d[b];this.set(J[0],J[1])}}function Ot(){this.__data__=rt?rt(null):{},this.size=0}function Rt(d){var b=this.has(d)&&delete this.__data__[d];return this.size-=b?1:0,b}function go(d){var b=this.__data__;if(rt){var L=b[d];return L===n?void 0:L}return je.call(b,d)?b[d]:void 0}function vo(d){var b=this.__data__;return rt?b[d]!==void 0:je.call(b,d)}function yo(d,b){var L=this.__data__;return this.size+=this.has(d)?0:1,L[d]=rt&&b===void 0?n:b,this}We.prototype.clear=Ot,We.prototype.delete=Rt,We.prototype.get=go,We.prototype.has=vo,We.prototype.set=yo;function gr(d){var b=-1,L=d==null?0:d.length;for(this.clear();++b<L;){var J=d[b];this.set(J[0],J[1])}}function mo(){this.__data__=[],this.size=0}function _o(d){var b=this.__data__,L=Ii(b,d);if(L<0)return!1;var J=b.length-1;return L==J?b.pop():$r.call(b,L,1),--this.size,!0}function wo(d){var b=this.__data__,L=Ii(b,d);return L<0?void 0:b[L][1]}function bo(d){return Ii(this.__data__,d)>-1}function Eo(d,b){var L=this.__data__,J=Ii(L,d);return J<0?(++this.size,L.push([d,b])):L[J][1]=b,this}gr.prototype.clear=mo,gr.prototype.delete=_o,gr.prototype.get=wo,gr.prototype.has=bo,gr.prototype.set=Eo;function Kr(d){var b=-1,L=d==null?0:d.length;for(this.clear();++b<L;){var J=d[b];this.set(J[0],J[1])}}function Hi(){this.size=0,this.__data__={hash:new We,map:new(tt||gr),string:new We}}function xo(d){var b=ai(this,d).delete(d);return this.size-=b?1:0,b}function ki(d){return ai(this,d).get(d)}function Io(d){return ai(this,d).has(d)}function So(d,b){var L=ai(this,d),J=L.size;return L.set(d,b),this.size+=L.size==J?0:1,this}Kr.prototype.clear=Hi,Kr.prototype.delete=xo,Kr.prototype.get=ki,Kr.prototype.has=Io,Kr.prototype.set=So;function Bi(d){var b=-1,L=d==null?0:d.length;for(this.__data__=new Kr;++b<L;)this.add(d[b])}function Gs(d){return this.__data__.set(d,n),this}function Ws(d){return this.__data__.has(d)}Bi.prototype.add=Bi.prototype.push=Gs,Bi.prototype.has=Ws;function Ar(d){var b=this.__data__=new gr(d);this.size=b.size}function Po(){this.__data__=new gr,this.size=0}function Co(d){var b=this.__data__,L=b.delete(d);return this.size=b.size,L}function Ao(d){return this.__data__.get(d)}function Oo(d){return this.__data__.has(d)}function Js(d,b){var L=this.__data__;if(L instanceof gr){var J=L.__data__;if(!tt||J.length<r-1)return J.push([d,b]),this.size=++L.size,this;L=this.__data__=new Kr(J)}return L.set(d,b),this.size=L.size,this}Ar.prototype.clear=Po,Ar.prototype.delete=Co,Ar.prototype.get=Ao,Ar.prototype.has=Oo,Ar.prototype.set=Js;function Ys(d,b){var L=Gi(d),J=!L&&un(d),Ve=!L&&!J&&ds(d),le=!L&&!J&&!Ve&&fn(d),Ze=L||J||Ve||le,Tt=Ze?It(d.length,String):[],Pe=Tt.length;for(var Ke in d)(b||je.call(d,Ke))&&!(Ze&&(Ke=="length"||Ve&&(Ke=="offset"||Ke=="parent")||le&&(Ke=="buffer"||Ke=="byteLength"||Ke=="byteOffset")||sn(Ke,Pe)))&&Tt.push(Ke);return Tt}function Ii(d,b){for(var L=d.length;L--;)if(cn(d[L][0],b))return L;return-1}function fs(d,b,L){var J=b(d);return Gi(d)?J:Fe(J,L(d))}function Si(d){return d==null?d===void 0?ve:de:Wt&&Wt in Object(d)?tn(d):No(d)}function ps(d){return Ci(d)&&Si(d)==y}function Pi(d,b,L,J,Ve){return d===b?!0:d==null||b==null||!Ci(d)&&!Ci(b)?d!==d&&b!==b:Xs(d,b,L,J,Pi,Ve)}function Xs(d,b,L,J,Ve,le){var Ze=Gi(d),Tt=Gi(b),Pe=Ze?w:jr(d),Ke=Tt?w:jr(b);Pe=Pe==y?ge:Pe,Ke=Ke==y?ge:Ke;var _t=Pe==ge,rr=Ke==ge,Nt=Pe==Ke;if(Nt&&ds(d)){if(!ds(b))return!1;Ze=!0,_t=!1}if(Nt&&!_t)return le||(le=new Ar),Ze||fn(d)?Vi(d,b,L,J,Ve,le):To(d,b,Pe,L,J,Ve,le);if(!(L&o)){var Qe=_t&&je.call(d,"__wrapped__"),Jt=rr&&je.call(b,"__wrapped__");if(Qe||Jt){var Or=Qe?d.value():d,vr=Jt?b.value():b;return le||(le=new Ar),Ve(Or,vr,L,J,le)}}return Nt?(le||(le=new Ar),en(d,b,L,J,Ve,le)):!1}function Ro(d){if(!ln(d)||on(d))return!1;var b=Wi(d)?Ut:He;return b.test(Gr(d))}function Zs(d){return Ci(d)&&hn(d.length)&&!!we[Si(d)]}function Qs(d){if(!an(d))return xi(d);var b=[];for(var L in Object(d))je.call(d,L)&&L!="constructor"&&b.push(L);return b}function Vi(d,b,L,J,Ve,le){var Ze=L&o,Tt=d.length,Pe=b.length;if(Tt!=Pe&&!(Ze&&Pe>Tt))return!1;var Ke=le.get(d);if(Ke&&le.get(b))return Ke==b;var _t=-1,rr=!0,Nt=L&l?new Bi:void 0;for(le.set(d,b),le.set(b,d);++_t<Tt;){var Qe=d[_t],Jt=b[_t];if(J)var Or=Ze?J(Jt,Qe,_t,b,d,le):J(Qe,Jt,_t,d,b,le);if(Or!==void 0){if(Or)continue;rr=!1;break}if(Nt){if(!Ie(b,function(vr,Mr){if(!st(Nt,Mr)&&(Qe===vr||Ve(Qe,vr,L,J,le)))return Nt.push(Mr)})){rr=!1;break}}else if(!(Qe===Jt||Ve(Qe,Jt,L,J,le))){rr=!1;break}}return le.delete(d),le.delete(b),rr}function To(d,b,L,J,Ve,le,Ze){switch(L){case Oe:if(d.byteLength!=b.byteLength||d.byteOffset!=b.byteOffset)return!1;d=d.buffer,b=b.buffer;case Ee:return!(d.byteLength!=b.byteLength||!le(new Gt(d),new Gt(b)));case M:case K:case re:return cn(+d,+b);case Y:return d.name==b.name&&d.message==b.message;case he:case j:return d==b+"";case U:var Tt=Je;case R:var Pe=J&o;if(Tt||(Tt=nt),d.size!=b.size&&!Pe)return!1;var Ke=Ze.get(d);if(Ke)return Ke==b;J|=l,Ze.set(d,b);var _t=Vi(Tt(d),Tt(b),J,Ve,le,Ze);return Ze.delete(d),_t;case V:if(gt)return gt.call(d)==gt.call(b)}return!1}function en(d,b,L,J,Ve,le){var Ze=L&o,Tt=Ki(d),Pe=Tt.length,Ke=Ki(b),_t=Ke.length;if(Pe!=_t&&!Ze)return!1;for(var rr=Pe;rr--;){var Nt=Tt[rr];if(!(Ze?Nt in b:je.call(b,Nt)))return!1}var Qe=le.get(d);if(Qe&&le.get(b))return Qe==b;var Jt=!0;le.set(d,b),le.set(b,d);for(var Or=Ze;++rr<Pe;){Nt=Tt[rr];var vr=d[Nt],Mr=b[Nt];if(J)var gs=Ze?J(Mr,vr,Nt,b,d,le):J(vr,Mr,Nt,d,b,le);if(!(gs===void 0?vr===Mr||Ve(vr,Mr,L,J,le):gs)){Jt=!1;break}Or||(Or=Nt=="constructor")}if(Jt&&!Or){var Ai=d.constructor,zt=b.constructor;Ai!=zt&&"constructor"in d&&"constructor"in b&&!(typeof Ai=="function"&&Ai instanceof Ai&&typeof zt=="function"&&zt instanceof zt)&&(Jt=!1)}return le.delete(d),le.delete(b),Jt}function Ki(d){return fs(d,Lo,rn)}function ai(d,b){var L=d.__data__;return nn(b)?L[typeof b=="string"?"string":"hash"]:L.map}function cr(d,b){var L=Le(d,b);return Ro(L)?L:void 0}function tn(d){var b=je.call(d,Wt),L=d[Wt];try{d[Wt]=void 0;var J=!0}catch{}var Ve=Lt.call(d);return J&&(b?d[Wt]=L:delete d[Wt]),Ve}var rn=Vr?function(d){return d==null?[]:(d=Object(d),Te(Vr(d),function(b){return tr.call(d,b)}))}:Be,jr=Si;(ht&&jr(new ht(new ArrayBuffer(1)))!=Oe||tt&&jr(new tt)!=U||lt&&jr(lt.resolve())!=pe||ft&&jr(new ft)!=R||ot&&jr(new ot)!=te)&&(jr=function(d){var b=Si(d),L=b==ge?d.constructor:void 0,J=L?Gr(L):"";if(J)switch(J){case Pt:return Oe;case Ct:return U;case pt:return pe;case At:return R;case dt:return te}return b});function sn(d,b){return b=b??g,!!b&&(typeof d=="number"||Lr.test(d))&&d>-1&&d%1==0&&d<b}function nn(d){var b=typeof d;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?d!=="__proto__":d===null}function on(d){return!!St&&St in d}function an(d){var b=d&&d.constructor,L=typeof b=="function"&&b.prototype||Ne;return d===L}function No(d){return Lt.call(d)}function Gr(d){if(d!=null){try{return ut.call(d)}catch{}try{return d+""}catch{}}return""}function cn(d,b){return d===b||d!==d&&b!==b}var un=ps(function(){return arguments}())?ps:function(d){return Ci(d)&&je.call(d,"callee")&&!tr.call(d,"callee")},Gi=Array.isArray;function Fo(d){return d!=null&&hn(d.length)&&!Wi(d)}var ds=oi||Ue;function Do(d,b){return Pi(d,b)}function Wi(d){if(!ln(d))return!1;var b=Si(d);return b==G||b==q||b==S||b==ue}function hn(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=g}function ln(d){var b=typeof d;return d!=null&&(b=="object"||b=="function")}function Ci(d){return d!=null&&typeof d=="object"}var fn=me?yt(me):Zs;function Lo(d){return Fo(d)?Ys(d):Qs(d)}function Be(){return[]}function Ue(){return!1}u.exports=Do})(oo,oo.exports);var Wm=oo.exports;const Jm=Zy(Wm);function Ym(u,i){if(u.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<u.length;o++){var l=u.charAt(o),g=l.charCodeAt(0);if(r[g]!==255)throw new TypeError(l+" is ambiguous");r[g]=o}var y=u.length,w=u.charAt(0),S=Math.log(y)/Math.log(256),M=Math.log(256)/Math.log(y);function K(q){if(q instanceof Uint8Array||(ArrayBuffer.isView(q)?q=new Uint8Array(q.buffer,q.byteOffset,q.byteLength):Array.isArray(q)&&(q=Uint8Array.from(q))),!(q instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(q.length===0)return"";for(var U=0,re=0,de=0,ge=q.length;de!==ge&&q[de]===0;)de++,U++;for(var pe=(ge-de)*M+1>>>0,ue=new Uint8Array(pe);de!==ge;){for(var he=q[de],R=0,j=pe-1;(he!==0||R<re)&&j!==-1;j--,R++)he+=256*ue[j]>>>0,ue[j]=he%y>>>0,he=he/y>>>0;if(he!==0)throw new Error("Non-zero carry");re=R,de++}for(var V=pe-re;V!==pe&&ue[V]===0;)V++;for(var ve=w.repeat(U);V<pe;++V)ve+=u.charAt(ue[V]);return ve}function Y(q){if(typeof q!="string")throw new TypeError("Expected String");if(q.length===0)return new Uint8Array;var U=0;if(q[U]!==" "){for(var re=0,de=0;q[U]===w;)re++,U++;for(var ge=(q.length-U)*S+1>>>0,pe=new Uint8Array(ge);q[U];){var ue=r[q.charCodeAt(U)];if(ue===255)return;for(var he=0,R=ge-1;(ue!==0||he<de)&&R!==-1;R--,he++)ue+=y*pe[R]>>>0,pe[R]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");de=he,U++}if(q[U]!==" "){for(var j=ge-de;j!==ge&&pe[j]===0;)j++;for(var V=new Uint8Array(re+(ge-j)),ve=re;j!==ge;)V[ve++]=pe[j++];return V}}}function G(q){var U=Y(q);if(U)return U;throw new Error(`Non-${i} character`)}return{encode:K,decodeUnsafe:Y,decode:G}}var Xm=Ym,Zm=Xm;const Yl=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},Qm=u=>new TextEncoder().encode(u),e_=u=>new TextDecoder().decode(u);let t_=class{constructor(i,r,n){this.name=i,this.prefix=r,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}};class r_{constructor(i,r,n){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return Xl(this,i)}}class i_{constructor(i){this.decoders=i}or(i){return Xl(this,i)}decode(i){const r=i[0],n=this.decoders[r];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Xl=(u,i)=>new i_({...u.decoders||{[u.prefix]:u},...i.decoders||{[i.prefix]:i}});class s_{constructor(i,r,n,o){this.name=i,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new t_(i,r,n),this.decoder=new r_(i,r,o)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const fo=({name:u,prefix:i,encode:r,decode:n})=>new s_(u,i,r,n),Ks=({prefix:u,name:i,alphabet:r})=>{const{encode:n,decode:o}=Zm(r,i);return fo({prefix:u,name:i,encode:n,decode:l=>Yl(o(l))})},n_=(u,i,r,n)=>{const o={};for(let M=0;M<i.length;++M)o[i[M]]=M;let l=u.length;for(;u[l-1]==="=";)--l;const g=new Uint8Array(l*r/8|0);let y=0,w=0,S=0;for(let M=0;M<l;++M){const K=o[u[M]];if(K===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<r|K,y+=r,y>=8&&(y-=8,g[S++]=255&w>>y)}if(y>=r||255&w<<8-y)throw new SyntaxError("Unexpected end of data");return g},o_=(u,i,r)=>{const n=i[i.length-1]==="=",o=(1<<r)-1;let l="",g=0,y=0;for(let w=0;w<u.length;++w)for(y=y<<8|u[w],g+=8;g>r;)g-=r,l+=i[o&y>>g];if(g&&(l+=i[o&y<<r-g]),n)for(;l.length*r&7;)l+="=";return l},Bt=({name:u,prefix:i,bitsPerChar:r,alphabet:n})=>fo({prefix:i,name:u,encode(o){return o_(o,n,r)},decode(o){return n_(o,n,r,u)}}),a_=fo({prefix:"\0",name:"identity",encode:u=>e_(u),decode:u=>Qm(u)});var c_=Object.freeze({__proto__:null,identity:a_});const u_=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var h_=Object.freeze({__proto__:null,base2:u_});const l_=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var f_=Object.freeze({__proto__:null,base8:l_});const p_=Ks({prefix:"9",name:"base10",alphabet:"0123456789"});var d_=Object.freeze({__proto__:null,base10:p_});const g_=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),v_=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var y_=Object.freeze({__proto__:null,base16:g_,base16upper:v_});const m_=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),__=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),w_=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),b_=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),E_=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),x_=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),I_=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),S_=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),P_=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var C_=Object.freeze({__proto__:null,base32:m_,base32upper:__,base32pad:w_,base32padupper:b_,base32hex:E_,base32hexupper:x_,base32hexpad:I_,base32hexpadupper:S_,base32z:P_});const A_=Ks({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),O_=Ks({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var R_=Object.freeze({__proto__:null,base36:A_,base36upper:O_});const T_=Ks({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),N_=Ks({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var F_=Object.freeze({__proto__:null,base58btc:T_,base58flickr:N_});const D_=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),L_=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$_=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),j_=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var M_=Object.freeze({__proto__:null,base64:D_,base64pad:L_,base64url:$_,base64urlpad:j_});const Zl=Array.from(""),z_=Zl.reduce((u,i,r)=>(u[r]=i,u),[]),q_=Zl.reduce((u,i,r)=>(u[i.codePointAt(0)]=r,u),[]);function U_(u){return u.reduce((i,r)=>(i+=z_[r],i),"")}function H_(u){const i=[];for(const r of u){const n=q_[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(n)}return new Uint8Array(i)}const k_=fo({prefix:"",name:"base256emoji",encode:U_,decode:H_});var B_=Object.freeze({__proto__:null,base256emoji:k_}),V_=Ql,Jh=128,K_=127,G_=~K_,W_=Math.pow(2,31);function Ql(u,i,r){i=i||[],r=r||0;for(var n=r;u>=W_;)i[r++]=u&255|Jh,u/=128;for(;u&G_;)i[r++]=u&255|Jh,u>>>=7;return i[r]=u|0,Ql.bytes=r-n+1,i}var J_=sc,Y_=128,Yh=127;function sc(u,n){var r=0,n=n||0,o=0,l=n,g,y=u.length;do{if(l>=y)throw sc.bytes=0,new RangeError("Could not decode varint");g=u[l++],r+=o<28?(g&Yh)<<o:(g&Yh)*Math.pow(2,o),o+=7}while(g>=Y_);return sc.bytes=l-n,r}var X_=Math.pow(2,7),Z_=Math.pow(2,14),Q_=Math.pow(2,21),ew=Math.pow(2,28),tw=Math.pow(2,35),rw=Math.pow(2,42),iw=Math.pow(2,49),sw=Math.pow(2,56),nw=Math.pow(2,63),ow=function(u){return u<X_?1:u<Z_?2:u<Q_?3:u<ew?4:u<tw?5:u<rw?6:u<iw?7:u<sw?8:u<nw?9:10},aw={encode:V_,decode:J_,encodingLength:ow},ef=aw;const Xh=(u,i,r=0)=>(ef.encode(u,i,r),i),Zh=u=>ef.encodingLength(u),nc=(u,i)=>{const r=i.byteLength,n=Zh(u),o=n+Zh(r),l=new Uint8Array(o+r);return Xh(u,l,0),Xh(r,l,n),l.set(i,o),new cw(u,r,i,l)};class cw{constructor(i,r,n,o){this.code=i,this.size=r,this.digest=n,this.bytes=o}}const tf=({name:u,code:i,encode:r})=>new uw(u,i,r);class uw{constructor(i,r,n){this.name=i,this.code=r,this.encode=n}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?nc(this.code,r):r.then(n=>nc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const rf=u=>async i=>new Uint8Array(await crypto.subtle.digest(u,i)),hw=tf({name:"sha2-256",code:18,encode:rf("SHA-256")}),lw=tf({name:"sha2-512",code:19,encode:rf("SHA-512")});var fw=Object.freeze({__proto__:null,sha256:hw,sha512:lw});const sf=0,pw="identity",nf=Yl,dw=u=>nc(sf,nf(u)),gw={code:sf,name:pw,encode:nf,digest:dw};var vw=Object.freeze({__proto__:null,identity:gw});new TextEncoder,new TextDecoder;const Qh={...c_,...h_,...f_,...d_,...y_,...C_,...R_,...F_,...M_,...B_};({...fw,...vw});function of(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function yw(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?of(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function af(u,i,r,n){return{name:u,prefix:i,encoder:{name:u,prefix:i,encode:r},decoder:{decode:n}}}const el=af("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),Ka=af("ascii","a",u=>{let i="a";for(let r=0;r<u.length;r++)i+=String.fromCharCode(u[r]);return i},u=>{u=u.substring(1);const i=yw(u.length);for(let r=0;r<u.length;r++)i[r]=u.charCodeAt(r);return i}),mw={utf8:el,"utf-8":el,hex:Qh.base16,latin1:Ka,ascii:Ka,binary:Ka,...Qh};function _w(u,i="utf8"){const r=mw[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?of(globalThis.Buffer.from(u,"utf-8")):r.decoder.decode(`${r.prefix}${u}`)}const cf="wc",ww=2,mc="core",_i=`${cf}@2:${mc}:`,bw={name:mc,logger:"error"},Ew={database:":memory:"},xw="crypto",tl="client_ed25519_seed",Iw=ae.ONE_DAY,Sw="keychain",Pw="0.3",Cw="messages",Aw="0.3",Ow=ae.SIX_HOURS,Rw="publisher",uf="irn",Tw="error",hf="wss://relay.walletconnect.com",Nw="relayer",Dt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Fw="_subscription",$s={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Dw=ae.ONE_SECOND/2,Lw="y",$w=1e4,jw="0.3",kr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Mw="subscription",zw="0.3",qw=ae.FIVE_SECONDS*1e3,Uw="pairing",Hw="0.3",js={wc_pairingDelete:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ae.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ae.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:0},res:{ttl:ae.ONE_DAY,prompt:!1,tag:0}}},Hr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},kw="history",Bw="0.3",Vw="expirer",Sr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Kw="0.3",Ga="verify-api",rl="https://verify.walletconnect.com";class Gw{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=Sw,this.version=Pw,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:l}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,Nl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Fl(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Ww{constructor(i,r,n){this.core=i,this.logger=r,this.name=xw,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),l=Hh(o);return Ul(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=t1();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const l=await this.getClientSeed(),g=Hh(l),y=rc();return await Pm(y,o,Iw,g)},this.generateSharedKey=(o,l,g)=>{this.isInitialized();const y=this.getPrivateKey(o),w=r1(y,l);return this.setSymKey(w,g)},this.setSymKey=async(o,l)=>{this.isInitialized();const g=l||i1(o);return await this.keychain.set(g,o),g},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,l,g)=>{this.isInitialized();const y=s1(g),w=ks(l);if(bh(y)){const Y=y.senderPublicKey,G=y.receiverPublicKey;o=await this.generateSharedKey(Y,G)}const S=this.getSymKey(o),{type:M,senderPublicKey:K}=y;return n1({type:M,symKey:S,message:w,senderPublicKey:K})},this.decode=async(o,l,g)=>{this.isInitialized();const y=o1(l,g);if(bh(y)){const M=y.receiverPublicKey,K=y.senderPublicKey;o=await this.generateSharedKey(M,K)}const w=this.getSymKey(o),S=a1({symKey:w,encoded:l});return pc(S)},this.getPayloadType=o=>{const l=Eh(o);return c1(l.type)},this.getPayloadSenderPublicKey=o=>{const l=Eh(o);return l.senderPublicKey?ao(l.senderPublicKey,u1):void 0},this.core=i,this.logger=Ae.generateChildLogger(r,this.name),this.keychain=n||new Gw(this.core,this.logger)}get context(){return Ae.getLoggerContext(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(tl)}catch{i=rc(),await this.keychain.set(tl,i)}return _w(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Jw extends rm{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=Cw,this.version=Aw,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const l=ls(o);let g=this.messages.get(n);return typeof g>"u"&&(g={}),typeof g[l]<"u"||(g[l]=o,this.messages.set(n,g),await this.persist()),l},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const l=this.get(n),g=ls(o);return typeof l[g]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ae.generateChildLogger(i,this.name),this.core=r}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,Nl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Fl(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}let Yw=class extends im{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new Cr.EventEmitter,this.name=Rw,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(n,o,l)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}});try{const g=(l==null?void 0:l.ttl)||Ow,y=ic(l),w=(l==null?void 0:l.prompt)||!1,S=(l==null?void 0:l.tag)||0,M=(l==null?void 0:l.id)||Gl().toString(),K={topic:n,message:o,opts:{ttl:g,relay:y,prompt:w,tag:S,id:M}};this.queue.set(M,K);try{await await so(this.rpcPublish(n,o,g,y,w,S,M),this.publishTimeout),this.relayer.events.emit(Dt.publish,K)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(Dt.connection_stalled);return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=i,this.logger=Ae.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ae.getLoggerContext(this.logger)}rpcPublish(i,r,n,o,l,g,y){var w,S,M,K;const Y={method:to(o.protocol).publish,params:{topic:i,message:r,ttl:n,prompt:l,tag:g},id:y};return mi((w=Y.params)==null?void 0:w.prompt)&&((S=Y.params)==null||delete S.prompt),mi((M=Y.params)==null?void 0:M.tag)&&((K=Y.params)==null||delete K.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:Y}),this.relayer.request(Y)}onPublish(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:n,opts:o}=i;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(Vs.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()}),this.relayer.on(Dt.message_ack,i=>{this.onPublish(i.id.toString())})}},Xw=class{constructor(){this.map=new Map,this.set=(i,r)=>{const n=this.get(i);this.exists(i,r)||this.map.set(i,[...n,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,r))return;const o=n.filter(l=>l!==r);if(!o.length){this.map.delete(i);return}this.map.set(i,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}};var Zw=Object.defineProperty,Qw=Object.defineProperties,eb=Object.getOwnPropertyDescriptors,il=Object.getOwnPropertySymbols,tb=Object.prototype.hasOwnProperty,rb=Object.prototype.propertyIsEnumerable,sl=(u,i,r)=>i in u?Zw(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,Ms=(u,i)=>{for(var r in i||(i={}))tb.call(i,r)&&sl(u,r,i[r]);if(il)for(var r of il(i))rb.call(i,r)&&sl(u,r,i[r]);return u},Wa=(u,i)=>Qw(u,eb(i));class ib extends om{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new Xw,this.events=new Cr.EventEmitter,this.name=Mw,this.version=zw,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=_i,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const l=ic(o),g={topic:n,relay:l};this.pending.set(n,g);const y=await this.rpcSubscribe(n,l);return this.onSubscribe(y,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),y}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,l)=>{const g=new ae.Watch;g.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(y),g.stop(this.pendingSubscriptionWatchLabel),o(!0)),g.elapsed(this.pendingSubscriptionWatchLabel)>=qw&&(clearInterval(y),g.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Ae.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let n=!1;try{n=this.getSubscription(i).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const n=this.topicMap.get(i);await Promise.all(n.map(async o=>await this.unsubscribeById(i,o,r)))}async unsubscribeById(i,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}});try{const o=ic(n);await this.rpcUnsubscribe(i,r,o);const l=er("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(i,r){const n={method:to(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await so(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Dt.connection_stalled)}return ls(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,n={method:to(r.protocol).batchSubscribe,params:{topics:i.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await so(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Dt.connection_stalled)}}rpcUnsubscribe(i,r,n){const o={method:to(n.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(i,r){this.setSubscription(i,Wa(Ms({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,Ms({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,Ms({},r)),this.topicMap.set(r.topic,i),this.events.emit(kr.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(kr.deleted,Wa(Ms({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(kr.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(kr.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);Hs(r)&&this.onBatchSubscribe(r.map((n,o)=>Wa(Ms({},i[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(Vs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Dt.connect,async()=>{await this.onConnect()}),this.relayer.on(Dt.disconnect,()=>{this.onDisconnect()}),this.events.on(kr.created,async i=>{const r=kr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(kr.deleted,async i=>{const r=kr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var sb=Object.defineProperty,nl=Object.getOwnPropertySymbols,nb=Object.prototype.hasOwnProperty,ob=Object.prototype.propertyIsEnumerable,ol=(u,i,r)=>i in u?sb(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ab=(u,i)=>{for(var r in i||(i={}))nb.call(i,r)&&ol(u,r,i[r]);if(nl)for(var r of nl(i))ob.call(i,r)&&ol(u,r,i[r]);return u};class cb extends sm{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new Cr.EventEmitter,this.name=Nw,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Ae.generateChildLogger(i.logger,this.name):Ae.pino(Ae.getDefaultLoggerOptions({level:i.logger||Tw})),this.messages=new Jw(this.logger,i.core),this.subscriber=new ib(this,this.logger),this.publisher=new Yw(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||hf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribted to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},$w)}get context(){return Ae.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,n){this.isInitialized(),await this.publisher.publish(i,r,n),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){this.isInitialized();let n="";return await Promise.all([new Promise(o=>{this.subscriber.once(kr.created,l=>{l.topic===i&&o()})}),new Promise(async o=>{n=await this.subscriber.subscribe(i,r),o()})]),n}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Dt.transport_closed))}async transportOpen(i){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=i||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(kr.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,n)=>{await so(this.provider.connect(),5e3,"socket stalled").catch(o=>n(o)).then(()=>r()).finally(()=>this.removeListener(Dt.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(Dt.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.events.emit(Dt.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(i){this.transportExplicitlyClosed||(this.relayUrl=i||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once($s.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}rejectTransportOpen(){throw new Error("closeTransport called before connection was established")}async createProvider(){const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new bi(new Gm(h1({sdkVersion:Lw,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:n}=i;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(i){const{topic:r,message:n}=i;return await this.subscriber.isSubscribed(r)?this.messages.has(r,n):!0}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),yc(i)){if(!i.method.endsWith(Fw))return;const r=i.params,{topic:n,message:o,publishedAt:l}=r.data,g={topic:n,message:o,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ab({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(i),await this.onMessageEvent(g)}else lo(i)&&this.events.emit(Dt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(Dt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=vc(i.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on($s.payload,i=>this.onProviderPayload(i)),this.provider.on($s.connect,()=>{this.events.emit(Dt.connect)}),this.provider.on($s.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on($s.error,i=>{this.logger.error(i),this.events.emit(Dt.error,i)})}registerEventListeners(){this.events.on(Dt.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(Dt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},ae.toMiliseconds(Dw))}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var ub=Object.defineProperty,al=Object.getOwnPropertySymbols,hb=Object.prototype.hasOwnProperty,lb=Object.prototype.propertyIsEnumerable,cl=(u,i,r)=>i in u?ub(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ul=(u,i)=>{for(var r in i||(i={}))hb.call(i,r)&&cl(u,r,i[r]);if(al)for(var r of al(i))lb.call(i,r)&&cl(u,r,i[r]);return u};let po=class extends nm{constructor(i,r,n,o=_i,l=void 0){super(i,r,n,o),this.core=i,this.logger=r,this.name=n,this.map=new Map,this.version=jw,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!mi(g)?this.map.set(this.getKey(g),g):Qy(g)?this.map.set(g.id,g):e1(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,y)=>{this.isInitialized(),this.map.has(g)?await this.update(g,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:y}),this.map.set(g,y),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(y=>Object.keys(g).every(w=>Jm(y[w],g[w]))):this.values),this.update=async(g,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:y});const w=ul(ul({},this.getData(g)),y);this.map.set(g,w),await this.persist()},this.delete=async(g,y)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:y}),this.map.delete(g),await this.persist())},this.logger=Ae.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=l}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}};class fb{constructor(i,r){this.core=i,this.logger=r,this.name=Uw,this.version=Hw,this.events=new fc,this.initialized=!1,this.storagePrefix=_i,this.ignoredPayloadTypes=[Ol],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=rc(),o=await this.core.crypto.setSymKey(n),l=Br(ae.FIVE_MINUTES),g={protocol:uf},y={topic:o,expiry:l,relay:g,active:!1},w=l1({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:g});return await this.pairings.set(o,y),await this.core.relayer.subscribe(o),this.core.expirer.set(o,l),{topic:o,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:l,relay:g}=f1(n.uri);if(this.pairings.keys.includes(o))throw new Error(`Pairing already exists: ${o}`);if(this.core.crypto.hasKeys(o))throw new Error(`Keychain already exists: ${o}`);const y=Br(ae.FIVE_MINUTES),w={topic:o,relay:g,expiry:y,active:!1};return await this.pairings.set(o,w),await this.core.crypto.setSymKey(l,o),await this.core.relayer.subscribe(o,{relay:g}),this.core.expirer.set(o,y),n.activatePairing&&await this.activate({topic:o}),w},this.activate=async({topic:n})=>{this.isInitialized();const o=Br(ae.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const l=await this.sendRequest(o,"wc_pairingPing",{}),{done:g,resolve:y,reject:w}=cs();this.events.once(Ft("pairing_ping",l),({error:S})=>{S?w(S):y()}),await g()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",er("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,l)=>{const g=uo(o,l),y=await this.core.crypto.encode(n,g),w=js[o].req;return this.core.history.set(n,g),this.core.relayer.publish(n,y,w),g.id},this.sendResult=async(n,o,l)=>{const g=vc(n,l),y=await this.core.crypto.encode(o,g),w=await this.core.history.get(o,n),S=js[w.request.method].res;await this.core.relayer.publish(o,y,S),await this.core.history.resolve(g)},this.sendError=async(n,o,l)=>{const g=ho(n,l),y=await this.core.crypto.encode(o,g),w=await this.core.history.get(o,n),S=js[w.request.method]?js[w.request.method].res:js.unregistered_method.res;await this.core.relayer.publish(o,y,S),await this.core.history.resolve(g)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>yi(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:l}=n,g=l.method;if(this.pairings.keys.includes(o))switch(g){case"wc_pairingPing":return this.onPairingPingRequest(o,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,l);default:return this.onUnknownRpcMethodRequest(o,l)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:l}=n,g=(await this.core.history.get(o,l.id)).request.method;if(this.pairings.keys.includes(o))switch(g){case"wc_pairingPing":return this.onPairingPingResponse(o,l);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(n,o)=>{const{id:l}=o;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit("pairing_ping",{id:l,topic:n})}catch(g){await this.sendError(l,n,g),this.logger.error(g)}},this.onPairingPingResponse=(n,o)=>{const{id:l}=o;setTimeout(()=>{ni(o)?this.events.emit(Ft("pairing_ping",l),{}):Dr(o)&&this.events.emit(Ft("pairing_ping",l),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:l}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit("pairing_delete",{id:l,topic:n})}catch(g){await this.sendError(l,n,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:l,method:g}=o;try{if(this.registeredMethods.includes(g))return;const y=er("WC_METHOD_UNSUPPORTED",g);await this.sendError(l,n,y),this.logger.error(y)}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(er("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!ar(n)){const{message:o}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!p1(n.uri)){const{message:o}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!ar(n)){const{message:l}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!ar(n)){const{message:l}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!us(n,!1)){const{message:o}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(yi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=i,this.logger=Ae.generateChildLogger(r,this.name),this.pairings=new po(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ae.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(Dt.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);yc(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):lo(o)&&(await this.core.history.resolve(o),this.onRelayEventResponse({topic:r,payload:o}))})}registerExpirerEvents(){this.core.expirer.on(Sr.expired,async i=>{const{topic:r}=Rl(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class pb extends tm{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new Cr.EventEmitter,this.name=kw,this.version=Bw,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:l}),this.records.has(o.id))return;const g={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:l};this.records.set(g.id,g),this.events.emit(Hr.created,g)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Dr(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Hr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(l=>{if(l.topic===n){if(typeof o<"u"&&l.id!==o)return;this.records.delete(l.id),this.events.emit(Hr.deleted,l)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:uo(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Hr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(Hr.created,i=>{const r=Hr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(Hr.updated,i=>{const r=Hr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(Hr.deleted,i=>{const r=Hr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class db extends am{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new Cr.EventEmitter,this.name=Vw,this.version=Kw,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const l=this.formatTarget(n),g={target:l,expiry:o};this.expirations.set(l,g),this.checkExpiry(l,g),this.events.emit(Sr.created,{target:l,expiration:g})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),l=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Sr.deleted,{target:o,expiration:l})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return d1(i);if(typeof i=="number")return g1(i);const{message:r}=Z("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Sr.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(i,r){const{expiry:n}=r;ae.toMiliseconds(n)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(Sr.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(Vs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Sr.created,i=>{const r=Sr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Sr.expired,i=>{const r=Sr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Sr.deleted,i=>{const r=Sr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class gb extends cm{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=Ga,this.initialized=!1,this.init=async n=>{v1()||!Tl()||(this.verifyUrl=(n==null?void 0:n.verifyUrl)||rl,await this.createIframe())},this.register=async n=>{var o;this.initialized||await this.init(),this.iframe&&((o=this.iframe.contentWindow)==null||o.postMessage(n.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${n.attestationId} ${this.verifyUrl}`))},this.resolve=async n=>{var o;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${n.attestationId}`);const l=this.startAbortTimer(ae.FIVE_SECONDS),g=await fetch(`${this.verifyUrl}/attestation/${n.attestationId}`,{signal:this.abortController.signal});return clearTimeout(l),g.status===200?(o=await g.json())==null?void 0:o.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((n,o)=>{if(document.getElementById(Ga))return n();const l=document.createElement("iframe");l.setAttribute("id",Ga),l.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),l.style.display="none",l.addEventListener("load",()=>{this.initialized=!0,n()}),l.addEventListener("error",g=>{o(g)}),document.body.append(l),this.iframe=l}),new Promise(n=>{setTimeout(()=>n("iframe load timeout"),ae.toMiliseconds(ae.ONE_SECOND/2))})])}catch(n){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(n)}},this.logger=Ae.generateChildLogger(r,this.name),this.verifyUrl=rl,this.abortController=new AbortController,this.isDevEnv=y1()&&{}.IS_VITEST}get context(){return Ae.getLoggerContext(this.logger)}startAbortTimer(i){return setTimeout(()=>this.abortController.abort(),ae.toMiliseconds(i))}}var vb=Object.defineProperty,hl=Object.getOwnPropertySymbols,yb=Object.prototype.hasOwnProperty,mb=Object.prototype.propertyIsEnumerable,ll=(u,i,r)=>i in u?vb(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,fl=(u,i)=>{for(var r in i||(i={}))yb.call(i,r)&&ll(u,r,i[r]);if(hl)for(var r of hl(i))mb.call(i,r)&&ll(u,r,i[r]);return u};let _b=class lf extends em{constructor(i){super(i),this.protocol=cf,this.version=ww,this.name=mc,this.events=new Cr.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||hf;const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||bw.logger}));this.logger=Ae.generateChildLogger(r,this.name),this.heartbeat=new Vs.HeartBeat,this.crypto=new Ww(this,this.logger,i==null?void 0:i.keychain),this.history=new pb(this,this.logger),this.expirer=new db(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new V1(fl(fl({},Ew),i==null?void 0:i.storageOptions)),this.relayer=new cb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new fb(this,this.logger),this.verify=new gb(this.projectId||"",this.logger)}static async init(i){const r=new lf(i);return await r.initialize(),r}get context(){return Ae.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}};const wb=_b,ff="wc",pf=2,df="client",_c=`${ff}@${pf}:${df}:`,Ja={name:df,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},bb="proposal",gf="Proposal expired",Eb="session",Zn=ae.SEVEN_DAYS,xb="engine",zs={wc_sessionPropose:{req:{ttl:ae.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ae.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ae.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ae.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ae.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ya={min:ae.FIVE_MINUTES,max:ae.SEVEN_DAYS},Ib="request",Sb=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Pb=Object.defineProperty,Cb=Object.defineProperties,Ab=Object.getOwnPropertyDescriptors,pl=Object.getOwnPropertySymbols,Ob=Object.prototype.hasOwnProperty,Rb=Object.prototype.propertyIsEnumerable,dl=(u,i,r)=>i in u?Pb(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,Ir=(u,i)=>{for(var r in i||(i={}))Ob.call(i,r)&&dl(u,r,i[r]);if(pl)for(var r of pl(i))Rb.call(i,r)&&dl(u,r,i[r]);return u},Xa=(u,i)=>Cb(u,Ab(i));class Tb extends hm{constructor(i){super(i),this.name=xb,this.events=new fc,this.initialized=!1,this.ignoredPayloadTypes=[Ol],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(zs)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized();const n=Xa(Ir({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:l,optionalNamespaces:g,sessionProperties:y,relays:w}=n;let S=o,M,K=!1;if(S&&(K=this.client.core.pairing.pairings.get(S).active),!S||!K){const{topic:pe,uri:ue}=await this.client.core.pairing.create();S=pe,M=ue}const Y=await this.client.core.crypto.generateKeyPair(),G=Ir({requiredNamespaces:l,optionalNamespaces:g,relays:w??[{protocol:uf}],proposer:{publicKey:Y,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:q,resolve:U,done:re}=cs(ae.FIVE_MINUTES,gf);if(this.events.once(Ft("session_connect"),async({error:pe,session:ue})=>{if(pe)q(pe);else if(ue){ue.self.publicKey=Y;const he=Xa(Ir({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:ue.peer.metadata}),U(he)}}),!S){const{message:pe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${S}`);throw new Error(pe)}const de=await this.sendRequest(S,"wc_sessionPropose",G),ge=Br(ae.FIVE_MINUTES);return await this.setProposal(de,Ir({id:de,expiry:ge},G)),{uri:M,approval:re}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:l,sessionProperties:g}=r,y=this.client.proposal.get(n);let{pairingTopic:w,proposer:S,requiredNamespaces:M,optionalNamespaces:K}=y;w=w||"",ro(M)||(M=_1(l,"approve()"));const Y=await this.client.core.crypto.generateKeyPair(),G=S.publicKey,q=await this.client.core.crypto.generateSharedKey(Y,G);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:S.metadata}),await this.sendResult(n,w,{relay:{protocol:o??"irn"},responderPublicKey:Y}),await this.client.proposal.delete(n,er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const U=Ir({relay:{protocol:o??"irn"},namespaces:l,requiredNamespaces:M,optionalNamespaces:K,pairingTopic:w,controller:{publicKey:Y,metadata:this.client.metadata},expiry:Br(Zn)},g&&{sessionProperties:g});await this.client.core.relayer.subscribe(q),await this.sendRequest(q,"wc_sessionSettle",U);const re=Xa(Ir({},U),{topic:q,pairingTopic:w,acknowledged:!1,self:U.controller,peer:{publicKey:S.publicKey,metadata:S.metadata},controller:Y});return await this.client.session.set(q,re),await this.setExpiry(q,Br(Zn)),{topic:q,acknowledged:()=>new Promise(de=>setTimeout(()=>de(this.client.session.get(q)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,o),await this.client.proposal.delete(n,er("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,l=await this.sendRequest(n,"wc_sessionUpdate",{namespaces:o}),{done:g,resolve:y,reject:w}=cs();return this.events.once(Ft("session_update",l),({error:S})=>{S?w(S):y()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:g}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest(n,"wc_sessionExtend",{}),{done:l,resolve:g,reject:y}=cs();return this.events.once(Ft("session_extend",o),({error:w})=>{w?y(w):g()}),await this.setExpiry(n,Br(Zn)),{acknowledged:l}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:l,expiry:g}=r,y=await this.sendRequest(l,"wc_sessionRequest",{request:o,chainId:n},g),{done:w,resolve:S,reject:M}=cs(g);return this.events.once(Ft("session_request",y),({error:K,result:Y})=>{K?M(K):S(Y)}),this.client.events.emit("session_request_sent",{topic:l,request:o,chainId:n,id:y}),await w()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:l}=o;ni(o)?await this.sendResult(l,n,o.result):Dr(o)&&await this.sendError(l,n,o.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest(n,"wc_sessionPing",{}),{done:l,resolve:g,reject:y}=cs();this.events.once(Ft("session_ping",o),({error:w})=>{w?y(w):g()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:l}=r;await this.sendRequest(n,"wc_sessionEvent",{event:o,chainId:l})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest(n,"wc_sessionDelete",er("USER_DISCONNECTED")),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>w1(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(l=>{var g,y;return((g=l.peerMetadata)==null?void 0:g.url)&&((y=l.peerMetadata)==null?void 0:y.url)===r.self.metadata.url&&l.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,er("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.deleteSymKey(r),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,er("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=zs.wc_sessionRequest.req.ttl,{id:o,topic:l,params:g}=r;await this.client.pendingRequest.set(o,{id:o,topic:l,params:g}),n&&this.client.core.expirer.set(o,Br(n))},this.sendRequest=async(r,n,o,l)=>{const g=uo(n,o);if(Tl()&&Sb.includes(n)){const S=ls(JSON.stringify(g));await this.client.core.verify.register({attestationId:S})}const y=await this.client.core.crypto.encode(r,g),w=zs[n].req;return l&&(w.ttl=l),this.client.core.history.set(r,g),this.client.core.relayer.publish(r,y,w),g.id},this.sendResult=async(r,n,o)=>{const l=vc(r,o),g=await this.client.core.crypto.encode(n,l),y=await this.client.core.history.get(n,r),w=zs[y.request.method].res;this.client.core.relayer.publish(n,g,w),await this.client.core.history.resolve(l)},this.sendError=async(r,n,o)=>{const l=ho(r,o),g=await this.client.core.crypto.encode(n,l),y=await this.client.core.history.get(n,r),w=zs[y.request.method].res;this.client.core.relayer.publish(n,g,w),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{yi(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{yi(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=r=>{const{topic:n,payload:o}=r,l=o.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,l=(await this.client.core.history.get(n,o.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:l}=n;try{this.isValidConnect(Ir({},n.params));const g=Br(ae.FIVE_MINUTES),y=Ir({id:l,pairingTopic:r,expiry:g},o);await this.setProposal(l,y);const w=ls(JSON.stringify(n)),S=await this.getVerifyContext(w,y.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:y,verifyContext:S})}catch(g){await this.sendError(l,r,g),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(ni(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const g=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const y=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const w=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const S=await this.client.core.crypto.generateSharedKey(y,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:S});const M=await this.client.core.relayer.subscribe(S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:M}),await this.client.core.pairing.activate({topic:r})}else Dr(n)&&(await this.client.proposal.delete(o,er("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:g,controller:y,expiry:w,namespaces:S,requiredNamespaces:M,optionalNamespaces:K,sessionProperties:Y,pairingTopic:G}=n.params,q=Ir({topic:r,relay:g,expiry:w,namespaces:S,acknowledged:!0,pairingTopic:G,requiredNamespaces:M,optionalNamespaces:K,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},Y&&{sessionProperties:Y});await this.sendResult(n.id,r,!0),this.events.emit(Ft("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(g){await this.sendError(o,r,g),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;ni(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ft("session_approve",o),{})):Dr(n)&&(await this.client.session.delete(r,er("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:l}=n;try{this.isValidUpdate(Ir({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult(l,r,!0),this.client.events.emit("session_update",{id:l,topic:r,params:o})}catch(g){await this.sendError(l,r,g),this.client.logger.error(g)}},this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;ni(n)?this.events.emit(Ft("session_update",o),{}):Dr(n)&&this.events.emit(Ft("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Br(Zn)),await this.sendResult(o,r,!0),this.client.events.emit("session_extend",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;ni(n)?this.events.emit(Ft("session_extend",o),{}):Dr(n)&&this.events.emit(Ft("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.client.events.emit("session_ping",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{ni(n)?this.events.emit(Ft("session_ping",o),{}):Dr(n)&&this.events.emit(Ft("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Dt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult(o,r,!0)]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidRequest(Ir({topic:r},l)),await this.setPendingSessionRequest({id:o,topic:r,params:l});const g=ls(JSON.stringify(n)),y=this.client.session.get(r),w=await this.getVerifyContext(g,y.peer.metadata);this.client.events.emit("session_request",{id:o,topic:r,params:l,verifyContext:w})}catch(g){await this.sendError(o,r,g),this.client.logger.error(g)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;ni(n)?this.events.emit(Ft("session_request",o),{result:n.result}):Dr(n)&&this.events.emit(Ft("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidEmit(Ir({topic:r},l)),this.client.events.emit("session_event",{id:o,topic:r,params:l})}catch(g){await this.sendError(o,r,g),this.client.logger.error(g)}},this.isValidConnect=async r=>{if(!ar(r)){const{message:w}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:l,sessionProperties:g,relays:y}=r;if(mi(n)||await this.isValidPairingTopic(n),!b1(y,!0)){const{message:w}=Z("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(w)}!mi(o)&&ro(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!mi(l)&&ro(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),mi(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=E1(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!ar(r))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:l,sessionProperties:g}=r;await this.isValidProposalId(n);const y=this.client.proposal.get(n),w=za(o,"approve()");if(w)throw new Error(w.message);const S=xh(y.requiredNamespaces,o,"approve()");if(S)throw new Error(S.message);if(!us(l,!0)){const{message:M}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(M)}mi(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!ar(r)){const{message:l}=Z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!x1(o)){const{message:l}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!ar(r)){const{message:S}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(S)}const{relay:n,controller:o,namespaces:l,expiry:g}=r;if(!I1(n)){const{message:S}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(S)}const y=S1(o,"onSessionSettleRequest()");if(y)throw new Error(y.message);const w=za(l,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(yi(g)){const{message:S}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(S)}},this.isValidUpdate=async r=>{if(!ar(r)){const{message:w}=Z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const l=this.client.session.get(n),g=za(o,"update()");if(g)throw new Error(g.message);const y=xh(l.requiredNamespaces,o,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!ar(r)){const{message:o}=Z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!ar(r)){const{message:w}=Z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:n,request:o,chainId:l,expiry:g}=r;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!Ih(y,l)){const{message:w}=Z("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(w)}if(!P1(o)){const{message:w}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!C1(y,l,o.method)){const{message:w}=Z("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(g&&!A1(g,Ya)){const{message:w}=Z("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${Ya.min} and ${Ya.max}`);throw new Error(w)}},this.isValidRespond=async r=>{if(!ar(r)){const{message:l}=Z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:n,response:o}=r;if(await this.isValidSessionTopic(n),!O1(o)){const{message:l}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!ar(r)){const{message:o}=Z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!ar(r)){const{message:y}=Z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:n,event:o,chainId:l}=r;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!Ih(g,l)){const{message:y}=Z("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(y)}if(!R1(o)){const{message:y}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}if(!T1(g,l,o.name)){const{message:y}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!ar(r)){const{message:o}=Z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||"",validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});l&&(o.verified.origin=l,o.verified.validation=l===n.url?"VALID":"INVALID")}catch(l){this.client.logger.error(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!us(o,!1)){const{message:l}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(l)}})}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(Dt.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);yc(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):lo(o)&&(await this.client.core.history.resolve(o),this.onRelayEventResponse({topic:r,payload:o}))})}registerExpirerEvents(){this.client.core.expirer.on(Sr.expired,async i=>{const{topic:r,id:n}=Rl(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}isValidPairingTopic(i){if(!us(i,!1)){const{message:r}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(yi(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=Z("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!us(i,!1)){const{message:r}=Z("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(yi(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=Z("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(us(i,!1)){const{message:r}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!N1(i)){const{message:r}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(yi(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=Z("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class Nb extends po{constructor(i,r){super(i,r,bb,_c),this.core=i,this.logger=r}}class Fb extends po{constructor(i,r){super(i,r,Eb,_c),this.core=i,this.logger=r}}class Db extends po{constructor(i,r){super(i,r,Ib,_c,n=>n.id),this.core=i,this.logger=r}}let Lb=class vf extends um{constructor(i){super(i),this.protocol=ff,this.version=pf,this.name=Ja.name,this.events=new Cr.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||Ja.name,this.metadata=(i==null?void 0:i.metadata)||m1();const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Ja.logger}));this.core=(i==null?void 0:i.core)||new wb(i),this.logger=Ae.generateChildLogger(r,this.name),this.session=new Fb(this.core,this.logger),this.proposal=new Nb(this.core,this.logger),this.pendingRequest=new Db(this.core,this.logger),this.engine=new Tb(this)}static async init(i){const r=new vf(i);return await r.initialize(),r}get context(){return Ae.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const $b={Accept:"application/json","Content-Type":"application/json"},jb="POST",gl={headers:$b,method:jb},vl=10;class qi{constructor(i,r=!1){if(this.url=i,this.disableProviderPing=r,this.events=new Cr.EventEmitter,this.isAvailable=!1,this.registering=!1,!Kh(i))throw new Error(`Provided URL is not compatible with HTTP connection: ${i}`);this.url=i,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(i,r){this.isAvailable||await this.register();try{const n=ks(i),l=await(await Sh(this.url,Object.assign(Object.assign({},gl),{body:n}))).json();this.onPayload({data:l})}catch(n){this.onError(i.id,n)}}async register(i=this.url){if(!Kh(i))throw new Error(`Provided URL is not compatible with HTTP connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=i,this.registering=!0;try{if(!this.disableProviderPing){const r=ks({id:1,jsonrpc:"2.0",method:"test",params:[]});await Sh(i,Object.assign(Object.assign({},gl),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?pc(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),o=n.message||n.toString(),l=ho(i,o);this.events.emit("payload",l)}parseError(i,r=this.url){return Bl(i,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>vl&&this.events.setMaxListeners(vl)}}const yl="error",Mb="wss://relay.walletconnect.com",zb="wc",qb="universal_provider",ml=`${zb}@2:${qb}:`,Ub="https://rpc.walletconnect.com/v1",Ei={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(u,i){(function(){var r,n="4.17.21",o=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",y="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",S=500,M="__lodash_placeholder__",K=1,Y=2,G=4,q=1,U=2,re=1,de=2,ge=4,pe=8,ue=16,he=32,R=64,j=128,V=256,ve=512,te=30,Ee="...",Oe=800,et=16,C=1,D=2,ze=3,Re=1/0,W=9007199254740991,H=17976931348623157e292,z=0/0,k=4294967295,ct=k-1,He=k>>>1,Lr=[["ary",j],["bind",re],["bindKey",de],["curry",pe],["curryRight",ue],["flip",ve],["partial",he],["partialRight",R],["rearg",V]],we="[object Arguments]",xt="[object Array]",O="[object AsyncFunction]",A="[object Boolean]",I="[object Date]",c="[object DOMException]",_="[object Error]",Q="[object Function]",oe="[object GeneratorFunction]",me="[object Map]",Te="[object Number]",Fe="[object Null]",Ie="[object Object]",It="[object Promise]",yt="[object Proxy]",st="[object RegExp]",Le="[object Set]",Je="[object String]",Ye="[object Symbol]",nt="[object Undefined]",qe="[object WeakMap]",Xe="[object WeakSet]",Ne="[object ArrayBuffer]",ke="[object DataView]",ut="[object Float32Array]",je="[object Float64Array]",St="[object Int8Array]",Lt="[object Int16Array]",Ut="[object Int32Array]",Ht="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Gt="[object Uint16Array]",tr="[object Uint32Array]",$r=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,Vr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,oi=/&(?:amp|lt|gt|quot|#39);/g,xi=/[&<>"']/g,ht=RegExp(oi.source),tt=RegExp(xi.source),lt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,ot=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(pt.source),dt=/^\s+/,mt=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Ot=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,go=/[()=,{}\[\]\/\s]/,vo=/\\(\\)?/g,yo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gr=/\w*$/,mo=/^[-+]0x[0-9a-f]+$/i,_o=/^0b[01]+$/i,wo=/^\[object .+?Constructor\]$/,bo=/^0o[0-7]+$/i,Eo=/^(?:0|[1-9]\d*)$/,Kr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Hi=/($^)/,xo=/['\n\r\u2028\u2029\\]/g,ki="\\ud800-\\udfff",Io="\\u0300-\\u036f",So="\\ufe20-\\ufe2f",Bi="\\u20d0-\\u20ff",Gs=Io+So+Bi,Ws="\\u2700-\\u27bf",Ar="a-z\\xdf-\\xf6\\xf8-\\xff",Po="\\xac\\xb1\\xd7\\xf7",Co="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ao="\\u2000-\\u206f",Oo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Js="A-Z\\xc0-\\xd6\\xd8-\\xde",Ys="\\ufe0e\\ufe0f",Ii=Po+Co+Ao+Oo,fs="[']",Si="["+ki+"]",ps="["+Ii+"]",Pi="["+Gs+"]",Xs="\\d+",Ro="["+Ws+"]",Zs="["+Ar+"]",Qs="[^"+ki+Ii+Xs+Ws+Ar+Js+"]",Vi="\\ud83c[\\udffb-\\udfff]",To="(?:"+Pi+"|"+Vi+")",en="[^"+ki+"]",Ki="(?:\\ud83c[\\udde6-\\uddff]){2}",ai="[\\ud800-\\udbff][\\udc00-\\udfff]",cr="["+Js+"]",tn="\\u200d",rn="(?:"+Zs+"|"+Qs+")",jr="(?:"+cr+"|"+Qs+")",sn="(?:"+fs+"(?:d|ll|m|re|s|t|ve))?",nn="(?:"+fs+"(?:D|LL|M|RE|S|T|VE))?",on=To+"?",an="["+Ys+"]?",No="(?:"+tn+"(?:"+[en,Ki,ai].join("|")+")"+an+on+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",cn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",un=an+on+No,Gi="(?:"+[Ro,Ki,ai].join("|")+")"+un,Fo="(?:"+[en+Pi+"?",Pi,Ki,ai,Si].join("|")+")",ds=RegExp(fs,"g"),Do=RegExp(Pi,"g"),Wi=RegExp(Vi+"(?="+Vi+")|"+Fo+un,"g"),hn=RegExp([cr+"?"+Zs+"+"+sn+"(?="+[ps,cr,"$"].join("|")+")",jr+"+"+nn+"(?="+[ps,cr+rn,"$"].join("|")+")",cr+"?"+rn+"+"+sn,cr+"+"+nn,cn,Gr,Xs,Gi].join("|"),"g"),ln=RegExp("["+tn+ki+Gs+Ys+"]"),Ci=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,fn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Lo=-1,Be={};Be[ut]=Be[je]=Be[St]=Be[Lt]=Be[Ut]=Be[Ht]=Be[Mt]=Be[Gt]=Be[tr]=!0,Be[we]=Be[xt]=Be[Ne]=Be[A]=Be[ke]=Be[I]=Be[_]=Be[Q]=Be[me]=Be[Te]=Be[Ie]=Be[st]=Be[Le]=Be[Je]=Be[qe]=!1;var Ue={};Ue[we]=Ue[xt]=Ue[Ne]=Ue[ke]=Ue[A]=Ue[I]=Ue[ut]=Ue[je]=Ue[St]=Ue[Lt]=Ue[Ut]=Ue[me]=Ue[Te]=Ue[Ie]=Ue[st]=Ue[Le]=Ue[Je]=Ue[Ye]=Ue[Ht]=Ue[Mt]=Ue[Gt]=Ue[tr]=!0,Ue[_]=Ue[Q]=Ue[qe]=!1;var d={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},L={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},J={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Ze=typeof qs=="object"&&qs&&qs.Object===Object&&qs,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||Tt||Function("return this")(),Ke=i&&!i.nodeType&&i,_t=Ke&&!0&&u&&!u.nodeType&&u,rr=_t&&_t.exports===Ke,Nt=rr&&Ze.process,Qe=function(){try{var E=_t&&_t.require&&_t.require("util").types;return E||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Jt=Qe&&Qe.isArrayBuffer,Or=Qe&&Qe.isDate,vr=Qe&&Qe.isMap,Mr=Qe&&Qe.isRegExp,gs=Qe&&Qe.isSet,Ai=Qe&&Qe.isTypedArray;function zt(E,T,P){switch(P.length){case 0:return E.call(T);case 1:return E.call(T,P[0]);case 2:return E.call(T,P[0],P[1]);case 3:return E.call(T,P[0],P[1],P[2])}return E.apply(T,P)}function mf(E,T,P,X){for(var ce=-1,De=E==null?0:E.length;++ce<De;){var $t=E[ce];T(X,$t,P($t),E)}return X}function yr(E,T){for(var P=-1,X=E==null?0:E.length;++P<X&&T(E[P],P,E)!==!1;);return E}function _f(E,T){for(var P=E==null?0:E.length;P--&&T(E[P],P,E)!==!1;);return E}function Ec(E,T){for(var P=-1,X=E==null?0:E.length;++P<X;)if(!T(E[P],P,E))return!1;return!0}function ci(E,T){for(var P=-1,X=E==null?0:E.length,ce=0,De=[];++P<X;){var $t=E[P];T($t,P,E)&&(De[ce++]=$t)}return De}function pn(E,T){var P=E==null?0:E.length;return!!P&&Ji(E,T,0)>-1}function $o(E,T,P){for(var X=-1,ce=E==null?0:E.length;++X<ce;)if(P(T,E[X]))return!0;return!1}function it(E,T){for(var P=-1,X=E==null?0:E.length,ce=Array(X);++P<X;)ce[P]=T(E[P],P,E);return ce}function ui(E,T){for(var P=-1,X=T.length,ce=E.length;++P<X;)E[ce+P]=T[P];return E}function jo(E,T,P,X){var ce=-1,De=E==null?0:E.length;for(X&&De&&(P=E[++ce]);++ce<De;)P=T(P,E[ce],ce,E);return P}function wf(E,T,P,X){var ce=E==null?0:E.length;for(X&&ce&&(P=E[--ce]);ce--;)P=T(P,E[ce],ce,E);return P}function Mo(E,T){for(var P=-1,X=E==null?0:E.length;++P<X;)if(T(E[P],P,E))return!0;return!1}var bf=zo("length");function Ef(E){return E.split("")}function xf(E){return E.match(Rt)||[]}function xc(E,T,P){var X;return P(E,function(ce,De,$t){if(T(ce,De,$t))return X=De,!1}),X}function dn(E,T,P,X){for(var ce=E.length,De=P+(X?1:-1);X?De--:++De<ce;)if(T(E[De],De,E))return De;return-1}function Ji(E,T,P){return T===T?Lf(E,T,P):dn(E,Ic,P)}function If(E,T,P,X){for(var ce=P-1,De=E.length;++ce<De;)if(X(E[ce],T))return ce;return-1}function Ic(E){return E!==E}function Sc(E,T){var P=E==null?0:E.length;return P?Uo(E,T)/P:z}function zo(E){return function(T){return T==null?r:T[E]}}function qo(E){return function(T){return E==null?r:E[T]}}function Pc(E,T,P,X,ce){return ce(E,function(De,$t,Ge){P=X?(X=!1,De):T(P,De,$t,Ge)}),P}function Sf(E,T){var P=E.length;for(E.sort(T);P--;)E[P]=E[P].value;return E}function Uo(E,T){for(var P,X=-1,ce=E.length;++X<ce;){var De=T(E[X]);De!==r&&(P=P===r?De:P+De)}return P}function Ho(E,T){for(var P=-1,X=Array(E);++P<E;)X[P]=T(P);return X}function Pf(E,T){return it(T,function(P){return[P,E[P]]})}function Cc(E){return E&&E.slice(0,Tc(E)+1).replace(dt,"")}function ur(E){return function(T){return E(T)}}function ko(E,T){return it(T,function(P){return E[P]})}function vs(E,T){return E.has(T)}function Ac(E,T){for(var P=-1,X=E.length;++P<X&&Ji(T,E[P],0)>-1;);return P}function Oc(E,T){for(var P=E.length;P--&&Ji(T,E[P],0)>-1;);return P}function Cf(E,T){for(var P=E.length,X=0;P--;)E[P]===T&&++X;return X}var Af=qo(d),Of=qo(b);function Rf(E){return"\\"+J[E]}function Tf(E,T){return E==null?r:E[T]}function Yi(E){return ln.test(E)}function Nf(E){return Ci.test(E)}function Ff(E){for(var T,P=[];!(T=E.next()).done;)P.push(T.value);return P}function Bo(E){var T=-1,P=Array(E.size);return E.forEach(function(X,ce){P[++T]=[ce,X]}),P}function Rc(E,T){return function(P){return E(T(P))}}function hi(E,T){for(var P=-1,X=E.length,ce=0,De=[];++P<X;){var $t=E[P];($t===T||$t===M)&&(E[P]=M,De[ce++]=P)}return De}function gn(E){var T=-1,P=Array(E.size);return E.forEach(function(X){P[++T]=X}),P}function Df(E){var T=-1,P=Array(E.size);return E.forEach(function(X){P[++T]=[X,X]}),P}function Lf(E,T,P){for(var X=P-1,ce=E.length;++X<ce;)if(E[X]===T)return X;return-1}function $f(E,T,P){for(var X=P+1;X--;)if(E[X]===T)return X;return X}function Xi(E){return Yi(E)?Mf(E):bf(E)}function Rr(E){return Yi(E)?zf(E):Ef(E)}function Tc(E){for(var T=E.length;T--&&mt.test(E.charAt(T)););return T}var jf=qo(L);function Mf(E){for(var T=Wi.lastIndex=0;Wi.test(E);)++T;return T}function zf(E){return E.match(Wi)||[]}function qf(E){return E.match(hn)||[]}var Uf=function E(T){T=T==null?Pe:Zi.defaults(Pe.Object(),T,Zi.pick(Pe,fn));var P=T.Array,X=T.Date,ce=T.Error,De=T.Function,$t=T.Math,Ge=T.Object,Vo=T.RegExp,Hf=T.String,mr=T.TypeError,vn=P.prototype,kf=De.prototype,Qi=Ge.prototype,yn=T["__core-js_shared__"],mn=kf.toString,Me=Qi.hasOwnProperty,Bf=0,Nc=function(){var e=/[^.]+$/.exec(yn&&yn.keys&&yn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),_n=Qi.toString,Vf=mn.call(Ge),Kf=Pe._,Gf=Vo("^"+mn.call(Me).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wn=rr?T.Buffer:r,li=T.Symbol,bn=T.Uint8Array,Fc=wn?wn.allocUnsafe:r,En=Rc(Ge.getPrototypeOf,Ge),Dc=Ge.create,Lc=Qi.propertyIsEnumerable,xn=vn.splice,$c=li?li.isConcatSpreadable:r,ys=li?li.iterator:r,Oi=li?li.toStringTag:r,In=function(){try{var e=Di(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Wf=T.clearTimeout!==Pe.clearTimeout&&T.clearTimeout,Jf=X&&X.now!==Pe.Date.now&&X.now,Yf=T.setTimeout!==Pe.setTimeout&&T.setTimeout,Sn=$t.ceil,Pn=$t.floor,Ko=Ge.getOwnPropertySymbols,Xf=wn?wn.isBuffer:r,jc=T.isFinite,Zf=vn.join,Qf=Rc(Ge.keys,Ge),jt=$t.max,Vt=$t.min,ep=X.now,tp=T.parseInt,Mc=$t.random,rp=vn.reverse,Go=Di(T,"DataView"),ms=Di(T,"Map"),Wo=Di(T,"Promise"),es=Di(T,"Set"),_s=Di(T,"WeakMap"),ws=Di(Ge,"create"),Cn=_s&&new _s,ts={},ip=Li(Go),sp=Li(ms),np=Li(Wo),op=Li(es),ap=Li(_s),An=li?li.prototype:r,bs=An?An.valueOf:r,zc=An?An.toString:r;function f(e){if(vt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof _r)return e;if(Me.call(e,"__wrapped__"))return qu(e)}return new _r(e)}var rs=function(){function e(){}return function(t){if(!at(t))return{};if(Dc)return Dc(t);e.prototype=t;var s=new e;return e.prototype=r,s}}();function On(){}function _r(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}f.templateSettings={escape:lt,evaluate:ft,interpolate:ot,variable:"",imports:{_:f}},f.prototype=On.prototype,f.prototype.constructor=f,_r.prototype=rs(On.prototype),_r.prototype.constructor=_r;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=k,this.__views__=[]}function cp(){var e=new Se(this.__wrapped__);return e.__actions__=ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ir(this.__views__),e}function up(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function hp(){var e=this.__wrapped__.value(),t=this.__dir__,s=fe(e),a=t<0,h=s?e.length:0,p=Ed(0,h,this.__views__),v=p.start,m=p.end,x=m-v,N=a?m:v-1,F=this.__iteratees__,$=F.length,B=0,ee=Vt(x,this.__takeCount__);if(!s||!a&&h==x&&ee==x)return uu(e,this.__actions__);var se=[];e:for(;x--&&B<ee;){N+=t;for(var _e=-1,ne=e[N];++_e<$;){var xe=F[_e],Ce=xe.iteratee,fr=xe.type,Zt=Ce(ne);if(fr==D)ne=Zt;else if(!Zt){if(fr==C)continue e;break e}}se[B++]=ne}return se}Se.prototype=rs(On.prototype),Se.prototype.constructor=Se;function Ri(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function lp(){this.__data__=ws?ws(null):{},this.size=0}function fp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function pp(e){var t=this.__data__;if(ws){var s=t[e];return s===w?r:s}return Me.call(t,e)?t[e]:r}function dp(e){var t=this.__data__;return ws?t[e]!==r:Me.call(t,e)}function gp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=ws&&t===r?w:t,this}Ri.prototype.clear=lp,Ri.prototype.delete=fp,Ri.prototype.get=pp,Ri.prototype.has=dp,Ri.prototype.set=gp;function Wr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function vp(){this.__data__=[],this.size=0}function yp(e){var t=this.__data__,s=Rn(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():xn.call(t,s,1),--this.size,!0}function mp(e){var t=this.__data__,s=Rn(t,e);return s<0?r:t[s][1]}function _p(e){return Rn(this.__data__,e)>-1}function wp(e,t){var s=this.__data__,a=Rn(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}Wr.prototype.clear=vp,Wr.prototype.delete=yp,Wr.prototype.get=mp,Wr.prototype.has=_p,Wr.prototype.set=wp;function Jr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function bp(){this.size=0,this.__data__={hash:new Ri,map:new(ms||Wr),string:new Ri}}function Ep(e){var t=Hn(this,e).delete(e);return this.size-=t?1:0,t}function xp(e){return Hn(this,e).get(e)}function Ip(e){return Hn(this,e).has(e)}function Sp(e,t){var s=Hn(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Jr.prototype.clear=bp,Jr.prototype.delete=Ep,Jr.prototype.get=xp,Jr.prototype.has=Ip,Jr.prototype.set=Sp;function Ti(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Jr;++t<s;)this.add(e[t])}function Pp(e){return this.__data__.set(e,w),this}function Cp(e){return this.__data__.has(e)}Ti.prototype.add=Ti.prototype.push=Pp,Ti.prototype.has=Cp;function Tr(e){var t=this.__data__=new Wr(e);this.size=t.size}function Ap(){this.__data__=new Wr,this.size=0}function Op(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function Rp(e){return this.__data__.get(e)}function Tp(e){return this.__data__.has(e)}function Np(e,t){var s=this.__data__;if(s instanceof Wr){var a=s.__data__;if(!ms||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Jr(a)}return s.set(e,t),this.size=s.size,this}Tr.prototype.clear=Ap,Tr.prototype.delete=Op,Tr.prototype.get=Rp,Tr.prototype.has=Tp,Tr.prototype.set=Np;function qc(e,t){var s=fe(e),a=!s&&$i(e),h=!s&&!a&&vi(e),p=!s&&!a&&!h&&os(e),v=s||a||h||p,m=v?Ho(e.length,Hf):[],x=m.length;for(var N in e)(t||Me.call(e,N))&&!(v&&(N=="length"||h&&(N=="offset"||N=="parent")||p&&(N=="buffer"||N=="byteLength"||N=="byteOffset")||Qr(N,x)))&&m.push(N);return m}function Uc(e){var t=e.length;return t?e[na(0,t-1)]:r}function Fp(e,t){return kn(ir(e),Ni(t,0,e.length))}function Dp(e){return kn(ir(e))}function Jo(e,t,s){(s!==r&&!Nr(e[t],s)||s===r&&!(t in e))&&Yr(e,t,s)}function Es(e,t,s){var a=e[t];(!(Me.call(e,t)&&Nr(a,s))||s===r&&!(t in e))&&Yr(e,t,s)}function Rn(e,t){for(var s=e.length;s--;)if(Nr(e[s][0],t))return s;return-1}function Lp(e,t,s,a){return fi(e,function(h,p,v){t(a,h,s(h),v)}),a}function Hc(e,t){return e&&qr(t,qt(t),e)}function $p(e,t){return e&&qr(t,nr(t),e)}function Yr(e,t,s){t=="__proto__"&&In?In(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Yo(e,t){for(var s=-1,a=t.length,h=P(a),p=e==null;++s<a;)h[s]=p?r:Ra(e,t[s]);return h}function Ni(e,t,s){return e===e&&(s!==r&&(e=e<=s?e:s),t!==r&&(e=e>=t?e:t)),e}function wr(e,t,s,a,h,p){var v,m=t&K,x=t&Y,N=t&G;if(s&&(v=h?s(e,a,h,p):s(e)),v!==r)return v;if(!at(e))return e;var F=fe(e);if(F){if(v=Id(e),!m)return ir(e,v)}else{var $=Kt(e),B=$==Q||$==oe;if(vi(e))return fu(e,m);if($==Ie||$==we||B&&!h){if(v=x||B?{}:Tu(e),!m)return x?pd(e,$p(v,e)):fd(e,Hc(v,e))}else{if(!Ue[$])return h?e:{};v=Sd(e,$,m)}}p||(p=new Tr);var ee=p.get(e);if(ee)return ee;p.set(e,v),oh(e)?e.forEach(function(ne){v.add(wr(ne,t,s,ne,e,p))}):sh(e)&&e.forEach(function(ne,xe){v.set(xe,wr(ne,t,s,xe,e,p))});var se=N?x?va:ga:x?nr:qt,_e=F?r:se(e);return yr(_e||e,function(ne,xe){_e&&(xe=ne,ne=e[xe]),Es(v,xe,wr(ne,t,s,xe,e,p))}),v}function jp(e){var t=qt(e);return function(s){return kc(s,e,t)}}function kc(e,t,s){var a=s.length;if(e==null)return!a;for(e=Ge(e);a--;){var h=s[a],p=t[h],v=e[h];if(v===r&&!(h in e)||!p(v))return!1}return!0}function Bc(e,t,s){if(typeof e!="function")throw new mr(g);return Os(function(){e.apply(r,s)},t)}function xs(e,t,s,a){var h=-1,p=pn,v=!0,m=e.length,x=[],N=t.length;if(!m)return x;s&&(t=it(t,ur(s))),a?(p=$o,v=!1):t.length>=o&&(p=vs,v=!1,t=new Ti(t));e:for(;++h<m;){var F=e[h],$=s==null?F:s(F);if(F=a||F!==0?F:0,v&&$===$){for(var B=N;B--;)if(t[B]===$)continue e;x.push(F)}else p(t,$,a)||x.push(F)}return x}var fi=yu(zr),Vc=yu(Zo,!0);function Mp(e,t){var s=!0;return fi(e,function(a,h,p){return s=!!t(a,h,p),s}),s}function Tn(e,t,s){for(var a=-1,h=e.length;++a<h;){var p=e[a],v=t(p);if(v!=null&&(m===r?v===v&&!lr(v):s(v,m)))var m=v,x=p}return x}function zp(e,t,s,a){var h=e.length;for(s=ye(s),s<0&&(s=-s>h?0:h+s),a=a===r||a>h?h:ye(a),a<0&&(a+=h),a=s>a?0:ch(a);s<a;)e[s++]=t;return e}function Kc(e,t){var s=[];return fi(e,function(a,h,p){t(a,h,p)&&s.push(a)}),s}function kt(e,t,s,a,h){var p=-1,v=e.length;for(s||(s=Cd),h||(h=[]);++p<v;){var m=e[p];t>0&&s(m)?t>1?kt(m,t-1,s,a,h):ui(h,m):a||(h[h.length]=m)}return h}var Xo=mu(),Gc=mu(!0);function zr(e,t){return e&&Xo(e,t,qt)}function Zo(e,t){return e&&Gc(e,t,qt)}function Nn(e,t){return ci(t,function(s){return ei(e[s])})}function Fi(e,t){t=di(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[Ur(t[s++])];return s&&s==a?e:r}function Wc(e,t,s){var a=t(e);return fe(e)?a:ui(a,s(e))}function Yt(e){return e==null?e===r?nt:Fe:Oi&&Oi in Ge(e)?bd(e):Dd(e)}function Qo(e,t){return e>t}function qp(e,t){return e!=null&&Me.call(e,t)}function Up(e,t){return e!=null&&t in Ge(e)}function Hp(e,t,s){return e>=Vt(t,s)&&e<jt(t,s)}function ea(e,t,s){for(var a=s?$o:pn,h=e[0].length,p=e.length,v=p,m=P(p),x=1/0,N=[];v--;){var F=e[v];v&&t&&(F=it(F,ur(t))),x=Vt(F.length,x),m[v]=!s&&(t||h>=120&&F.length>=120)?new Ti(v&&F):r}F=e[0];var $=-1,B=m[0];e:for(;++$<h&&N.length<x;){var ee=F[$],se=t?t(ee):ee;if(ee=s||ee!==0?ee:0,!(B?vs(B,se):a(N,se,s))){for(v=p;--v;){var _e=m[v];if(!(_e?vs(_e,se):a(e[v],se,s)))continue e}B&&B.push(se),N.push(ee)}}return N}function kp(e,t,s,a){return zr(e,function(h,p,v){t(a,s(h),p,v)}),a}function Is(e,t,s){t=di(t,e),e=Lu(e,t);var a=e==null?e:e[Ur(Er(t))];return a==null?r:zt(a,e,s)}function Jc(e){return vt(e)&&Yt(e)==we}function Bp(e){return vt(e)&&Yt(e)==Ne}function Vp(e){return vt(e)&&Yt(e)==I}function Ss(e,t,s,a,h){return e===t?!0:e==null||t==null||!vt(e)&&!vt(t)?e!==e&&t!==t:Kp(e,t,s,a,Ss,h)}function Kp(e,t,s,a,h,p){var v=fe(e),m=fe(t),x=v?xt:Kt(e),N=m?xt:Kt(t);x=x==we?Ie:x,N=N==we?Ie:N;var F=x==Ie,$=N==Ie,B=x==N;if(B&&vi(e)){if(!vi(t))return!1;v=!0,F=!1}if(B&&!F)return p||(p=new Tr),v||os(e)?Au(e,t,s,a,h,p):_d(e,t,x,s,a,h,p);if(!(s&q)){var ee=F&&Me.call(e,"__wrapped__"),se=$&&Me.call(t,"__wrapped__");if(ee||se){var _e=ee?e.value():e,ne=se?t.value():t;return p||(p=new Tr),h(_e,ne,s,a,p)}}return B?(p||(p=new Tr),wd(e,t,s,a,h,p)):!1}function Gp(e){return vt(e)&&Kt(e)==me}function ta(e,t,s,a){var h=s.length,p=h,v=!a;if(e==null)return!p;for(e=Ge(e);h--;){var m=s[h];if(v&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++h<p;){m=s[h];var x=m[0],N=e[x],F=m[1];if(v&&m[2]){if(N===r&&!(x in e))return!1}else{var $=new Tr;if(a)var B=a(N,F,x,e,t,$);if(!(B===r?Ss(F,N,q|U,a,$):B))return!1}}return!0}function Yc(e){if(!at(e)||Od(e))return!1;var t=ei(e)?Gf:wo;return t.test(Li(e))}function Wp(e){return vt(e)&&Yt(e)==st}function Jp(e){return vt(e)&&Kt(e)==Le}function Yp(e){return vt(e)&&Jn(e.length)&&!!Be[Yt(e)]}function Xc(e){return typeof e=="function"?e:e==null?or:typeof e=="object"?fe(e)?eu(e[0],e[1]):Qc(e):_h(e)}function ra(e){if(!As(e))return Qf(e);var t=[];for(var s in Ge(e))Me.call(e,s)&&s!="constructor"&&t.push(s);return t}function Xp(e){if(!at(e))return Fd(e);var t=As(e),s=[];for(var a in e)a=="constructor"&&(t||!Me.call(e,a))||s.push(a);return s}function ia(e,t){return e<t}function Zc(e,t){var s=-1,a=sr(e)?P(e.length):[];return fi(e,function(h,p,v){a[++s]=t(h,p,v)}),a}function Qc(e){var t=ma(e);return t.length==1&&t[0][2]?Fu(t[0][0],t[0][1]):function(s){return s===e||ta(s,e,t)}}function eu(e,t){return wa(e)&&Nu(t)?Fu(Ur(e),t):function(s){var a=Ra(s,e);return a===r&&a===t?Ta(s,e):Ss(t,a,q|U)}}function Fn(e,t,s,a,h){e!==t&&Xo(t,function(p,v){if(h||(h=new Tr),at(p))Zp(e,t,v,s,Fn,a,h);else{var m=a?a(Ea(e,v),p,v+"",e,t,h):r;m===r&&(m=p),Jo(e,v,m)}},nr)}function Zp(e,t,s,a,h,p,v){var m=Ea(e,s),x=Ea(t,s),N=v.get(x);if(N){Jo(e,s,N);return}var F=p?p(m,x,s+"",e,t,v):r,$=F===r;if($){var B=fe(x),ee=!B&&vi(x),se=!B&&!ee&&os(x);F=x,B||ee||se?fe(m)?F=m:wt(m)?F=ir(m):ee?($=!1,F=fu(x,!0)):se?($=!1,F=pu(x,!0)):F=[]:Rs(x)||$i(x)?(F=m,$i(m)?F=uh(m):(!at(m)||ei(m))&&(F=Tu(x))):$=!1}$&&(v.set(x,F),h(F,x,a,p,v),v.delete(x)),Jo(e,s,F)}function tu(e,t){var s=e.length;if(s)return t+=t<0?s:0,Qr(t,s)?e[t]:r}function ru(e,t,s){t.length?t=it(t,function(p){return fe(p)?function(v){return Fi(v,p.length===1?p[0]:p)}:p}):t=[or];var a=-1;t=it(t,ur(ie()));var h=Zc(e,function(p,v,m){var x=it(t,function(N){return N(p)});return{criteria:x,index:++a,value:p}});return Sf(h,function(p,v){return ld(p,v,s)})}function Qp(e,t){return iu(e,t,function(s,a){return Ta(e,a)})}function iu(e,t,s){for(var a=-1,h=t.length,p={};++a<h;){var v=t[a],m=Fi(e,v);s(m,v)&&Ps(p,di(v,e),m)}return p}function ed(e){return function(t){return Fi(t,e)}}function sa(e,t,s,a){var h=a?If:Ji,p=-1,v=t.length,m=e;for(e===t&&(t=ir(t)),s&&(m=it(e,ur(s)));++p<v;)for(var x=0,N=t[p],F=s?s(N):N;(x=h(m,F,x,a))>-1;)m!==e&&xn.call(m,x,1),xn.call(e,x,1);return e}function su(e,t){for(var s=e?t.length:0,a=s-1;s--;){var h=t[s];if(s==a||h!==p){var p=h;Qr(h)?xn.call(e,h,1):ca(e,h)}}return e}function na(e,t){return e+Pn(Mc()*(t-e+1))}function td(e,t,s,a){for(var h=-1,p=jt(Sn((t-e)/(s||1)),0),v=P(p);p--;)v[a?p:++h]=e,e+=s;return v}function oa(e,t){var s="";if(!e||t<1||t>W)return s;do t%2&&(s+=e),t=Pn(t/2),t&&(e+=e);while(t);return s}function be(e,t){return xa(Du(e,t,or),e+"")}function rd(e){return Uc(as(e))}function id(e,t){var s=as(e);return kn(s,Ni(t,0,s.length))}function Ps(e,t,s,a){if(!at(e))return e;t=di(t,e);for(var h=-1,p=t.length,v=p-1,m=e;m!=null&&++h<p;){var x=Ur(t[h]),N=s;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(h!=v){var F=m[x];N=a?a(F,x,m):r,N===r&&(N=at(F)?F:Qr(t[h+1])?[]:{})}Es(m,x,N),m=m[x]}return e}var nu=Cn?function(e,t){return Cn.set(e,t),e}:or,sd=In?function(e,t){return In(e,"toString",{configurable:!0,enumerable:!1,value:Fa(t),writable:!0})}:or;function nd(e){return kn(as(e))}function br(e,t,s){var a=-1,h=e.length;t<0&&(t=-t>h?0:h+t),s=s>h?h:s,s<0&&(s+=h),h=t>s?0:s-t>>>0,t>>>=0;for(var p=P(h);++a<h;)p[a]=e[a+t];return p}function od(e,t){var s;return fi(e,function(a,h,p){return s=t(a,h,p),!s}),!!s}function Dn(e,t,s){var a=0,h=e==null?a:e.length;if(typeof t=="number"&&t===t&&h<=He){for(;a<h;){var p=a+h>>>1,v=e[p];v!==null&&!lr(v)&&(s?v<=t:v<t)?a=p+1:h=p}return h}return aa(e,t,or,s)}function aa(e,t,s,a){var h=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var v=t!==t,m=t===null,x=lr(t),N=t===r;h<p;){var F=Pn((h+p)/2),$=s(e[F]),B=$!==r,ee=$===null,se=$===$,_e=lr($);if(v)var ne=a||se;else N?ne=se&&(a||B):m?ne=se&&B&&(a||!ee):x?ne=se&&B&&!ee&&(a||!_e):ee||_e?ne=!1:ne=a?$<=t:$<t;ne?h=F+1:p=F}return Vt(p,ct)}function ou(e,t){for(var s=-1,a=e.length,h=0,p=[];++s<a;){var v=e[s],m=t?t(v):v;if(!s||!Nr(m,x)){var x=m;p[h++]=v===0?0:v}}return p}function au(e){return typeof e=="number"?e:lr(e)?z:+e}function hr(e){if(typeof e=="string")return e;if(fe(e))return it(e,hr)+"";if(lr(e))return zc?zc.call(e):"";var t=e+"";return t=="0"&&1/e==-Re?"-0":t}function pi(e,t,s){var a=-1,h=pn,p=e.length,v=!0,m=[],x=m;if(s)v=!1,h=$o;else if(p>=o){var N=t?null:yd(e);if(N)return gn(N);v=!1,h=vs,x=new Ti}else x=t?[]:m;e:for(;++a<p;){var F=e[a],$=t?t(F):F;if(F=s||F!==0?F:0,v&&$===$){for(var B=x.length;B--;)if(x[B]===$)continue e;t&&x.push($),m.push(F)}else h(x,$,s)||(x!==m&&x.push($),m.push(F))}return m}function ca(e,t){return t=di(t,e),e=Lu(e,t),e==null||delete e[Ur(Er(t))]}function cu(e,t,s,a){return Ps(e,t,s(Fi(e,t)),a)}function Ln(e,t,s,a){for(var h=e.length,p=a?h:-1;(a?p--:++p<h)&&t(e[p],p,e););return s?br(e,a?0:p,a?p+1:h):br(e,a?p+1:0,a?h:p)}function uu(e,t){var s=e;return s instanceof Se&&(s=s.value()),jo(t,function(a,h){return h.func.apply(h.thisArg,ui([a],h.args))},s)}function ua(e,t,s){var a=e.length;if(a<2)return a?pi(e[0]):[];for(var h=-1,p=P(a);++h<a;)for(var v=e[h],m=-1;++m<a;)m!=h&&(p[h]=xs(p[h]||v,e[m],t,s));return pi(kt(p,1),t,s)}function hu(e,t,s){for(var a=-1,h=e.length,p=t.length,v={};++a<h;){var m=a<p?t[a]:r;s(v,e[a],m)}return v}function ha(e){return wt(e)?e:[]}function la(e){return typeof e=="function"?e:or}function di(e,t){return fe(e)?e:wa(e,t)?[e]:zu($e(e))}var ad=be;function gi(e,t,s){var a=e.length;return s=s===r?a:s,!t&&s>=a?e:br(e,t,s)}var lu=Wf||function(e){return Pe.clearTimeout(e)};function fu(e,t){if(t)return e.slice();var s=e.length,a=Fc?Fc(s):new e.constructor(s);return e.copy(a),a}function fa(e){var t=new e.constructor(e.byteLength);return new bn(t).set(new bn(e)),t}function cd(e,t){var s=t?fa(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function ud(e){var t=new e.constructor(e.source,gr.exec(e));return t.lastIndex=e.lastIndex,t}function hd(e){return bs?Ge(bs.call(e)):{}}function pu(e,t){var s=t?fa(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function du(e,t){if(e!==t){var s=e!==r,a=e===null,h=e===e,p=lr(e),v=t!==r,m=t===null,x=t===t,N=lr(t);if(!m&&!N&&!p&&e>t||p&&v&&x&&!m&&!N||a&&v&&x||!s&&x||!h)return 1;if(!a&&!p&&!N&&e<t||N&&s&&h&&!a&&!p||m&&s&&h||!v&&h||!x)return-1}return 0}function ld(e,t,s){for(var a=-1,h=e.criteria,p=t.criteria,v=h.length,m=s.length;++a<v;){var x=du(h[a],p[a]);if(x){if(a>=m)return x;var N=s[a];return x*(N=="desc"?-1:1)}}return e.index-t.index}function gu(e,t,s,a){for(var h=-1,p=e.length,v=s.length,m=-1,x=t.length,N=jt(p-v,0),F=P(x+N),$=!a;++m<x;)F[m]=t[m];for(;++h<v;)($||h<p)&&(F[s[h]]=e[h]);for(;N--;)F[m++]=e[h++];return F}function vu(e,t,s,a){for(var h=-1,p=e.length,v=-1,m=s.length,x=-1,N=t.length,F=jt(p-m,0),$=P(F+N),B=!a;++h<F;)$[h]=e[h];for(var ee=h;++x<N;)$[ee+x]=t[x];for(;++v<m;)(B||h<p)&&($[ee+s[v]]=e[h++]);return $}function ir(e,t){var s=-1,a=e.length;for(t||(t=P(a));++s<a;)t[s]=e[s];return t}function qr(e,t,s,a){var h=!s;s||(s={});for(var p=-1,v=t.length;++p<v;){var m=t[p],x=a?a(s[m],e[m],m,s,e):r;x===r&&(x=e[m]),h?Yr(s,m,x):Es(s,m,x)}return s}function fd(e,t){return qr(e,_a(e),t)}function pd(e,t){return qr(e,Ou(e),t)}function $n(e,t){return function(s,a){var h=fe(s)?mf:Lp,p=t?t():{};return h(s,e,ie(a,2),p)}}function is(e){return be(function(t,s){var a=-1,h=s.length,p=h>1?s[h-1]:r,v=h>2?s[2]:r;for(p=e.length>3&&typeof p=="function"?(h--,p):r,v&&Xt(s[0],s[1],v)&&(p=h<3?r:p,h=1),t=Ge(t);++a<h;){var m=s[a];m&&e(t,m,a,p)}return t})}function yu(e,t){return function(s,a){if(s==null)return s;if(!sr(s))return e(s,a);for(var h=s.length,p=t?h:-1,v=Ge(s);(t?p--:++p<h)&&a(v[p],p,v)!==!1;);return s}}function mu(e){return function(t,s,a){for(var h=-1,p=Ge(t),v=a(t),m=v.length;m--;){var x=v[e?m:++h];if(s(p[x],x,p)===!1)break}return t}}function dd(e,t,s){var a=t&re,h=Cs(e);function p(){var v=this&&this!==Pe&&this instanceof p?h:e;return v.apply(a?s:this,arguments)}return p}function _u(e){return function(t){t=$e(t);var s=Yi(t)?Rr(t):r,a=s?s[0]:t.charAt(0),h=s?gi(s,1).join(""):t.slice(1);return a[e]()+h}}function ss(e){return function(t){return jo(yh(vh(t).replace(ds,"")),e,"")}}function Cs(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=rs(e.prototype),a=e.apply(s,t);return at(a)?a:s}}function gd(e,t,s){var a=Cs(e);function h(){for(var p=arguments.length,v=P(p),m=p,x=ns(h);m--;)v[m]=arguments[m];var N=p<3&&v[0]!==x&&v[p-1]!==x?[]:hi(v,x);if(p-=N.length,p<s)return Iu(e,t,jn,h.placeholder,r,v,N,r,r,s-p);var F=this&&this!==Pe&&this instanceof h?a:e;return zt(F,this,v)}return h}function wu(e){return function(t,s,a){var h=Ge(t);if(!sr(t)){var p=ie(s,3);t=qt(t),s=function(m){return p(h[m],m,h)}}var v=e(t,s,a);return v>-1?h[p?t[v]:v]:r}}function bu(e){return Zr(function(t){var s=t.length,a=s,h=_r.prototype.thru;for(e&&t.reverse();a--;){var p=t[a];if(typeof p!="function")throw new mr(g);if(h&&!v&&Un(p)=="wrapper")var v=new _r([],!0)}for(a=v?a:s;++a<s;){p=t[a];var m=Un(p),x=m=="wrapper"?ya(p):r;x&&ba(x[0])&&x[1]==(j|pe|he|V)&&!x[4].length&&x[9]==1?v=v[Un(x[0])].apply(v,x[3]):v=p.length==1&&ba(p)?v[m]():v.thru(p)}return function(){var N=arguments,F=N[0];if(v&&N.length==1&&fe(F))return v.plant(F).value();for(var $=0,B=s?t[$].apply(this,N):F;++$<s;)B=t[$].call(this,B);return B}})}function jn(e,t,s,a,h,p,v,m,x,N){var F=t&j,$=t&re,B=t&de,ee=t&(pe|ue),se=t&ve,_e=B?r:Cs(e);function ne(){for(var xe=arguments.length,Ce=P(xe),fr=xe;fr--;)Ce[fr]=arguments[fr];if(ee)var Zt=ns(ne),pr=Cf(Ce,Zt);if(a&&(Ce=gu(Ce,a,h,ee)),p&&(Ce=vu(Ce,p,v,ee)),xe-=pr,ee&&xe<N){var bt=hi(Ce,Zt);return Iu(e,t,jn,ne.placeholder,s,Ce,bt,m,x,N-xe)}var Fr=$?s:this,ri=B?Fr[e]:e;return xe=Ce.length,m?Ce=Ld(Ce,m):se&&xe>1&&Ce.reverse(),F&&x<xe&&(Ce.length=x),this&&this!==Pe&&this instanceof ne&&(ri=_e||Cs(ri)),ri.apply(Fr,Ce)}return ne}function Eu(e,t){return function(s,a){return kp(s,e,t(a),{})}}function Mn(e,t){return function(s,a){var h;if(s===r&&a===r)return t;if(s!==r&&(h=s),a!==r){if(h===r)return a;typeof s=="string"||typeof a=="string"?(s=hr(s),a=hr(a)):(s=au(s),a=au(a)),h=e(s,a)}return h}}function pa(e){return Zr(function(t){return t=it(t,ur(ie())),be(function(s){var a=this;return e(t,function(h){return zt(h,a,s)})})})}function zn(e,t){t=t===r?" ":hr(t);var s=t.length;if(s<2)return s?oa(t,e):t;var a=oa(t,Sn(e/Xi(t)));return Yi(t)?gi(Rr(a),0,e).join(""):a.slice(0,e)}function vd(e,t,s,a){var h=t&re,p=Cs(e);function v(){for(var m=-1,x=arguments.length,N=-1,F=a.length,$=P(F+x),B=this&&this!==Pe&&this instanceof v?p:e;++N<F;)$[N]=a[N];for(;x--;)$[N++]=arguments[++m];return zt(B,h?s:this,$)}return v}function xu(e){return function(t,s,a){return a&&typeof a!="number"&&Xt(t,s,a)&&(s=a=r),t=ti(t),s===r?(s=t,t=0):s=ti(s),a=a===r?t<s?1:-1:ti(a),td(t,s,a,e)}}function qn(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=xr(t),s=xr(s)),e(t,s)}}function Iu(e,t,s,a,h,p,v,m,x,N){var F=t&pe,$=F?v:r,B=F?r:v,ee=F?p:r,se=F?r:p;t|=F?he:R,t&=~(F?R:he),t&ge||(t&=~(re|de));var _e=[e,t,h,ee,$,se,B,m,x,N],ne=s.apply(r,_e);return ba(e)&&$u(ne,_e),ne.placeholder=a,ju(ne,e,t)}function da(e){var t=$t[e];return function(s,a){if(s=xr(s),a=a==null?0:Vt(ye(a),292),a&&jc(s)){var h=($e(s)+"e").split("e"),p=t(h[0]+"e"+(+h[1]+a));return h=($e(p)+"e").split("e"),+(h[0]+"e"+(+h[1]-a))}return t(s)}}var yd=es&&1/gn(new es([,-0]))[1]==Re?function(e){return new es(e)}:$a;function Su(e){return function(t){var s=Kt(t);return s==me?Bo(t):s==Le?Df(t):Pf(t,e(t))}}function Xr(e,t,s,a,h,p,v,m){var x=t&de;if(!x&&typeof e!="function")throw new mr(g);var N=a?a.length:0;if(N||(t&=~(he|R),a=h=r),v=v===r?v:jt(ye(v),0),m=m===r?m:ye(m),N-=h?h.length:0,t&R){var F=a,$=h;a=h=r}var B=x?r:ya(e),ee=[e,t,s,a,h,F,$,p,v,m];if(B&&Nd(ee,B),e=ee[0],t=ee[1],s=ee[2],a=ee[3],h=ee[4],m=ee[9]=ee[9]===r?x?0:e.length:jt(ee[9]-N,0),!m&&t&(pe|ue)&&(t&=~(pe|ue)),!t||t==re)var se=dd(e,t,s);else t==pe||t==ue?se=gd(e,t,m):(t==he||t==(re|he))&&!h.length?se=vd(e,t,s,a):se=jn.apply(r,ee);var _e=B?nu:$u;return ju(_e(se,ee),e,t)}function Pu(e,t,s,a){return e===r||Nr(e,Qi[s])&&!Me.call(a,s)?t:e}function Cu(e,t,s,a,h,p){return at(e)&&at(t)&&(p.set(t,e),Fn(e,t,r,Cu,p),p.delete(t)),e}function md(e){return Rs(e)?r:e}function Au(e,t,s,a,h,p){var v=s&q,m=e.length,x=t.length;if(m!=x&&!(v&&x>m))return!1;var N=p.get(e),F=p.get(t);if(N&&F)return N==t&&F==e;var $=-1,B=!0,ee=s&U?new Ti:r;for(p.set(e,t),p.set(t,e);++$<m;){var se=e[$],_e=t[$];if(a)var ne=v?a(_e,se,$,t,e,p):a(se,_e,$,e,t,p);if(ne!==r){if(ne)continue;B=!1;break}if(ee){if(!Mo(t,function(xe,Ce){if(!vs(ee,Ce)&&(se===xe||h(se,xe,s,a,p)))return ee.push(Ce)})){B=!1;break}}else if(!(se===_e||h(se,_e,s,a,p))){B=!1;break}}return p.delete(e),p.delete(t),B}function _d(e,t,s,a,h,p,v){switch(s){case ke:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new bn(e),new bn(t)));case A:case I:case Te:return Nr(+e,+t);case _:return e.name==t.name&&e.message==t.message;case st:case Je:return e==t+"";case me:var m=Bo;case Le:var x=a&q;if(m||(m=gn),e.size!=t.size&&!x)return!1;var N=v.get(e);if(N)return N==t;a|=U,v.set(e,t);var F=Au(m(e),m(t),a,h,p,v);return v.delete(e),F;case Ye:if(bs)return bs.call(e)==bs.call(t)}return!1}function wd(e,t,s,a,h,p){var v=s&q,m=ga(e),x=m.length,N=ga(t),F=N.length;if(x!=F&&!v)return!1;for(var $=x;$--;){var B=m[$];if(!(v?B in t:Me.call(t,B)))return!1}var ee=p.get(e),se=p.get(t);if(ee&&se)return ee==t&&se==e;var _e=!0;p.set(e,t),p.set(t,e);for(var ne=v;++$<x;){B=m[$];var xe=e[B],Ce=t[B];if(a)var fr=v?a(Ce,xe,B,t,e,p):a(xe,Ce,B,e,t,p);if(!(fr===r?xe===Ce||h(xe,Ce,s,a,p):fr)){_e=!1;break}ne||(ne=B=="constructor")}if(_e&&!ne){var Zt=e.constructor,pr=t.constructor;Zt!=pr&&"constructor"in e&&"constructor"in t&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof pr=="function"&&pr instanceof pr)&&(_e=!1)}return p.delete(e),p.delete(t),_e}function Zr(e){return xa(Du(e,r,ku),e+"")}function ga(e){return Wc(e,qt,_a)}function va(e){return Wc(e,nr,Ou)}var ya=Cn?function(e){return Cn.get(e)}:$a;function Un(e){for(var t=e.name+"",s=ts[t],a=Me.call(ts,t)?s.length:0;a--;){var h=s[a],p=h.func;if(p==null||p==e)return h.name}return t}function ns(e){var t=Me.call(f,"placeholder")?f:e;return t.placeholder}function ie(){var e=f.iteratee||Da;return e=e===Da?Xc:e,arguments.length?e(arguments[0],arguments[1]):e}function Hn(e,t){var s=e.__data__;return Ad(t)?s[typeof t=="string"?"string":"hash"]:s.map}function ma(e){for(var t=qt(e),s=t.length;s--;){var a=t[s],h=e[a];t[s]=[a,h,Nu(h)]}return t}function Di(e,t){var s=Tf(e,t);return Yc(s)?s:r}function bd(e){var t=Me.call(e,Oi),s=e[Oi];try{e[Oi]=r;var a=!0}catch{}var h=_n.call(e);return a&&(t?e[Oi]=s:delete e[Oi]),h}var _a=Ko?function(e){return e==null?[]:(e=Ge(e),ci(Ko(e),function(t){return Lc.call(e,t)}))}:ja,Ou=Ko?function(e){for(var t=[];e;)ui(t,_a(e)),e=En(e);return t}:ja,Kt=Yt;(Go&&Kt(new Go(new ArrayBuffer(1)))!=ke||ms&&Kt(new ms)!=me||Wo&&Kt(Wo.resolve())!=It||es&&Kt(new es)!=Le||_s&&Kt(new _s)!=qe)&&(Kt=function(e){var t=Yt(e),s=t==Ie?e.constructor:r,a=s?Li(s):"";if(a)switch(a){case ip:return ke;case sp:return me;case np:return It;case op:return Le;case ap:return qe}return t});function Ed(e,t,s){for(var a=-1,h=s.length;++a<h;){var p=s[a],v=p.size;switch(p.type){case"drop":e+=v;break;case"dropRight":t-=v;break;case"take":t=Vt(t,e+v);break;case"takeRight":e=jt(e,t-v);break}}return{start:e,end:t}}function xd(e){var t=e.match(We);return t?t[1].split(Ot):[]}function Ru(e,t,s){t=di(t,e);for(var a=-1,h=t.length,p=!1;++a<h;){var v=Ur(t[a]);if(!(p=e!=null&&s(e,v)))break;e=e[v]}return p||++a!=h?p:(h=e==null?0:e.length,!!h&&Jn(h)&&Qr(v,h)&&(fe(e)||$i(e)))}function Id(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Me.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Tu(e){return typeof e.constructor=="function"&&!As(e)?rs(En(e)):{}}function Sd(e,t,s){var a=e.constructor;switch(t){case Ne:return fa(e);case A:case I:return new a(+e);case ke:return cd(e,s);case ut:case je:case St:case Lt:case Ut:case Ht:case Mt:case Gt:case tr:return pu(e,s);case me:return new a;case Te:case Je:return new a(e);case st:return ud(e);case Le:return new a;case Ye:return hd(e)}}function Pd(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(gt,`{
/* [wrapped with `+t+`] */
`)}function Cd(e){return fe(e)||$i(e)||!!($c&&e&&e[$c])}function Qr(e,t){var s=typeof e;return t=t??W,!!t&&(s=="number"||s!="symbol"&&Eo.test(e))&&e>-1&&e%1==0&&e<t}function Xt(e,t,s){if(!at(s))return!1;var a=typeof t;return(a=="number"?sr(s)&&Qr(t,s.length):a=="string"&&t in s)?Nr(s[t],e):!1}function wa(e,t){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||lr(e)?!0:Pt.test(e)||!rt.test(e)||t!=null&&e in Ge(t)}function Ad(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ba(e){var t=Un(e),s=f[t];if(typeof s!="function"||!(t in Se.prototype))return!1;if(e===s)return!0;var a=ya(s);return!!a&&e===a[0]}function Od(e){return!!Nc&&Nc in e}var Rd=yn?ei:Ma;function As(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||Qi;return e===s}function Nu(e){return e===e&&!at(e)}function Fu(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==r||e in Ge(s))}}function Td(e){var t=Gn(e,function(a){return s.size===S&&s.clear(),a}),s=t.cache;return t}function Nd(e,t){var s=e[1],a=t[1],h=s|a,p=h<(re|de|j),v=a==j&&s==pe||a==j&&s==V&&e[7].length<=t[8]||a==(j|V)&&t[7].length<=t[8]&&s==pe;if(!(p||v))return e;a&re&&(e[2]=t[2],h|=s&re?0:ge);var m=t[3];if(m){var x=e[3];e[3]=x?gu(x,m,t[4]):m,e[4]=x?hi(e[3],M):t[4]}return m=t[5],m&&(x=e[5],e[5]=x?vu(x,m,t[6]):m,e[6]=x?hi(e[5],M):t[6]),m=t[7],m&&(e[7]=m),a&j&&(e[8]=e[8]==null?t[8]:Vt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=h,e}function Fd(e){var t=[];if(e!=null)for(var s in Ge(e))t.push(s);return t}function Dd(e){return _n.call(e)}function Du(e,t,s){return t=jt(t===r?e.length-1:t,0),function(){for(var a=arguments,h=-1,p=jt(a.length-t,0),v=P(p);++h<p;)v[h]=a[t+h];h=-1;for(var m=P(t+1);++h<t;)m[h]=a[h];return m[t]=s(v),zt(e,this,m)}}function Lu(e,t){return t.length<2?e:Fi(e,br(t,0,-1))}function Ld(e,t){for(var s=e.length,a=Vt(t.length,s),h=ir(e);a--;){var p=t[a];e[a]=Qr(p,s)?h[p]:r}return e}function Ea(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var $u=Mu(nu),Os=Yf||function(e,t){return Pe.setTimeout(e,t)},xa=Mu(sd);function ju(e,t,s){var a=t+"";return xa(e,Pd(a,$d(xd(a),s)))}function Mu(e){var t=0,s=0;return function(){var a=ep(),h=et-(a-s);if(s=a,h>0){if(++t>=Oe)return arguments[0]}else t=0;return e.apply(r,arguments)}}function kn(e,t){var s=-1,a=e.length,h=a-1;for(t=t===r?a:t;++s<t;){var p=na(s,h),v=e[p];e[p]=e[s],e[s]=v}return e.length=t,e}var zu=Td(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ct,function(s,a,h,p){t.push(h?p.replace(vo,"$1"):a||s)}),t});function Ur(e){if(typeof e=="string"||lr(e))return e;var t=e+"";return t=="0"&&1/e==-Re?"-0":t}function Li(e){if(e!=null){try{return mn.call(e)}catch{}try{return e+""}catch{}}return""}function $d(e,t){return yr(Lr,function(s){var a="_."+s[0];t&s[1]&&!pn(e,a)&&e.push(a)}),e.sort()}function qu(e){if(e instanceof Se)return e.clone();var t=new _r(e.__wrapped__,e.__chain__);return t.__actions__=ir(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function jd(e,t,s){(s?Xt(e,t,s):t===r)?t=1:t=jt(ye(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var h=0,p=0,v=P(Sn(a/t));h<a;)v[p++]=br(e,h,h+=t);return v}function Md(e){for(var t=-1,s=e==null?0:e.length,a=0,h=[];++t<s;){var p=e[t];p&&(h[a++]=p)}return h}function zd(){var e=arguments.length;if(!e)return[];for(var t=P(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return ui(fe(s)?ir(s):[s],kt(t,1))}var qd=be(function(e,t){return wt(e)?xs(e,kt(t,1,wt,!0)):[]}),Ud=be(function(e,t){var s=Er(t);return wt(s)&&(s=r),wt(e)?xs(e,kt(t,1,wt,!0),ie(s,2)):[]}),Hd=be(function(e,t){var s=Er(t);return wt(s)&&(s=r),wt(e)?xs(e,kt(t,1,wt,!0),r,s):[]});function kd(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===r?1:ye(t),br(e,t<0?0:t,a)):[]}function Bd(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===r?1:ye(t),t=a-t,br(e,0,t<0?0:t)):[]}function Vd(e,t){return e&&e.length?Ln(e,ie(t,3),!0,!0):[]}function Kd(e,t){return e&&e.length?Ln(e,ie(t,3),!0):[]}function Gd(e,t,s,a){var h=e==null?0:e.length;return h?(s&&typeof s!="number"&&Xt(e,t,s)&&(s=0,a=h),zp(e,t,s,a)):[]}function Uu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=s==null?0:ye(s);return h<0&&(h=jt(a+h,0)),dn(e,ie(t,3),h)}function Hu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=a-1;return s!==r&&(h=ye(s),h=s<0?jt(a+h,0):Vt(h,a-1)),dn(e,ie(t,3),h,!0)}function ku(e){var t=e==null?0:e.length;return t?kt(e,1):[]}function Wd(e){var t=e==null?0:e.length;return t?kt(e,Re):[]}function Jd(e,t){var s=e==null?0:e.length;return s?(t=t===r?1:ye(t),kt(e,t)):[]}function Yd(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var h=e[t];a[h[0]]=h[1]}return a}function Bu(e){return e&&e.length?e[0]:r}function Xd(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=s==null?0:ye(s);return h<0&&(h=jt(a+h,0)),Ji(e,t,h)}function Zd(e){var t=e==null?0:e.length;return t?br(e,0,-1):[]}var Qd=be(function(e){var t=it(e,ha);return t.length&&t[0]===e[0]?ea(t):[]}),eg=be(function(e){var t=Er(e),s=it(e,ha);return t===Er(s)?t=r:s.pop(),s.length&&s[0]===e[0]?ea(s,ie(t,2)):[]}),tg=be(function(e){var t=Er(e),s=it(e,ha);return t=typeof t=="function"?t:r,t&&s.pop(),s.length&&s[0]===e[0]?ea(s,r,t):[]});function rg(e,t){return e==null?"":Zf.call(e,t)}function Er(e){var t=e==null?0:e.length;return t?e[t-1]:r}function ig(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=a;return s!==r&&(h=ye(s),h=h<0?jt(a+h,0):Vt(h,a-1)),t===t?$f(e,t,h):dn(e,Ic,h,!0)}function sg(e,t){return e&&e.length?tu(e,ye(t)):r}var ng=be(Vu);function Vu(e,t){return e&&e.length&&t&&t.length?sa(e,t):e}function og(e,t,s){return e&&e.length&&t&&t.length?sa(e,t,ie(s,2)):e}function ag(e,t,s){return e&&e.length&&t&&t.length?sa(e,t,r,s):e}var cg=Zr(function(e,t){var s=e==null?0:e.length,a=Yo(e,t);return su(e,it(t,function(h){return Qr(h,s)?+h:h}).sort(du)),a});function ug(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,h=[],p=e.length;for(t=ie(t,3);++a<p;){var v=e[a];t(v,a,e)&&(s.push(v),h.push(a))}return su(e,h),s}function Ia(e){return e==null?e:rp.call(e)}function hg(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Xt(e,t,s)?(t=0,s=a):(t=t==null?0:ye(t),s=s===r?a:ye(s)),br(e,t,s)):[]}function lg(e,t){return Dn(e,t)}function fg(e,t,s){return aa(e,t,ie(s,2))}function pg(e,t){var s=e==null?0:e.length;if(s){var a=Dn(e,t);if(a<s&&Nr(e[a],t))return a}return-1}function dg(e,t){return Dn(e,t,!0)}function gg(e,t,s){return aa(e,t,ie(s,2),!0)}function vg(e,t){var s=e==null?0:e.length;if(s){var a=Dn(e,t,!0)-1;if(Nr(e[a],t))return a}return-1}function yg(e){return e&&e.length?ou(e):[]}function mg(e,t){return e&&e.length?ou(e,ie(t,2)):[]}function _g(e){var t=e==null?0:e.length;return t?br(e,1,t):[]}function wg(e,t,s){return e&&e.length?(t=s||t===r?1:ye(t),br(e,0,t<0?0:t)):[]}function bg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===r?1:ye(t),t=a-t,br(e,t<0?0:t,a)):[]}function Eg(e,t){return e&&e.length?Ln(e,ie(t,3),!1,!0):[]}function xg(e,t){return e&&e.length?Ln(e,ie(t,3)):[]}var Ig=be(function(e){return pi(kt(e,1,wt,!0))}),Sg=be(function(e){var t=Er(e);return wt(t)&&(t=r),pi(kt(e,1,wt,!0),ie(t,2))}),Pg=be(function(e){var t=Er(e);return t=typeof t=="function"?t:r,pi(kt(e,1,wt,!0),r,t)});function Cg(e){return e&&e.length?pi(e):[]}function Ag(e,t){return e&&e.length?pi(e,ie(t,2)):[]}function Og(e,t){return t=typeof t=="function"?t:r,e&&e.length?pi(e,r,t):[]}function Sa(e){if(!(e&&e.length))return[];var t=0;return e=ci(e,function(s){if(wt(s))return t=jt(s.length,t),!0}),Ho(t,function(s){return it(e,zo(s))})}function Ku(e,t){if(!(e&&e.length))return[];var s=Sa(e);return t==null?s:it(s,function(a){return zt(t,r,a)})}var Rg=be(function(e,t){return wt(e)?xs(e,t):[]}),Tg=be(function(e){return ua(ci(e,wt))}),Ng=be(function(e){var t=Er(e);return wt(t)&&(t=r),ua(ci(e,wt),ie(t,2))}),Fg=be(function(e){var t=Er(e);return t=typeof t=="function"?t:r,ua(ci(e,wt),r,t)}),Dg=be(Sa);function Lg(e,t){return hu(e||[],t||[],Es)}function $g(e,t){return hu(e||[],t||[],Ps)}var jg=be(function(e){var t=e.length,s=t>1?e[t-1]:r;return s=typeof s=="function"?(e.pop(),s):r,Ku(e,s)});function Gu(e){var t=f(e);return t.__chain__=!0,t}function Mg(e,t){return t(e),e}function Bn(e,t){return t(e)}var zg=Zr(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,h=function(p){return Yo(p,e)};return t>1||this.__actions__.length||!(a instanceof Se)||!Qr(s)?this.thru(h):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Bn,args:[h],thisArg:r}),new _r(a,this.__chain__).thru(function(p){return t&&!p.length&&p.push(r),p}))});function qg(){return Gu(this)}function Ug(){return new _r(this.value(),this.__chain__)}function Hg(){this.__values__===r&&(this.__values__=ah(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function kg(){return this}function Bg(e){for(var t,s=this;s instanceof On;){var a=qu(s);a.__index__=0,a.__values__=r,t?h.__wrapped__=a:t=a;var h=a;s=s.__wrapped__}return h.__wrapped__=e,t}function Vg(){var e=this.__wrapped__;if(e instanceof Se){var t=e;return this.__actions__.length&&(t=new Se(this)),t=t.reverse(),t.__actions__.push({func:Bn,args:[Ia],thisArg:r}),new _r(t,this.__chain__)}return this.thru(Ia)}function Kg(){return uu(this.__wrapped__,this.__actions__)}var Gg=$n(function(e,t,s){Me.call(e,s)?++e[s]:Yr(e,s,1)});function Wg(e,t,s){var a=fe(e)?Ec:Mp;return s&&Xt(e,t,s)&&(t=r),a(e,ie(t,3))}function Jg(e,t){var s=fe(e)?ci:Kc;return s(e,ie(t,3))}var Yg=wu(Uu),Xg=wu(Hu);function Zg(e,t){return kt(Vn(e,t),1)}function Qg(e,t){return kt(Vn(e,t),Re)}function e0(e,t,s){return s=s===r?1:ye(s),kt(Vn(e,t),s)}function Wu(e,t){var s=fe(e)?yr:fi;return s(e,ie(t,3))}function Ju(e,t){var s=fe(e)?_f:Vc;return s(e,ie(t,3))}var t0=$n(function(e,t,s){Me.call(e,s)?e[s].push(t):Yr(e,s,[t])});function r0(e,t,s,a){e=sr(e)?e:as(e),s=s&&!a?ye(s):0;var h=e.length;return s<0&&(s=jt(h+s,0)),Yn(e)?s<=h&&e.indexOf(t,s)>-1:!!h&&Ji(e,t,s)>-1}var i0=be(function(e,t,s){var a=-1,h=typeof t=="function",p=sr(e)?P(e.length):[];return fi(e,function(v){p[++a]=h?zt(t,v,s):Is(v,t,s)}),p}),s0=$n(function(e,t,s){Yr(e,s,t)});function Vn(e,t){var s=fe(e)?it:Zc;return s(e,ie(t,3))}function n0(e,t,s,a){return e==null?[]:(fe(t)||(t=t==null?[]:[t]),s=a?r:s,fe(s)||(s=s==null?[]:[s]),ru(e,t,s))}var o0=$n(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function a0(e,t,s){var a=fe(e)?jo:Pc,h=arguments.length<3;return a(e,ie(t,4),s,h,fi)}function c0(e,t,s){var a=fe(e)?wf:Pc,h=arguments.length<3;return a(e,ie(t,4),s,h,Vc)}function u0(e,t){var s=fe(e)?ci:Kc;return s(e,Wn(ie(t,3)))}function h0(e){var t=fe(e)?Uc:rd;return t(e)}function l0(e,t,s){(s?Xt(e,t,s):t===r)?t=1:t=ye(t);var a=fe(e)?Fp:id;return a(e,t)}function f0(e){var t=fe(e)?Dp:nd;return t(e)}function p0(e){if(e==null)return 0;if(sr(e))return Yn(e)?Xi(e):e.length;var t=Kt(e);return t==me||t==Le?e.size:ra(e).length}function d0(e,t,s){var a=fe(e)?Mo:od;return s&&Xt(e,t,s)&&(t=r),a(e,ie(t,3))}var g0=be(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Xt(e,t[0],t[1])?t=[]:s>2&&Xt(t[0],t[1],t[2])&&(t=[t[0]]),ru(e,kt(t,1),[])}),Kn=Jf||function(){return Pe.Date.now()};function v0(e,t){if(typeof t!="function")throw new mr(g);return e=ye(e),function(){if(--e<1)return t.apply(this,arguments)}}function Yu(e,t,s){return t=s?r:t,t=e&&t==null?e.length:t,Xr(e,j,r,r,r,r,t)}function Xu(e,t){var s;if(typeof t!="function")throw new mr(g);return e=ye(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=r),s}}var Pa=be(function(e,t,s){var a=re;if(s.length){var h=hi(s,ns(Pa));a|=he}return Xr(e,a,t,s,h)}),Zu=be(function(e,t,s){var a=re|de;if(s.length){var h=hi(s,ns(Zu));a|=he}return Xr(t,a,e,s,h)});function Qu(e,t,s){t=s?r:t;var a=Xr(e,pe,r,r,r,r,r,t);return a.placeholder=Qu.placeholder,a}function eh(e,t,s){t=s?r:t;var a=Xr(e,ue,r,r,r,r,r,t);return a.placeholder=eh.placeholder,a}function th(e,t,s){var a,h,p,v,m,x,N=0,F=!1,$=!1,B=!0;if(typeof e!="function")throw new mr(g);t=xr(t)||0,at(s)&&(F=!!s.leading,$="maxWait"in s,p=$?jt(xr(s.maxWait)||0,t):p,B="trailing"in s?!!s.trailing:B);function ee(bt){var Fr=a,ri=h;return a=h=r,N=bt,v=e.apply(ri,Fr),v}function se(bt){return N=bt,m=Os(xe,t),F?ee(bt):v}function _e(bt){var Fr=bt-x,ri=bt-N,wh=t-Fr;return $?Vt(wh,p-ri):wh}function ne(bt){var Fr=bt-x,ri=bt-N;return x===r||Fr>=t||Fr<0||$&&ri>=p}function xe(){var bt=Kn();if(ne(bt))return Ce(bt);m=Os(xe,_e(bt))}function Ce(bt){return m=r,B&&a?ee(bt):(a=h=r,v)}function fr(){m!==r&&lu(m),N=0,a=x=h=m=r}function Zt(){return m===r?v:Ce(Kn())}function pr(){var bt=Kn(),Fr=ne(bt);if(a=arguments,h=this,x=bt,Fr){if(m===r)return se(x);if($)return lu(m),m=Os(xe,t),ee(x)}return m===r&&(m=Os(xe,t)),v}return pr.cancel=fr,pr.flush=Zt,pr}var y0=be(function(e,t){return Bc(e,1,t)}),m0=be(function(e,t,s){return Bc(e,xr(t)||0,s)});function _0(e){return Xr(e,ve)}function Gn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new mr(g);var s=function(){var a=arguments,h=t?t.apply(this,a):a[0],p=s.cache;if(p.has(h))return p.get(h);var v=e.apply(this,a);return s.cache=p.set(h,v)||p,v};return s.cache=new(Gn.Cache||Jr),s}Gn.Cache=Jr;function Wn(e){if(typeof e!="function")throw new mr(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function w0(e){return Xu(2,e)}var b0=ad(function(e,t){t=t.length==1&&fe(t[0])?it(t[0],ur(ie())):it(kt(t,1),ur(ie()));var s=t.length;return be(function(a){for(var h=-1,p=Vt(a.length,s);++h<p;)a[h]=t[h].call(this,a[h]);return zt(e,this,a)})}),Ca=be(function(e,t){var s=hi(t,ns(Ca));return Xr(e,he,r,t,s)}),rh=be(function(e,t){var s=hi(t,ns(rh));return Xr(e,R,r,t,s)}),E0=Zr(function(e,t){return Xr(e,V,r,r,r,t)});function x0(e,t){if(typeof e!="function")throw new mr(g);return t=t===r?t:ye(t),be(e,t)}function I0(e,t){if(typeof e!="function")throw new mr(g);return t=t==null?0:jt(ye(t),0),be(function(s){var a=s[t],h=gi(s,0,t);return a&&ui(h,a),zt(e,this,h)})}function S0(e,t,s){var a=!0,h=!0;if(typeof e!="function")throw new mr(g);return at(s)&&(a="leading"in s?!!s.leading:a,h="trailing"in s?!!s.trailing:h),th(e,t,{leading:a,maxWait:t,trailing:h})}function P0(e){return Yu(e,1)}function C0(e,t){return Ca(la(t),e)}function A0(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function O0(e){return wr(e,G)}function R0(e,t){return t=typeof t=="function"?t:r,wr(e,G,t)}function T0(e){return wr(e,K|G)}function N0(e,t){return t=typeof t=="function"?t:r,wr(e,K|G,t)}function F0(e,t){return t==null||kc(e,t,qt(t))}function Nr(e,t){return e===t||e!==e&&t!==t}var D0=qn(Qo),L0=qn(function(e,t){return e>=t}),$i=Jc(function(){return arguments}())?Jc:function(e){return vt(e)&&Me.call(e,"callee")&&!Lc.call(e,"callee")},fe=P.isArray,$0=Jt?ur(Jt):Bp;function sr(e){return e!=null&&Jn(e.length)&&!ei(e)}function wt(e){return vt(e)&&sr(e)}function j0(e){return e===!0||e===!1||vt(e)&&Yt(e)==A}var vi=Xf||Ma,M0=Or?ur(Or):Vp;function z0(e){return vt(e)&&e.nodeType===1&&!Rs(e)}function q0(e){if(e==null)return!0;if(sr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||vi(e)||os(e)||$i(e)))return!e.length;var t=Kt(e);if(t==me||t==Le)return!e.size;if(As(e))return!ra(e).length;for(var s in e)if(Me.call(e,s))return!1;return!0}function U0(e,t){return Ss(e,t)}function H0(e,t,s){s=typeof s=="function"?s:r;var a=s?s(e,t):r;return a===r?Ss(e,t,r,s):!!a}function Aa(e){if(!vt(e))return!1;var t=Yt(e);return t==_||t==c||typeof e.message=="string"&&typeof e.name=="string"&&!Rs(e)}function k0(e){return typeof e=="number"&&jc(e)}function ei(e){if(!at(e))return!1;var t=Yt(e);return t==Q||t==oe||t==O||t==yt}function ih(e){return typeof e=="number"&&e==ye(e)}function Jn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=W}function at(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function vt(e){return e!=null&&typeof e=="object"}var sh=vr?ur(vr):Gp;function B0(e,t){return e===t||ta(e,t,ma(t))}function V0(e,t,s){return s=typeof s=="function"?s:r,ta(e,t,ma(t),s)}function K0(e){return nh(e)&&e!=+e}function G0(e){if(Rd(e))throw new ce(l);return Yc(e)}function W0(e){return e===null}function J0(e){return e==null}function nh(e){return typeof e=="number"||vt(e)&&Yt(e)==Te}function Rs(e){if(!vt(e)||Yt(e)!=Ie)return!1;var t=En(e);if(t===null)return!0;var s=Me.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&mn.call(s)==Vf}var Oa=Mr?ur(Mr):Wp;function Y0(e){return ih(e)&&e>=-W&&e<=W}var oh=gs?ur(gs):Jp;function Yn(e){return typeof e=="string"||!fe(e)&&vt(e)&&Yt(e)==Je}function lr(e){return typeof e=="symbol"||vt(e)&&Yt(e)==Ye}var os=Ai?ur(Ai):Yp;function X0(e){return e===r}function Z0(e){return vt(e)&&Kt(e)==qe}function Q0(e){return vt(e)&&Yt(e)==Xe}var ev=qn(ia),tv=qn(function(e,t){return e<=t});function ah(e){if(!e)return[];if(sr(e))return Yn(e)?Rr(e):ir(e);if(ys&&e[ys])return Ff(e[ys]());var t=Kt(e),s=t==me?Bo:t==Le?gn:as;return s(e)}function ti(e){if(!e)return e===0?e:0;if(e=xr(e),e===Re||e===-Re){var t=e<0?-1:1;return t*H}return e===e?e:0}function ye(e){var t=ti(e),s=t%1;return t===t?s?t-s:t:0}function ch(e){return e?Ni(ye(e),0,k):0}function xr(e){if(typeof e=="number")return e;if(lr(e))return z;if(at(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=at(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Cc(e);var s=_o.test(e);return s||bo.test(e)?le(e.slice(2),s?2:8):mo.test(e)?z:+e}function uh(e){return qr(e,nr(e))}function rv(e){return e?Ni(ye(e),-W,W):e===0?e:0}function $e(e){return e==null?"":hr(e)}var iv=is(function(e,t){if(As(t)||sr(t)){qr(t,qt(t),e);return}for(var s in t)Me.call(t,s)&&Es(e,s,t[s])}),hh=is(function(e,t){qr(t,nr(t),e)}),Xn=is(function(e,t,s,a){qr(t,nr(t),e,a)}),sv=is(function(e,t,s,a){qr(t,qt(t),e,a)}),nv=Zr(Yo);function ov(e,t){var s=rs(e);return t==null?s:Hc(s,t)}var av=be(function(e,t){e=Ge(e);var s=-1,a=t.length,h=a>2?t[2]:r;for(h&&Xt(t[0],t[1],h)&&(a=1);++s<a;)for(var p=t[s],v=nr(p),m=-1,x=v.length;++m<x;){var N=v[m],F=e[N];(F===r||Nr(F,Qi[N])&&!Me.call(e,N))&&(e[N]=p[N])}return e}),cv=be(function(e){return e.push(r,Cu),zt(lh,r,e)});function uv(e,t){return xc(e,ie(t,3),zr)}function hv(e,t){return xc(e,ie(t,3),Zo)}function lv(e,t){return e==null?e:Xo(e,ie(t,3),nr)}function fv(e,t){return e==null?e:Gc(e,ie(t,3),nr)}function pv(e,t){return e&&zr(e,ie(t,3))}function dv(e,t){return e&&Zo(e,ie(t,3))}function gv(e){return e==null?[]:Nn(e,qt(e))}function vv(e){return e==null?[]:Nn(e,nr(e))}function Ra(e,t,s){var a=e==null?r:Fi(e,t);return a===r?s:a}function yv(e,t){return e!=null&&Ru(e,t,qp)}function Ta(e,t){return e!=null&&Ru(e,t,Up)}var mv=Eu(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=_n.call(t)),e[t]=s},Fa(or)),_v=Eu(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=_n.call(t)),Me.call(e,t)?e[t].push(s):e[t]=[s]},ie),wv=be(Is);function qt(e){return sr(e)?qc(e):ra(e)}function nr(e){return sr(e)?qc(e,!0):Xp(e)}function bv(e,t){var s={};return t=ie(t,3),zr(e,function(a,h,p){Yr(s,t(a,h,p),a)}),s}function Ev(e,t){var s={};return t=ie(t,3),zr(e,function(a,h,p){Yr(s,h,t(a,h,p))}),s}var xv=is(function(e,t,s){Fn(e,t,s)}),lh=is(function(e,t,s,a){Fn(e,t,s,a)}),Iv=Zr(function(e,t){var s={};if(e==null)return s;var a=!1;t=it(t,function(p){return p=di(p,e),a||(a=p.length>1),p}),qr(e,va(e),s),a&&(s=wr(s,K|Y|G,md));for(var h=t.length;h--;)ca(s,t[h]);return s});function Sv(e,t){return fh(e,Wn(ie(t)))}var Pv=Zr(function(e,t){return e==null?{}:Qp(e,t)});function fh(e,t){if(e==null)return{};var s=it(va(e),function(a){return[a]});return t=ie(t),iu(e,s,function(a,h){return t(a,h[0])})}function Cv(e,t,s){t=di(t,e);var a=-1,h=t.length;for(h||(h=1,e=r);++a<h;){var p=e==null?r:e[Ur(t[a])];p===r&&(a=h,p=s),e=ei(p)?p.call(e):p}return e}function Av(e,t,s){return e==null?e:Ps(e,t,s)}function Ov(e,t,s,a){return a=typeof a=="function"?a:r,e==null?e:Ps(e,t,s,a)}var ph=Su(qt),dh=Su(nr);function Rv(e,t,s){var a=fe(e),h=a||vi(e)||os(e);if(t=ie(t,4),s==null){var p=e&&e.constructor;h?s=a?new p:[]:at(e)?s=ei(p)?rs(En(e)):{}:s={}}return(h?yr:zr)(e,function(v,m,x){return t(s,v,m,x)}),s}function Tv(e,t){return e==null?!0:ca(e,t)}function Nv(e,t,s){return e==null?e:cu(e,t,la(s))}function Fv(e,t,s,a){return a=typeof a=="function"?a:r,e==null?e:cu(e,t,la(s),a)}function as(e){return e==null?[]:ko(e,qt(e))}function Dv(e){return e==null?[]:ko(e,nr(e))}function Lv(e,t,s){return s===r&&(s=t,t=r),s!==r&&(s=xr(s),s=s===s?s:0),t!==r&&(t=xr(t),t=t===t?t:0),Ni(xr(e),t,s)}function $v(e,t,s){return t=ti(t),s===r?(s=t,t=0):s=ti(s),e=xr(e),Hp(e,t,s)}function jv(e,t,s){if(s&&typeof s!="boolean"&&Xt(e,t,s)&&(t=s=r),s===r&&(typeof t=="boolean"?(s=t,t=r):typeof e=="boolean"&&(s=e,e=r)),e===r&&t===r?(e=0,t=1):(e=ti(e),t===r?(t=e,e=0):t=ti(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var h=Mc();return Vt(e+h*(t-e+Ve("1e-"+((h+"").length-1))),t)}return na(e,t)}var Mv=ss(function(e,t,s){return t=t.toLowerCase(),e+(s?gh(t):t)});function gh(e){return Na($e(e).toLowerCase())}function vh(e){return e=$e(e),e&&e.replace(Kr,Af).replace(Do,"")}function zv(e,t,s){e=$e(e),t=hr(t);var a=e.length;s=s===r?a:Ni(ye(s),0,a);var h=s;return s-=t.length,s>=0&&e.slice(s,h)==t}function qv(e){return e=$e(e),e&&tt.test(e)?e.replace(xi,Of):e}function Uv(e){return e=$e(e),e&&At.test(e)?e.replace(pt,"\\$&"):e}var Hv=ss(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),kv=ss(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Bv=_u("toLowerCase");function Vv(e,t,s){e=$e(e),t=ye(t);var a=t?Xi(e):0;if(!t||a>=t)return e;var h=(t-a)/2;return zn(Pn(h),s)+e+zn(Sn(h),s)}function Kv(e,t,s){e=$e(e),t=ye(t);var a=t?Xi(e):0;return t&&a<t?e+zn(t-a,s):e}function Gv(e,t,s){e=$e(e),t=ye(t);var a=t?Xi(e):0;return t&&a<t?zn(t-a,s)+e:e}function Wv(e,t,s){return s||t==null?t=0:t&&(t=+t),tp($e(e).replace(dt,""),t||0)}function Jv(e,t,s){return(s?Xt(e,t,s):t===r)?t=1:t=ye(t),oa($e(e),t)}function Yv(){var e=arguments,t=$e(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Xv=ss(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Zv(e,t,s){return s&&typeof s!="number"&&Xt(e,t,s)&&(t=s=r),s=s===r?k:s>>>0,s?(e=$e(e),e&&(typeof t=="string"||t!=null&&!Oa(t))&&(t=hr(t),!t&&Yi(e))?gi(Rr(e),0,s):e.split(t,s)):[]}var Qv=ss(function(e,t,s){return e+(s?" ":"")+Na(t)});function ey(e,t,s){return e=$e(e),s=s==null?0:Ni(ye(s),0,e.length),t=hr(t),e.slice(s,s+t.length)==t}function ty(e,t,s){var a=f.templateSettings;s&&Xt(e,t,s)&&(t=r),e=$e(e),t=Xn({},t,a,Pu);var h=Xn({},t.imports,a.imports,Pu),p=qt(h),v=ko(h,p),m,x,N=0,F=t.interpolate||Hi,$="__p += '",B=Vo((t.escape||Hi).source+"|"+F.source+"|"+(F===ot?yo:Hi).source+"|"+(t.evaluate||Hi).source+"|$","g"),ee="//# sourceURL="+(Me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Lo+"]")+`
`;e.replace(B,function(ne,xe,Ce,fr,Zt,pr){return Ce||(Ce=fr),$+=e.slice(N,pr).replace(xo,Rf),xe&&(m=!0,$+=`' +
__e(`+xe+`) +
'`),Zt&&(x=!0,$+=`';
`+Zt+`;
__p += '`),Ce&&($+=`' +
((__t = (`+Ce+`)) == null ? '' : __t) +
'`),N=pr+ne.length,ne}),$+=`';
`;var se=Me.call(t,"variable")&&t.variable;if(!se)$=`with (obj) {
`+$+`
}
`;else if(go.test(se))throw new ce(y);$=(x?$.replace($r,""):$).replace(Wt,"$1").replace(Vr,"$1;"),$="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$+`return __p
}`;var _e=mh(function(){return De(p,ee+"return "+$).apply(r,v)});if(_e.source=$,Aa(_e))throw _e;return _e}function ry(e){return $e(e).toLowerCase()}function iy(e){return $e(e).toUpperCase()}function sy(e,t,s){if(e=$e(e),e&&(s||t===r))return Cc(e);if(!e||!(t=hr(t)))return e;var a=Rr(e),h=Rr(t),p=Ac(a,h),v=Oc(a,h)+1;return gi(a,p,v).join("")}function ny(e,t,s){if(e=$e(e),e&&(s||t===r))return e.slice(0,Tc(e)+1);if(!e||!(t=hr(t)))return e;var a=Rr(e),h=Oc(a,Rr(t))+1;return gi(a,0,h).join("")}function oy(e,t,s){if(e=$e(e),e&&(s||t===r))return e.replace(dt,"");if(!e||!(t=hr(t)))return e;var a=Rr(e),h=Ac(a,Rr(t));return gi(a,h).join("")}function ay(e,t){var s=te,a=Ee;if(at(t)){var h="separator"in t?t.separator:h;s="length"in t?ye(t.length):s,a="omission"in t?hr(t.omission):a}e=$e(e);var p=e.length;if(Yi(e)){var v=Rr(e);p=v.length}if(s>=p)return e;var m=s-Xi(a);if(m<1)return a;var x=v?gi(v,0,m).join(""):e.slice(0,m);if(h===r)return x+a;if(v&&(m+=x.length-m),Oa(h)){if(e.slice(m).search(h)){var N,F=x;for(h.global||(h=Vo(h.source,$e(gr.exec(h))+"g")),h.lastIndex=0;N=h.exec(F);)var $=N.index;x=x.slice(0,$===r?m:$)}}else if(e.indexOf(hr(h),m)!=m){var B=x.lastIndexOf(h);B>-1&&(x=x.slice(0,B))}return x+a}function cy(e){return e=$e(e),e&&ht.test(e)?e.replace(oi,jf):e}var uy=ss(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Na=_u("toUpperCase");function yh(e,t,s){return e=$e(e),t=s?r:t,t===r?Nf(e)?qf(e):xf(e):e.match(t)||[]}var mh=be(function(e,t){try{return zt(e,r,t)}catch(s){return Aa(s)?s:new ce(s)}}),hy=Zr(function(e,t){return yr(t,function(s){s=Ur(s),Yr(e,s,Pa(e[s],e))}),e});function ly(e){var t=e==null?0:e.length,s=ie();return e=t?it(e,function(a){if(typeof a[1]!="function")throw new mr(g);return[s(a[0]),a[1]]}):[],be(function(a){for(var h=-1;++h<t;){var p=e[h];if(zt(p[0],this,a))return zt(p[1],this,a)}})}function fy(e){return jp(wr(e,K))}function Fa(e){return function(){return e}}function py(e,t){return e==null||e!==e?t:e}var dy=bu(),gy=bu(!0);function or(e){return e}function Da(e){return Xc(typeof e=="function"?e:wr(e,K))}function vy(e){return Qc(wr(e,K))}function yy(e,t){return eu(e,wr(t,K))}var my=be(function(e,t){return function(s){return Is(s,e,t)}}),_y=be(function(e,t){return function(s){return Is(e,s,t)}});function La(e,t,s){var a=qt(t),h=Nn(t,a);s==null&&!(at(t)&&(h.length||!a.length))&&(s=t,t=e,e=this,h=Nn(t,qt(t)));var p=!(at(s)&&"chain"in s)||!!s.chain,v=ei(e);return yr(h,function(m){var x=t[m];e[m]=x,v&&(e.prototype[m]=function(){var N=this.__chain__;if(p||N){var F=e(this.__wrapped__),$=F.__actions__=ir(this.__actions__);return $.push({func:x,args:arguments,thisArg:e}),F.__chain__=N,F}return x.apply(e,ui([this.value()],arguments))})}),e}function wy(){return Pe._===this&&(Pe._=Kf),this}function $a(){}function by(e){return e=ye(e),be(function(t){return tu(t,e)})}var Ey=pa(it),xy=pa(Ec),Iy=pa(Mo);function _h(e){return wa(e)?zo(Ur(e)):ed(e)}function Sy(e){return function(t){return e==null?r:Fi(e,t)}}var Py=xu(),Cy=xu(!0);function ja(){return[]}function Ma(){return!1}function Ay(){return{}}function Oy(){return""}function Ry(){return!0}function Ty(e,t){if(e=ye(e),e<1||e>W)return[];var s=k,a=Vt(e,k);t=ie(t),e-=k;for(var h=Ho(a,t);++s<e;)t(s);return h}function Ny(e){return fe(e)?it(e,Ur):lr(e)?[e]:ir(zu($e(e)))}function Fy(e){var t=++Bf;return $e(e)+t}var Dy=Mn(function(e,t){return e+t},0),Ly=da("ceil"),$y=Mn(function(e,t){return e/t},1),jy=da("floor");function My(e){return e&&e.length?Tn(e,or,Qo):r}function zy(e,t){return e&&e.length?Tn(e,ie(t,2),Qo):r}function qy(e){return Sc(e,or)}function Uy(e,t){return Sc(e,ie(t,2))}function Hy(e){return e&&e.length?Tn(e,or,ia):r}function ky(e,t){return e&&e.length?Tn(e,ie(t,2),ia):r}var By=Mn(function(e,t){return e*t},1),Vy=da("round"),Ky=Mn(function(e,t){return e-t},0);function Gy(e){return e&&e.length?Uo(e,or):0}function Wy(e,t){return e&&e.length?Uo(e,ie(t,2)):0}return f.after=v0,f.ary=Yu,f.assign=iv,f.assignIn=hh,f.assignInWith=Xn,f.assignWith=sv,f.at=nv,f.before=Xu,f.bind=Pa,f.bindAll=hy,f.bindKey=Zu,f.castArray=A0,f.chain=Gu,f.chunk=jd,f.compact=Md,f.concat=zd,f.cond=ly,f.conforms=fy,f.constant=Fa,f.countBy=Gg,f.create=ov,f.curry=Qu,f.curryRight=eh,f.debounce=th,f.defaults=av,f.defaultsDeep=cv,f.defer=y0,f.delay=m0,f.difference=qd,f.differenceBy=Ud,f.differenceWith=Hd,f.drop=kd,f.dropRight=Bd,f.dropRightWhile=Vd,f.dropWhile=Kd,f.fill=Gd,f.filter=Jg,f.flatMap=Zg,f.flatMapDeep=Qg,f.flatMapDepth=e0,f.flatten=ku,f.flattenDeep=Wd,f.flattenDepth=Jd,f.flip=_0,f.flow=dy,f.flowRight=gy,f.fromPairs=Yd,f.functions=gv,f.functionsIn=vv,f.groupBy=t0,f.initial=Zd,f.intersection=Qd,f.intersectionBy=eg,f.intersectionWith=tg,f.invert=mv,f.invertBy=_v,f.invokeMap=i0,f.iteratee=Da,f.keyBy=s0,f.keys=qt,f.keysIn=nr,f.map=Vn,f.mapKeys=bv,f.mapValues=Ev,f.matches=vy,f.matchesProperty=yy,f.memoize=Gn,f.merge=xv,f.mergeWith=lh,f.method=my,f.methodOf=_y,f.mixin=La,f.negate=Wn,f.nthArg=by,f.omit=Iv,f.omitBy=Sv,f.once=w0,f.orderBy=n0,f.over=Ey,f.overArgs=b0,f.overEvery=xy,f.overSome=Iy,f.partial=Ca,f.partialRight=rh,f.partition=o0,f.pick=Pv,f.pickBy=fh,f.property=_h,f.propertyOf=Sy,f.pull=ng,f.pullAll=Vu,f.pullAllBy=og,f.pullAllWith=ag,f.pullAt=cg,f.range=Py,f.rangeRight=Cy,f.rearg=E0,f.reject=u0,f.remove=ug,f.rest=x0,f.reverse=Ia,f.sampleSize=l0,f.set=Av,f.setWith=Ov,f.shuffle=f0,f.slice=hg,f.sortBy=g0,f.sortedUniq=yg,f.sortedUniqBy=mg,f.split=Zv,f.spread=I0,f.tail=_g,f.take=wg,f.takeRight=bg,f.takeRightWhile=Eg,f.takeWhile=xg,f.tap=Mg,f.throttle=S0,f.thru=Bn,f.toArray=ah,f.toPairs=ph,f.toPairsIn=dh,f.toPath=Ny,f.toPlainObject=uh,f.transform=Rv,f.unary=P0,f.union=Ig,f.unionBy=Sg,f.unionWith=Pg,f.uniq=Cg,f.uniqBy=Ag,f.uniqWith=Og,f.unset=Tv,f.unzip=Sa,f.unzipWith=Ku,f.update=Nv,f.updateWith=Fv,f.values=as,f.valuesIn=Dv,f.without=Rg,f.words=yh,f.wrap=C0,f.xor=Tg,f.xorBy=Ng,f.xorWith=Fg,f.zip=Dg,f.zipObject=Lg,f.zipObjectDeep=$g,f.zipWith=jg,f.entries=ph,f.entriesIn=dh,f.extend=hh,f.extendWith=Xn,La(f,f),f.add=Dy,f.attempt=mh,f.camelCase=Mv,f.capitalize=gh,f.ceil=Ly,f.clamp=Lv,f.clone=O0,f.cloneDeep=T0,f.cloneDeepWith=N0,f.cloneWith=R0,f.conformsTo=F0,f.deburr=vh,f.defaultTo=py,f.divide=$y,f.endsWith=zv,f.eq=Nr,f.escape=qv,f.escapeRegExp=Uv,f.every=Wg,f.find=Yg,f.findIndex=Uu,f.findKey=uv,f.findLast=Xg,f.findLastIndex=Hu,f.findLastKey=hv,f.floor=jy,f.forEach=Wu,f.forEachRight=Ju,f.forIn=lv,f.forInRight=fv,f.forOwn=pv,f.forOwnRight=dv,f.get=Ra,f.gt=D0,f.gte=L0,f.has=yv,f.hasIn=Ta,f.head=Bu,f.identity=or,f.includes=r0,f.indexOf=Xd,f.inRange=$v,f.invoke=wv,f.isArguments=$i,f.isArray=fe,f.isArrayBuffer=$0,f.isArrayLike=sr,f.isArrayLikeObject=wt,f.isBoolean=j0,f.isBuffer=vi,f.isDate=M0,f.isElement=z0,f.isEmpty=q0,f.isEqual=U0,f.isEqualWith=H0,f.isError=Aa,f.isFinite=k0,f.isFunction=ei,f.isInteger=ih,f.isLength=Jn,f.isMap=sh,f.isMatch=B0,f.isMatchWith=V0,f.isNaN=K0,f.isNative=G0,f.isNil=J0,f.isNull=W0,f.isNumber=nh,f.isObject=at,f.isObjectLike=vt,f.isPlainObject=Rs,f.isRegExp=Oa,f.isSafeInteger=Y0,f.isSet=oh,f.isString=Yn,f.isSymbol=lr,f.isTypedArray=os,f.isUndefined=X0,f.isWeakMap=Z0,f.isWeakSet=Q0,f.join=rg,f.kebabCase=Hv,f.last=Er,f.lastIndexOf=ig,f.lowerCase=kv,f.lowerFirst=Bv,f.lt=ev,f.lte=tv,f.max=My,f.maxBy=zy,f.mean=qy,f.meanBy=Uy,f.min=Hy,f.minBy=ky,f.stubArray=ja,f.stubFalse=Ma,f.stubObject=Ay,f.stubString=Oy,f.stubTrue=Ry,f.multiply=By,f.nth=sg,f.noConflict=wy,f.noop=$a,f.now=Kn,f.pad=Vv,f.padEnd=Kv,f.padStart=Gv,f.parseInt=Wv,f.random=jv,f.reduce=a0,f.reduceRight=c0,f.repeat=Jv,f.replace=Yv,f.result=Cv,f.round=Vy,f.runInContext=E,f.sample=h0,f.size=p0,f.snakeCase=Xv,f.some=d0,f.sortedIndex=lg,f.sortedIndexBy=fg,f.sortedIndexOf=pg,f.sortedLastIndex=dg,f.sortedLastIndexBy=gg,f.sortedLastIndexOf=vg,f.startCase=Qv,f.startsWith=ey,f.subtract=Ky,f.sum=Gy,f.sumBy=Wy,f.template=ty,f.times=Ty,f.toFinite=ti,f.toInteger=ye,f.toLength=ch,f.toLower=ry,f.toNumber=xr,f.toSafeInteger=rv,f.toString=$e,f.toUpper=iy,f.trim=sy,f.trimEnd=ny,f.trimStart=oy,f.truncate=ay,f.unescape=cy,f.uniqueId=Fy,f.upperCase=uy,f.upperFirst=Na,f.each=Wu,f.eachRight=Ju,f.first=Bu,La(f,function(){var e={};return zr(f,function(t,s){Me.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,yr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),yr(["drop","take"],function(e,t){Se.prototype[e]=function(s){s=s===r?1:jt(ye(s),0);var a=this.__filtered__&&!t?new Se(this):this.clone();return a.__filtered__?a.__takeCount__=Vt(s,a.__takeCount__):a.__views__.push({size:Vt(s,k),type:e+(a.__dir__<0?"Right":"")}),a},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),yr(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==C||s==ze;Se.prototype[e]=function(h){var p=this.clone();return p.__iteratees__.push({iteratee:ie(h,3),type:s}),p.__filtered__=p.__filtered__||a,p}}),yr(["head","last"],function(e,t){var s="take"+(t?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),yr(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(or)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=be(function(e,t){return typeof e=="function"?new Se(this):this.map(function(s){return Is(s,e,t)})}),Se.prototype.reject=function(e){return this.filter(Wn(ie(e)))},Se.prototype.slice=function(e,t){e=ye(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==r&&(t=ye(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(k)},zr(Se.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),h=f[a?"take"+(t=="last"?"Right":""):t],p=a||/^find/.test(t);h&&(f.prototype[t]=function(){var v=this.__wrapped__,m=a?[1]:arguments,x=v instanceof Se,N=m[0],F=x||fe(v),$=function(xe){var Ce=h.apply(f,ui([xe],m));return a&&B?Ce[0]:Ce};F&&s&&typeof N=="function"&&N.length!=1&&(x=F=!1);var B=this.__chain__,ee=!!this.__actions__.length,se=p&&!B,_e=x&&!ee;if(!p&&F){v=_e?v:new Se(this);var ne=e.apply(v,m);return ne.__actions__.push({func:Bn,args:[$],thisArg:r}),new _r(ne,B)}return se&&_e?e.apply(this,m):(ne=this.thru($),se?a?ne.value()[0]:ne.value():ne)})}),yr(["pop","push","shift","sort","splice","unshift"],function(e){var t=vn[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var h=arguments;if(a&&!this.__chain__){var p=this.value();return t.apply(fe(p)?p:[],h)}return this[s](function(v){return t.apply(fe(v)?v:[],h)})}}),zr(Se.prototype,function(e,t){var s=f[t];if(s){var a=s.name+"";Me.call(ts,a)||(ts[a]=[]),ts[a].push({name:t,func:s})}}),ts[jn(r,de).name]=[{name:"wrapper",func:r}],Se.prototype.clone=cp,Se.prototype.reverse=up,Se.prototype.value=hp,f.prototype.at=zg,f.prototype.chain=qg,f.prototype.commit=Ug,f.prototype.next=Hg,f.prototype.plant=Bg,f.prototype.reverse=Vg,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Kg,f.prototype.first=f.prototype.head,ys&&(f.prototype[ys]=kg),f},Zi=Uf();_t?((_t.exports=Zi)._=Zi,Ke._=Zi):Pe._=Zi}).call(qs)})(oc,oc.exports);var Hb=Object.defineProperty,kb=Object.defineProperties,Bb=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,Vb=Object.prototype.hasOwnProperty,Kb=Object.prototype.propertyIsEnumerable,wl=(u,i,r)=>i in u?Hb(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,Qn=(u,i)=>{for(var r in i||(i={}))Vb.call(i,r)&&wl(u,r,i[r]);if(_l)for(var r of _l(i))Kb.call(i,r)&&wl(u,r,i[r]);return u},Gb=(u,i)=>kb(u,Bb(i));function Pr(u,i,r){let n;const o=ac(u);return i.rpcMap&&(n=i.rpcMap[o]),n||(n=`${Ub}?chainId=eip155:${o}&projectId=${r}`),n}function ac(u){return u.includes("eip155")?Number(u.split(":")[1]):Number(u)}function Wb(u,i){if(!i.includes(u))throw new Error(`Chain '${u}' not approved. Please use one of the following: ${i.toString()}`)}function Jb(u){return u.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function Yb(u,i){const r=Object.keys(i.namespaces).filter(o=>o.includes(u));if(!r.length)return[];const n=[];return r.forEach(o=>{const l=i.namespaces[o].accounts;n.push(...l)}),n}function Xb(u,i={}){const r=bl(u),n=bl(i);return oc.exports.merge(r,n)}function bl(u){var i,r,n,o;const l={};if(!ro(u))return l;for(const[g,y]of Object.entries(u)){const w=F1(g)?[g]:y.chains,S=y.methods||[],M=y.events||[],K=y.rpcMap||{},Y=io(g);l[Y]=Gb(Qn(Qn({},l[Y]),y),{chains:qa(w,(i=l[Y])==null?void 0:i.chains),methods:qa(S,(r=l[Y])==null?void 0:r.methods),events:qa(M,(n=l[Y])==null?void 0:n.events),rpcMap:Qn(Qn({},K),(o=l[Y])==null?void 0:o.rpcMap)})}return l}const Ui=(u,i)=>{const r=n=>{n.request!==i.request||n.topic!==i.topic||(u.events.removeListener("session_request_sent",r),Zb(i,u.core.storage))};u.on("session_request_sent",r)};async function Zb(u,i){try{const r=await i.getItem("WALLETCONNECT_DEEPLINK_CHOICE");if(!r)return;const n=typeof r=="string"?JSON.parse(r):r;let o=n==null?void 0:n.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const l=`${o}/wc?requestId=${u.id}&sessionTopic=${u.topic}`,g=D1();g===Ph.browser?window.open(l,"_self","noreferrer noopener"):g===Ph.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(l)}catch(r){console.error(r)}}const yf={},Et=u=>yf[u],Za=(u,i)=>{yf[u]=i};class Qb{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),this.client.request(i)):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||Pr(`${this.name}:${i}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Pr(i,this.namespace);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}}class eE{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){var r;switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return this.handleSwitchChain(i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0"),null;case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),await this.client.request(i)):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){const n=ac(i);if(!this.httpProviders[n]){const o=r||Pr(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,o)}this.chainId=n,this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const n=r||Pr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=ac(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}handleSwitchChain(i){const r=parseInt(i,16),n=`${this.name}:${r}`;Wb(n,this.namespace.chains),this.setDefaultChain(`${r}`)}}class tE{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),this.client.request(i)):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||Pr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Pr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}}class rE{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),this.client.request(i)):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||Pr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Pr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}}class iE{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),this.client.request(i)):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r);i[r]=this.createHttpProvider(r,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||this.getCardanoRPCUrl(i);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}}class sE{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),this.client.request(i)):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||Pr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Pr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}}class nE{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?(Ui(this.client,i),this.client.request(i)):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||Pr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Pr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new bi(new qi(n,Et("disableProviderPing")))}}var oE=Object.defineProperty,aE=Object.defineProperties,cE=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,uE=Object.prototype.hasOwnProperty,hE=Object.prototype.propertyIsEnumerable,xl=(u,i,r)=>i in u?oE(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,eo=(u,i)=>{for(var r in i||(i={}))uE.call(i,r)&&xl(u,r,i[r]);if(El)for(var r of El(i))hE.call(i,r)&&xl(u,r,i[r]);return u},Qa=(u,i)=>aE(u,cE(i));class wc{constructor(i){this.events=new fc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||yl})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const r=new wc(i);return await r.initialize(),r}async request(i,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:eo({},i),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(i,r,n){this.request(i,n).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:er("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(l=>{this.session=l}).catch(l=>{if(l.message!==gf)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{const[n,o]=this.validateChain(i);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Hs(r)){for(const n of r)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Lb.init({logger:this.providerOpts.logger||yl,relayUrl:this.providerOpts.relayUrl||Mb,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>io(r)))];Za("client",this.client),Za("events",this.events),Za("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const n=Yb(r,this.session),o=Jb(n),l=Xb(this.namespaces,this.optionalNamespaces),g=Qa(eo({},l[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new eE({namespace:g});break;case"solana":this.rpcProviders[r]=new tE({namespace:g});break;case"cosmos":this.rpcProviders[r]=new rE({namespace:g});break;case"polkadot":this.rpcProviders[r]=new Qb({namespace:g});break;case"cip34":this.rpcProviders[r]=new iE({namespace:g});break;case"elrond":this.rpcProviders[r]=new sE({namespace:g});break;case"multiversx":this.rpcProviders[r]=new nE({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:n}=r;n.name==="accountsChanged"?this.events.emit("accountsChanged",n.data):n.name==="chainChanged"?this.onChainChanged(r.chainId):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var n;const{namespaces:o}=r,l=(n=this.client)==null?void 0:n.session.get(i);this.session=Qa(eo({},l),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",Qa(eo({},er("USER_DISCONNECTED")),{data:i.topic}))}),this.on(Ei.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=i;if(!r||!Object.keys(r).length)throw new Error("Namespaces must be not empty");this.namespaces=r,this.optionalNamespaces=n,this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(i){const[r,n]=(i==null?void 0:i.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).map(g=>io(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=io(Object.keys(this.namespaces)[0]),l=this.rpcProviders[o].getDefaultChain();return[o,l]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var n;const[o,l]=this.validateChain(i);r||this.getProvider(o).setDefaultChain(l),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${ml}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${ml}/${i}`)}}const lE=wc,fE="wc",pE="ethereum_provider",dE=`${fE}@2:${pE}:`,gE="https://rpc.walletconnect.com/v1/",cc=["eth_sendTransaction","personal_sign"],FE=["eth_accounts","eth_requestAccounts","eth_call","eth_getBalance","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],uc=["chainChanged","accountsChanged"],DE=["message","disconnect","connect"];var vE=Object.defineProperty,yE=Object.defineProperties,mE=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,_E=Object.prototype.hasOwnProperty,wE=Object.prototype.propertyIsEnumerable,Sl=(u,i,r)=>i in u?vE(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ec=(u,i)=>{for(var r in i||(i={}))_E.call(i,r)&&Sl(u,r,i[r]);if(Il)for(var r of Il(i))wE.call(i,r)&&Sl(u,r,i[r]);return u},Pl=(u,i)=>yE(u,mE(i));function hc(u){return Number(u[0].split(":")[1])}function tc(u){return`0x${u.toString(16)}`}function bE(u){const{chains:i,optionalChains:r,methods:n,optionalMethods:o,events:l,optionalEvents:g,rpcMap:y}=u;if(!Hs(i))throw new Error("Invalid chains");const w=i,S=n||cc,M=l||uc,K={[hc(w)]:y[hc(w)]},Y={chains:w,methods:S,events:M,rpcMap:K},G=l==null?void 0:l.filter(de=>!uc.includes(de)),q=n==null?void 0:n.filter(de=>!cc.includes(de));if(!r&&!g&&!o&&!(G!=null&&G.length)&&!(q!=null&&q.length))return{required:Y};const U=(G==null?void 0:G.length)&&(q==null?void 0:q.length)||!r,re={chains:[...new Set(U?w.concat(r||[]):r)],methods:[...new Set(S.concat(o||[]))],events:[...new Set(M.concat(g||[]))],rpcMap:y};return{required:Y,optional:re}}class bc{constructor(){this.events=new Cr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=dE,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new bc;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:n}=bE(this.rpc);try{const o=await new Promise(async(g,y)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(S=>{!S.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Pl(ec({namespaces:{[this.namespace]:r}},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(S=>{g(S)}).catch(S=>{y(new Error(S.message))})});if(!o)return;this.setChainIds(this.rpc.chains);const l=L1(o.namespaces,[this.namespace]);this.setAccounts(l),this.events.emit("connect",{chainId:tc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",tc(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",Pl(ec({},er("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}setHttpProvider(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",tc(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.setHttpProvider(r)}}parseAccountId(i){const[r,n,o]=i.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,n;return{chains:((r=i.chains)==null?void 0:r.map(o=>this.formatChainId(o)))||[`${this.namespace}:1`],optionalChains:i.optionalChains?i.optionalChains.map(o=>this.formatChainId(o)):void 0,methods:(i==null?void 0:i.methods)||cc,events:(i==null?void 0:i.events)||uc,optionalMethods:(i==null?void 0:i.optionalMethods)||[],optionalEvents:(i==null?void 0:i.optionalEvents)||[],rpcMap:(i==null?void 0:i.rpcMap)||this.buildRpcMap(i.chains.concat(i.optionalChains||[]),i.projectId),showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:(n=i==null?void 0:i.qrModalOptions)!=null?n:void 0,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const n={};return i.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=hc(this.rpc.chains),this.signer=await lE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal)try{const{Web3Modal:r}=await $1(()=>import("./index.es-3741ae33.js").then(n=>n.i),["assets/index.es-3741ae33.js","assets/index-93e0df7c.js","assets/index-7afe9634.css"]);this.modal=new r(ec({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch{throw new Error("To use QR modal, please install @web3modal/standalone package")}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:n,rpcMap:o}=i;r&&Hs(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)})),n&&Hs(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)}))}getRpcUrl(i,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${gE}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`);this.setChainIds(i?[this.formatChainId(i)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}const LE=bc;export{LE as EthereumProvider,DE as OPTIONAL_EVENTS,FE as OPTIONAL_METHODS,uc as REQUIRED_EVENTS,cc as REQUIRED_METHODS,bc as default};
